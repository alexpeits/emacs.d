<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-05-15 Fri 12:00 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Alex Peitsinis" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link href="/htmlize.css" rel="stylesheet">
<link href="/readtheorg.css" rel="stylesheet">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0b045d7">1. Variables and PATH</a></li>
<li><a href="#org36a4c80">2. Package management</a></li>
<li><a href="#org657ed8a">3. Various utility functions</a></li>
<li><a href="#orge238ed9">4. Various configurations</a>
<ul>
<li><a href="#org77ce541">4.1. basic editing</a></li>
<li><a href="#orgc94940d">4.2. auth</a></li>
<li><a href="#org2d840ef">4.3. server</a></li>
<li><a href="#orga8d2a0c">4.4. advise raise-frame with wmctrl</a></li>
<li><a href="#org5d24f62">4.5. compilation</a></li>
<li><a href="#org0832d50">4.6. Smartparens</a></li>
<li><a href="#orga03a86e">4.7. Documentation &amp; help</a></li>
<li><a href="#org0b72e3e">4.8. mark</a></li>
<li><a href="#orga899ff6">4.9. imenu-list</a></li>
<li><a href="#orgd12488b">4.10. abbrev etc</a></li>
<li><a href="#org2e0b7ac">4.11. engine-mode</a></li>
<li><a href="#orgf52f6e1">4.12. anzu</a></li>
<li><a href="#org4679f2c">4.13. math input</a></li>
<li><a href="#orga384dff">4.14. prettify symbols</a></li>
<li><a href="#orgb147c20">4.15. recentf</a></li>
<li><a href="#org59eb65f">4.16. hi-lock &amp; symbol overlay</a></li>
<li><a href="#org10fe70b">4.17. highlight keywords in some modes</a></li>
<li><a href="#org155e65f">4.18. alignment</a></li>
<li><a href="#orgf8e2beb">4.19. temp project roots</a></li>
<li><a href="#org2616ce3">4.20. edit-indirect</a></li>
</ul>
</li>
<li><a href="#org3035110">5. Term, eshell and comint-mode</a>
<ul>
<li><a href="#orga1cd7dd">5.1. terms</a></li>
<li><a href="#org6f9c095">5.2. eshell</a></li>
</ul>
</li>
<li><a href="#org04c3d76">6. UI</a>
<ul>
<li><a href="#org18814a6">6.1. highlight trailing whitespace</a></li>
</ul>
</li>
<li><a href="#org28bfd71">7. Theme</a></li>
<li><a href="#org098cf03">8. Font</a></li>
<li><a href="#org2388c22">9. VCS</a>
<ul>
<li><a href="#orgf780a8f">9.1. vc</a></li>
<li><a href="#orge588e49">9.2. magit</a></li>
<li><a href="#orgdfbf676">9.3. git-timemachine</a></li>
<li><a href="#orgfd4a18e">9.4. diff-hl &amp; git-gutter+</a></li>
<li><a href="#orgc882db5">9.5. Helpers</a></li>
</ul>
</li>
<li><a href="#orgfb4d0b4">10. keybindings</a>
<ul>
<li><a href="#orgd31d8fb">10.1. keybind to command mapping</a></li>
<li><a href="#org66204e6">10.2. setup keybindings</a></li>
</ul>
</li>
<li><a href="#org29ec215">11. evil-mode</a>
<ul>
<li><a href="#org510a7b2">11.1. evil-mode setup</a></li>
<li><a href="#org28c70c2">11.2. evil packages that can be used without evil-mode</a></li>
</ul>
</li>
<li><a href="#org2048338">12. Hybrid input mode</a></li>
<li><a href="#orga6d4de2">13. Spell checking</a></li>
<li><a href="#org83695ed">14. Buffer &amp; window management</a>
<ul>
<li><a href="#org8606e28">14.1. ibuffer</a></li>
<li><a href="#orgd747847">14.2. avy</a></li>
<li><a href="#org1ce9e0a">14.3. ace-window</a></li>
<li><a href="#orgf041f7d">14.4. buffer-move</a></li>
<li><a href="#org7f75b84">14.5. zoom</a></li>
</ul>
</li>
<li><a href="#org5f8a8fc">15. dired</a></li>
<li><a href="#org47d2b05">16. nix</a></li>
<li><a href="#org6091940">17. direnv</a></li>
<li><a href="#org91fe7d8">18. Haskell</a></li>
<li><a href="#orge7d3a09">19. Purescript</a></li>
<li><a href="#orgedabe6c">20. Python</a></li>
<li><a href="#org47c643d">21. js/ts/html/css</a></li>
<li><a href="#org2e53b1a">22. Lisps</a>
<ul>
<li><a href="#org9e6835e">22.1. all lisps</a></li>
<li><a href="#org07ad714">22.2. emacs lisp</a></li>
</ul>
</li>
<li><a href="#orge0956f0">23. Coq (proof-general)</a></li>
<li><a href="#org51371c9">24. Markdown</a></li>
<li><a href="#org17c057d">25. LaTeX</a></li>
<li><a href="#org07aa952">26. Other prog modes</a>
<ul>
<li><a href="#org7cf9cff">26.1. idris</a></li>
<li><a href="#org8db807b">26.2. c/c++</a></li>
<li><a href="#orgef24466">26.3. dhall</a></li>
<li><a href="#org9303154">26.4. bazel</a></li>
<li><a href="#org81b0b8b">26.5. nginx</a></li>
<li><a href="#org46a0af0">26.6. terraform</a></li>
<li><a href="#orga96dee3">26.7. docker</a></li>
<li><a href="#org5725389">26.8. elasticsearch</a></li>
<li><a href="#org6d83bee">26.9. json</a></li>
<li><a href="#orgbe44dff">26.10. yaml</a></li>
<li><a href="#orgbe9aaa8">26.11. conf</a></li>
<li><a href="#org639d4a1">26.12. reStructuredText</a></li>
<li><a href="#orge6e49ab">26.13. asciidoc</a></li>
</ul>
</li>
<li><a href="#orgbee5441">27. Other major modes</a>
<ul>
<li><a href="#orgbb5f98f">27.1. elfeed</a></li>
<li><a href="#org1bde1bf">27.2. pdf tools</a></li>
<li><a href="#org085972c">27.3. erc</a></li>
</ul>
</li>
<li><a href="#orge4f2999">28. Searching</a>
<ul>
<li><a href="#org178498a">28.1. isearch</a></li>
<li><a href="#orgbcb1b59">28.2. rg</a></li>
</ul>
</li>
<li><a href="#org8285f20">29. Company</a></li>
<li><a href="#org2326367">30. Flycheck</a></li>
<li><a href="#orgab82bcd">31. Projectile</a></li>
<li><a href="#org2633c06">32. Ivy/Counsel/Swiper</a></li>
<li><a href="#org5cfd7b5">33. Yasnippet</a></li>
<li><a href="#orgada2def">34. Modeline</a>
<ul>
<li><a href="#org64b20b0">34.1. Selected window &amp; focused frame</a></li>
<li><a href="#org755d628">34.2. Regular modeline</a></li>
<li><a href="#org71a2800">34.3. Experimental new modeline</a></li>
<li><a href="#org60fe19b">34.4. Powerline</a></li>
</ul>
</li>
<li><a href="#org71e7552">35. org-mode</a></li>
<li><a href="#org457a7e8">36. org-roam</a></li>
<li><a href="#org2ecf9df">37. deft</a></li>
<li><a href="#org9bc3c2c">38. Setup</a>
<ul>
<li><a href="#org4c204b8">38.1. Per-workstation setup</a></li>
<li><a href="#orge7f5ef5">38.2. Performance</a></li>
<li><a href="#org9594f9c">38.3. Global setup</a></li>
<li><a href="#org5a72cdf">38.4. custom</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org0b045d7" class="outline-2">
<h2 id="org0b045d7"><span class="section-number-2">1</span> Variables and PATH</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'load-path (expand-file-name (concat user-emacs-directory <span class="org-string">"lisp"</span>)))
(add-to-list 'custom-theme-load-path
             (expand-file-name (concat user-emacs-directory <span class="org-string">"custom-themes/"</span>)))

(<span class="org-keyword">setq</span> user-full-name <span class="org-string">"Alex Peitsinis"</span>
      user-mail-address <span class="org-string">"alexpeitsinis@gmail.com"</span>)

(<span class="org-keyword">dolist</span> (pth '(
               <span class="org-string">"/usr/local/bin"</span>
               <span class="org-string">"~/bin"</span>
               <span class="org-string">"~/.local/bin"</span>
               <span class="org-string">"~/.ghcup/bin"</span>
               ))
  (add-to-list 'exec-path (expand-file-name pth))
  (setenv <span class="org-string">"PATH"</span> (concat (expand-file-name pth)
                         path-separator
                         (getenv <span class="org-string">"PATH"</span>))))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/dropbox-dir</span> (expand-file-name <span class="org-string">"~/Dropbox/emacs/"</span>)
  <span class="org-doc">"Private directory synced with dropbox"</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">is-mac</span> (eq system-type 'darwin)
  <span class="org-doc">"Whether emacs is running in mac or not"</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">is-gui</span> (display-graphic-p)
  <span class="org-doc">"Whether emacs is running in gui mode or not"</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">is-term</span> (not is-gui)
  <span class="org-doc">"Whether emacs is running in a terminal or not"</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/xmonad-emacs-sp-name</span> <span class="org-string">"emacs-sp"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org36a4c80" class="outline-2">
<h2 id="org36a4c80"><span class="section-number-2">2</span> Package management</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">package</span>)
(add-to-list 'package-archives
             '(<span class="org-string">"melpa"</span> . <span class="org-string">"https://melpa.org/packages/"</span>)
             '(<span class="org-string">"MELPA Stable"</span> . <span class="org-string">"https://stable.melpa.org/packages/"</span>))
(<span class="org-keyword">when</span> (&lt; emacs-major-version <span class="org-highlight-numbers-number">24</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">For important compatibility libraries like cl-lib</span>
  (add-to-list 'package-archives '(<span class="org-string">"gnu"</span> . <span class="org-string">"https://elpa.gnu.org/packages/"</span>)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Some sort of emacs bug workaround</span>
(<span class="org-keyword">when</span> (= emacs-major-version <span class="org-highlight-numbers-number">26</span>)
  (<span class="org-keyword">setq</span> gnutls-algorithm-priority <span class="org-string">"NORMAL:-VERS-TLS1.3"</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">activate installed packages</span>
(package-initialize)
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq package-enable-at-startup nil)</span>
(<span class="org-keyword">unless</span> (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Can be used to debug slow packages</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq use-package-minimum-reported-time 0.05</span>
<span class="org-comment-delimiter">;;       </span><span class="org-comment">use-package-verbose t)</span>

(<span class="org-keyword">eval-when-compile</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">use-package</span>))

(<span class="org-keyword">if</span> (&lt; emacs-major-version <span class="org-highlight-numbers-number">27</span>)
    (<span class="org-keyword">require</span> '<span class="org-constant">cl</span>))
(<span class="org-keyword">use-package</span> <span class="org-constant">diminish</span> <span class="org-builtin">:ensure</span> t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">dash</span></span><span class="org-comment">' is used in various places</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">dash</span> <span class="org-builtin">:ensure</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org657ed8a" class="outline-2">
<h2 id="org657ed8a"><span class="section-number-2">3</span> Various utility functions</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defmacro</span> <span class="org-function-name">my/add-hooks</span> (hooks <span class="org-type">&amp;rest</span> body)
  `(<span class="org-keyword">dolist</span> (hook ,hooks)
     (add-hook hook (<span class="org-keyword">lambda</span> () ,@body))))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">my/execute-f-with-hook</span> (f winf)
  `(<span class="org-keyword">lambda</span> (<span class="org-type">&amp;rest</span> args)
     (<span class="org-keyword">interactive</span>)
     (,winf)
     (apply (<span class="org-keyword">quote</span> ,f) args)))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">my/control-function-window-split</span> (f height width)
  `(<span class="org-keyword">lambda</span> (<span class="org-type">&amp;rest</span> args)
     (<span class="org-keyword">interactive</span>)
     (<span class="org-keyword">let</span> ((split-height-threshold ,height)
           (split-width-threshold ,width))
       (apply (<span class="org-keyword">quote</span> ,f) args))))

<span class="org-comment-delimiter">;; </span><span class="org-comment">what it says</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my/revert-all-buffers</span> (also-git)
  <span class="org-doc">"Refresh all open file buffers without confirmation.</span>

<span class="org-doc">Buffers in modified </span><span class="org-doc"><span class="org-warning">\</span></span><span class="org-doc">(not yet saved) state in EMACS will not be reverted. They</span>
<span class="org-doc">will be reverted though if they were modified outside EMACS. Buffers visiting</span>
<span class="org-doc">files which do not exist any more or are no longer readable will be killed.</span>

<span class="org-doc">With prefix argument ALSO-GIT, refresh the git state as well </span><span class="org-doc"><span class="org-warning">\</span></span><span class="org-doc">(branch status on</span>
<span class="org-doc">modeline)."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">dolist</span> (buf (buffer-list))
    (<span class="org-keyword">let</span> ((filename (buffer-file-name buf)))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Revert only buffers containing files, which are not modified;</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">do not try to revert non-file buffers like *Messages*.</span>
      (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> filename
                 (not (buffer-modified-p buf)))
        (<span class="org-keyword">if</span> (file-readable-p filename)
            <span class="org-comment-delimiter">;; </span><span class="org-comment">If the file exists and is readable, revert the buffer.</span>
            (<span class="org-keyword">with-current-buffer</span> buf
              (revert-buffer <span class="org-builtin">:ignore-auto</span> <span class="org-builtin">:noconfirm</span> <span class="org-builtin">:preserve-modes</span>)
              (<span class="org-keyword">when</span> also-git (vc-refresh-state)))
          <span class="org-comment-delimiter">;; </span><span class="org-comment">Otherwise, kill the buffer.</span>
          (<span class="org-keyword">let</span> (kill-buffer-query-functions) <span class="org-comment-delimiter">; </span><span class="org-comment">No query done when killing buffer</span>
            (kill-buffer buf)
            (message <span class="org-string">"Killed non-existing/unreadable file buffer: %s"</span> filename))))))
  (<span class="org-keyword">let</span> ((msg-end (<span class="org-keyword">if</span> also-git <span class="org-string">", and their git state."</span> <span class="org-string">"."</span>)))
    (message
     (format <span class="org-string">"Finished reverting buffers containing unmodified files%s"</span> msg-end))))

(<span class="org-keyword">defalias</span> '<span class="org-function-name">rb</span>  'revert-buffer)
(<span class="org-keyword">defalias</span> '<span class="org-function-name">rab</span> 'my/revert-all-buffers)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/indent-region-or-buffer</span> ()
  <span class="org-doc">"Indent a region if selected, otherwise the whole buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">save-excursion</span>
    (<span class="org-keyword">if</span> (region-active-p)
        (<span class="org-keyword">progn</span>
          (indent-region (region-beginning) (region-end))
          (message <span class="org-string">"Indented selected region."</span>))
      (<span class="org-keyword">progn</span>
        (indent-region (point-min) (point-max))
        (message <span class="org-string">"Indented buffer."</span>)))))

(global-set-key (kbd <span class="org-string">"C-M-\\"</span>) #'my/indent-region-or-buffer)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/line-length</span> (<span class="org-type">&amp;optional</span> line)
  <span class="org-doc">"Length of the Nth line."</span>
  (<span class="org-keyword">let</span> ((ln (<span class="org-keyword">if</span> line line (line-number-at-pos))))
    (<span class="org-keyword">save-excursion</span>
      (goto-char (point-min))
      (<span class="org-keyword">if</span> (zerop (forward-line (1- ln)))
          (- (line-end-position)
             (line-beginning-position))
        <span class="org-highlight-numbers-number">0</span>))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/format-region-or-buffer</span> (cmd <span class="org-type">&amp;rest</span> args)
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((buf (current-buffer))
        (cur-point (point))
        (cur-line (line-number-at-pos))
        (cur-col (current-column))
        (cur-rel-line (- (line-number-at-pos) (line-number-at-pos (window-start)))))
    (<span class="org-keyword">with-current-buffer</span> (get-buffer-create <span class="org-string">"*codefmt*"</span>)
      (erase-buffer)
      (insert-buffer-substring buf)
      (<span class="org-keyword">if</span> (zerop (apply 'call-process-region `(,(point-min) ,(point-max) ,cmd t (t nil) nil ,@args)))
          (<span class="org-keyword">progn</span>
            (<span class="org-keyword">if</span> (not (string= (buffer-string) (<span class="org-keyword">with-current-buffer</span> buf (buffer-string))))
                (copy-to-buffer buf (point-min) (point-max)))
            (kill-buffer))
        (<span class="org-warning">error</span> (format <span class="org-string">"%s failed, see *codefmt* for details"</span> cmd))))
    (goto-line cur-line)
    (<span class="org-keyword">when</span> (&lt; cur-col (my/line-length cur-line))
      (forward-char cur-col))
    (recenter cur-rel-line)
    (message (format <span class="org-string">"Formatted with %s"</span> cmd))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/format-and-save</span> (cmd <span class="org-type">&amp;rest</span> args)
  (<span class="org-keyword">interactive</span>)
  (apply 'my/format-region-or-buffer `(,cmd ,@args))
  (save-buffer))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/select-a-major-mode-last-selected</span> nil)
(<span class="org-keyword">defun</span> <span class="org-function-name">my/select-a-major-mode</span> ()
  <span class="org-doc">"Interactively select a major mode and return it as a string."</span>
  (<span class="org-keyword">let*</span> ((def (<span class="org-keyword">or</span>
               my/select-a-major-mode-last-selected
               (symbol-name initial-major-mode)))
         (choice (completing-read <span class="org-string">"major mode: "</span>
                                  (apropos-internal <span class="org-string">"-mode$"</span>)
                                  nil nil nil nil
                                  def)))
    (<span class="org-keyword">setq</span> my/select-a-major-mode-last-selected choice)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/create-scratch-buffer-with-mode</span> (other-window)
  <span class="org-doc">"Create a new scratch buffer and select major mode to use.</span>
<span class="org-doc">With a prefix argument, open the buffer using `</span><span class="org-doc"><span class="org-constant">switch-to-buffer-other-window</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">let*</span> ((mmode (my/select-a-major-mode))
         (buf (generate-new-buffer (concat <span class="org-string">"*scratch"</span> <span class="org-string">"-"</span> mmode <span class="org-string">"*"</span>)))
         (switch-func (<span class="org-keyword">if</span> other-window 'switch-to-buffer-other-window 'switch-to-buffer)))
    (funcall switch-func buf)
    (funcall (intern mmode))
    (<span class="org-keyword">setq</span> buffer-offer-save nil)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">https://www.reddit.com/r/emacs/comments/ac9gsf/question_emacs_way_of_using_windows/</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my/window-dedicated</span> (<span class="org-type">&amp;optional</span> window)
  <span class="org-doc">"Toggle the dedicated flag on a window."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((window (<span class="org-keyword">or</span> window (selected-window)))
         (dedicated (not (window-dedicated-p window))))
    (<span class="org-keyword">when</span> (called-interactively-p)
      (message (format <span class="org-string">"%s %sdedicated"</span>
                       (buffer-name (window-buffer window))
                       (<span class="org-keyword">if</span> dedicated <span class="org-string">""</span> <span class="org-string">"un"</span>))))
    (set-window-dedicated-p window dedicated)
    dedicated))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/window-fixed</span> (<span class="org-type">&amp;optional</span> window)
  <span class="org-doc">"Make a window non-resizable."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((window (<span class="org-keyword">or</span> window (selected-window)))
         (new-status (<span class="org-keyword">with-selected-window</span> window (not window-size-fixed))))
    (<span class="org-keyword">when</span> (called-interactively-p)
      (message (format <span class="org-string">"%s %sfixed"</span>
                       (buffer-name (window-buffer window))
                       (<span class="org-keyword">if</span> new-status <span class="org-string">""</span> <span class="org-string">"un"</span>))))
    (<span class="org-keyword">with-selected-window</span> window
      (<span class="org-keyword">setq</span> window-size-fixed new-status))
    new-status))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/copy-file-path</span> (include-line-number)
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">let*</span> ((full-fp (buffer-file-name))
         (prefix (read-directory-name <span class="org-string">"prefix to strip: "</span> (projectile-project-root)))
         (suffix (<span class="org-keyword">if</span> include-line-number (format <span class="org-string">":%s"</span> (number-to-string (line-number-at-pos))) <span class="org-string">""</span>))
         (fp (concat (string-remove-prefix prefix full-fp) suffix))
         )
    (kill-new fp)
    (message fp)
    t))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/useful-files</span>
  '(
    <span class="org-comment-delimiter">;; </span><span class="org-comment">haskell</span>
    <span class="org-string">"package.yaml"</span>
    <span class="org-string">"stack.yaml"</span>
    <span class="org-string">"shell.nix"</span>
    <span class="org-string">".hlint.yaml"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">docker</span>
    <span class="org-string">"docker-compose.yml"</span>
    <span class="org-string">"Dockerfile"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">bazel</span>
    <span class="org-string">"BUILD.bazel"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">git</span>
    <span class="org-string">"README.md"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">emacs</span>
    <span class="org-string">".dir-locals.el"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/try-open-dominating-file</span> (file)
  <span class="org-doc">"Search up the file path of current file a file named FILE, and open it if it</span>
<span class="org-doc">exists.</span>

<span class="org-doc">If FILE is not provided, prompt for the filename.</span>
<span class="org-doc">With a prefix argument, open using `</span><span class="org-doc"><span class="org-constant">find-file-other-window</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span> (list (completing-read <span class="org-string">"File name: "</span>
                                      my/useful-files
                                      nil nil nil nil nil)))
  (<span class="org-keyword">let</span> ((dir (locate-dominating-file (buffer-file-name) file))
        (find-file-func (<span class="org-keyword">if</span> current-prefix-arg 'find-file-other-window 'find-file)))
    (<span class="org-keyword">if</span> dir
        (funcall find-file-func (concat (file-name-as-directory dir) file))
      (message <span class="org-string">"No matching file found"</span>))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/line-numbers</span> (relative)
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">if</span> (&lt; emacs-major-version <span class="org-highlight-numbers-number">26</span>)
      (call-interactively 'linum-mode)
    (<span class="org-keyword">if</span> display-line-numbers
        (<span class="org-keyword">setq</span> display-line-numbers nil)
      (<span class="org-keyword">if</span> relative
          (<span class="org-keyword">setq</span> display-line-numbers 'relative)
        (<span class="org-keyword">setq</span> display-line-numbers t)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/shell-command-on-buffer-or-region</span> (cmd)
  (<span class="org-keyword">save-excursion</span>
    (<span class="org-keyword">unless</span> (region-active-p)
      (mark-whole-buffer))
    (shell-command-on-region (region-beginning)
                             (region-end)
                             cmd
                             nil
                             t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge238ed9" class="outline-2">
<h2 id="orge238ed9"><span class="section-number-2">4</span> Various configurations</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org77ce541" class="outline-3">
<h3 id="org77ce541"><span class="section-number-3">4.1</span> basic editing</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">remember last position</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">saveplace</span>
  <span class="org-builtin">:hook</span> (after-init . save-place-mode))

<span class="org-comment-delimiter">;; </span><span class="org-comment">undo tree</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">undo-tree</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-x u"</span> . undo-tree-visualize)
  <span class="org-builtin">:diminish</span> undo-tree-mode
  <span class="org-builtin">:hook</span> (after-init . global-undo-tree-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> undo-tree-visualizer-relative-timestamps t
        undo-tree-visualizer-diff t))

<span class="org-comment-delimiter">;; </span><span class="org-comment">use column width 80 to fill (e.g. with `</span><span class="org-comment"><span class="org-constant">M-q</span></span><span class="org-comment">'/`</span><span class="org-comment"><span class="org-constant">gq</span></span><span class="org-comment">')</span>
(<span class="org-keyword">setq-default</span> fill-column <span class="org-highlight-numbers-number">80</span>)
(<span class="org-keyword">defun</span> <span class="org-function-name">my/set-mode-fill-width</span> (mode-hook width)
  (add-hook mode-hook `(<span class="org-keyword">lambda</span> () (<span class="org-keyword">setq</span> fill-column ,width))))

(<span class="org-keyword">use-package</span> <span class="org-constant">autorevert</span>
  <span class="org-builtin">:hook</span> (after-init . global-auto-revert-mode)
  <span class="org-builtin">:diminish</span> auto-revert-mode
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> auto-revert-verbose nil))

(<span class="org-keyword">use-package</span> <span class="org-constant">eldoc</span> <span class="org-builtin">:diminish</span> eldoc-mode)

(<span class="org-keyword">use-package</span> <span class="org-constant">files</span>
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">store all backup and autosave files in</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">one dir</span>
  (<span class="org-keyword">setq</span> backup-directory-alist
        `((<span class="org-string">".*"</span> . ,temporary-file-directory)))
  (<span class="org-keyword">setq</span> auto-save-file-name-transforms
        `((<span class="org-string">".*"</span> ,temporary-file-directory t))))

<span class="org-comment-delimiter">;; </span><span class="org-comment">only with this set to nil can org-mode export &amp; open too</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">... but it also breaks some stuff so it's disabled</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq process-connection-type nil)</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">yesss</span>
(<span class="org-keyword">defalias</span> '<span class="org-function-name">yes-or-no-p</span> #'y-or-n-p)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Always confirm before closing because I'm stupid</span>
(add-hook
 'kill-emacs-query-functions
 (<span class="org-keyword">lambda</span> () (y-or-n-p <span class="org-string">"Do you really want to exit Emacs? "</span>))
 'append)

<span class="org-comment-delimiter">;; </span><span class="org-comment">use spaces</span>
(<span class="org-keyword">setq-default</span> indent-tabs-mode nil)

<span class="org-comment-delimiter">;; </span><span class="org-comment">always scroll to the end of compilation buffers</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq compilation-scroll-output t)</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">vim-like scrolling (emacs=0)</span>
(<span class="org-keyword">setq</span> scroll-conservatively <span class="org-highlight-numbers-number">101</span>)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Supress "ad-handle-definition: x got redefined" warnings</span>
(<span class="org-keyword">setq</span> ad-redefinition-action 'accept)

<span class="org-comment-delimiter">;; </span><span class="org-comment">smooth mouse scrolling</span>
(<span class="org-keyword">setq</span> mouse-wheel-scroll-amount '(<span class="org-highlight-numbers-number">1</span> ((shift) . <span class="org-highlight-numbers-number">1</span>)) <span class="org-comment-delimiter">;; </span><span class="org-comment">one line at a time</span>
      mouse-wheel-progressive-speed t <span class="org-comment-delimiter">;; </span><span class="org-comment">don't accelerate scrolling</span>
      mouse-wheel-follow-mouse 't) <span class="org-comment-delimiter">;; </span><span class="org-comment">scroll window under mouse</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">turn off because it causes delays in some modes (e.g. coq-mode)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span><span class="org-comment">: not sure if this makes a difference</span>
(<span class="org-keyword">setq</span> smie-blink-matching-inners nil)
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq blink-matching-paren nil)</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">who in their right mind ends sentences with 2 spaces?</span>
(<span class="org-keyword">setq</span> sentence-end-double-space nil)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Don't autofill when pressing RET</span>
(aset auto-fill-chars ?\n nil)

<span class="org-comment-delimiter">;; </span><span class="org-comment">always trim whitespace before saving</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(add-hook 'before-save-hook 'delete-trailing-whitespace)</span>
(<span class="org-keyword">defalias</span> '<span class="org-function-name">dw</span> 'delete-trailing-whitespace)

<span class="org-comment-delimiter">;; </span><span class="org-comment">some keymaps</span>
(global-set-key (kbd <span class="org-string">"M-o"</span>) 'other-window)
(global-set-key (kbd <span class="org-string">"C-c j"</span>) 'previous-buffer)
(global-set-key (kbd <span class="org-string">"C-c k"</span>) 'next-buffer)
<span class="org-comment-delimiter">;; </span><span class="org-comment">I use that to switch to Greek layout</span>
(global-set-key (kbd <span class="org-string">"M-SPC"</span>) nil)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Bind M-\ to just-one-space instead of delete-horizontal-space</span>
(global-set-key (kbd <span class="org-string">"M-\\"</span>) 'just-one-space)
<span class="org-comment-delimiter">;; </span><span class="org-comment">proper count-words keybinding</span>
(global-set-key (kbd <span class="org-string">"M-="</span>) 'count-words)
<span class="org-comment-delimiter">;; </span><span class="org-comment">commenting </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span><span class="org-comment">: use newcomment</span>
(global-set-key (kbd <span class="org-string">"C-;"</span>) 'comment-indent)
(global-set-key (kbd <span class="org-string">"C-:"</span>) 'comment-kill)

<span class="org-comment-delimiter">;; </span><span class="org-comment">DocView</span>
(<span class="org-keyword">setq</span> doc-view-continuous t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">shr (html rendering)</span>
(make-variable-buffer-local 'shr-width)

(<span class="org-keyword">use-package</span> <span class="org-constant">expand-region</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-="</span> . er/expand-region)
         (<span class="org-string">"C-M-="</span> . er/contract-region)))

(<span class="org-keyword">use-package</span> <span class="org-constant">misc</span>
  <span class="org-builtin">:bind</span> (<span class="org-string">"M-Z"</span> . zap-up-to-char))

(<span class="org-keyword">use-package</span> <span class="org-constant">subword</span>
  <span class="org-builtin">:diminish</span> subword-mode
  <span class="org-builtin">:commands</span> (subword-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defadvice</span> <span class="org-function-name">subword-mode</span>
      (after advice-for-subword-mode activate)
    (<span class="org-keyword">setq</span> evil-symbol-word-search subword-mode)))

(<span class="org-keyword">use-package</span> <span class="org-constant">outline</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> outline-minor-mode-map
              (<span class="org-string">"&lt;tab&gt;"</span> . outline-toggle-children))
  <span class="org-builtin">:diminish</span> outline-minor-mode)

(<span class="org-keyword">use-package</span> <span class="org-constant">outshine</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> outline
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> outline-minor-mode-map
              (<span class="org-string">"&lt;S-iso-lefttab&gt;"</span> . outshine-cycle-buffer))
  <span class="org-builtin">:commands</span> (outshine-mode))

(<span class="org-keyword">use-package</span> <span class="org-constant">rainbow-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (rainbow-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc94940d" class="outline-3">
<h3 id="orgc94940d"><span class="section-number-3">4.2</span> auth</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">auth-source</span>
  <span class="org-builtin">:config</span>
  (add-to-list 'auth-sources (concat my/dropbox-dir <span class="org-string">"authinfo.gpg"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d840ef" class="outline-3">
<h3 id="org2d840ef"><span class="section-number-3">4.3</span> server</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">server</span>
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">don't kill buffers in server sessions</span>
  (<span class="org-keyword">setq</span> server-kill-new-buffers nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga8d2a0c" class="outline-3">
<h3 id="orga8d2a0c"><span class="section-number-3">4.4</span> advise raise-frame with wmctrl</h3>
<div class="outline-text-3" id="text-4-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/wmctrl-raise-frame</span> (<span class="org-type">&amp;optional</span> frame)
  (<span class="org-keyword">when</span> (executable-find <span class="org-string">"wmctrl"</span>)
    (<span class="org-keyword">let*</span> ((fr (<span class="org-keyword">or</span> frame (selected-frame)))
           (name (frame-parameter fr 'name))
           (flag (<span class="org-keyword">if</span> (string-equal name my/xmonad-emacs-sp-name) <span class="org-string">"-R"</span> <span class="org-string">"-a"</span>)))
      (call-process
       <span class="org-string">"wmctrl"</span> nil nil nil <span class="org-string">"-i"</span> flag
       (frame-parameter fr 'outer-window-id)))))

(advice-add 'raise-frame <span class="org-builtin">:after</span> 'my/wmctrl-raise-frame)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d24f62" class="outline-3">
<h3 id="org5d24f62"><span class="section-number-3">4.5</span> compilation</h3>
<div class="outline-text-3" id="text-4-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/fast-recompile-mode-map</span> (make-sparse-keymap))

(<span class="org-keyword">define-minor-mode</span> <span class="org-function-name">my/fast-recompile-mode</span>
  <span class="org-doc">"Minor mode for fast recompilation using C-c C-c"</span>
  <span class="org-builtin">:lighter</span> <span class="org-string">" rc"</span>
  <span class="org-builtin">:global</span> t
  <span class="org-builtin">:keymap</span> my/fast-recompile-mode-map
  (<span class="org-keyword">if</span> my/fast-recompile-mode
      (<span class="org-keyword">progn</span>
        (put 'my/-old-compilation-ask-about-save 'state compilation-ask-about-save)
        (<span class="org-keyword">setq</span> compilation-ask-about-save nil))
    (<span class="org-keyword">setq</span> compilation-ask-about-save (get 'my/-old-compilation-ask-about-save 'state))))

(define-key my/fast-recompile-mode-map (kbd <span class="org-string">"C-c C-c"</span>) #'recompile)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/compile-in-dir</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((default-directory (read-directory-name <span class="org-string">"Run command in: "</span>)))
    (call-interactively 'compile)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0832d50" class="outline-3">
<h3 id="org0832d50"><span class="section-number-3">4.6</span> Smartparens</h3>
<div class="outline-text-3" id="text-4-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">smartparens-config</span>
  <span class="org-builtin">:after</span> smartparens
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">don't create a pair with single quote in minibuffer</span>
  (sp-local-pair 'minibuffer-inactive-mode <span class="org-string">"'"</span> nil <span class="org-builtin">:actions</span> nil)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">because DataKinds</span>
  <span class="org-comment-delimiter">;;</span><span class="org-comment">(with-eval-after-load 'haskell-mode</span>
  <span class="org-comment-delimiter">;;  </span><span class="org-comment">(sp-local-pair 'haskell-mode "'" nil :actions nil))</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">indent after inserting any kinds of parens</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/smartparens-pair-newline-and-indent</span> (id action context)
    (<span class="org-keyword">save-excursion</span>
      (newline)
      (indent-according-to-mode))
    (indent-according-to-mode))
  (sp-pair <span class="org-string">"("</span> nil <span class="org-builtin">:post-handlers</span>
           '(<span class="org-builtin">:add</span> (my/smartparens-pair-newline-and-indent <span class="org-string">"RET"</span>)))
  (sp-pair <span class="org-string">"{"</span> nil <span class="org-builtin">:post-handlers</span>
           '(<span class="org-builtin">:add</span> (my/smartparens-pair-newline-and-indent <span class="org-string">"RET"</span>)))
  (sp-pair <span class="org-string">"["</span> nil <span class="org-builtin">:post-handlers</span>
           '(<span class="org-builtin">:add</span> (my/smartparens-pair-newline-and-indent <span class="org-string">"RET"</span>)))
  )

(<span class="org-keyword">use-package</span> <span class="org-constant">smartparens</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-init . show-smartparens-global-mode)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> smartparens-mode-map
              <span class="org-comment-delimiter">;; </span><span class="org-comment">paredit bindings</span>
              (<span class="org-string">"C-M-f"</span> . sp-forward-sexp)
              (<span class="org-string">"C-M-b"</span> . sp-backward-sexp)
              (<span class="org-string">"C-M-u"</span> . sp-backward-up-sexp)
              (<span class="org-string">"C-M-d"</span> . sp-down-sexp)
              (<span class="org-string">"C-M-p"</span> . sp-backward-down-sexp)
              (<span class="org-string">"C-M-n"</span> . sp-up-sexp)
              (<span class="org-string">"M-s"</span> . sp-splice-sexp)
              (<span class="org-string">"M-&lt;up&gt;"</span> . sp-splice-sexp-killing-backward)
              (<span class="org-string">"M-&lt;down&gt;"</span> . sp-splice-sexp-killing-forward)
              (<span class="org-string">"M-r"</span> . sp-splice-sexp-killing-around)
              (<span class="org-string">"M-("</span> . sp-wrap-round)
              (<span class="org-string">"C-)"</span> . sp-forward-slurp-sexp)
              (<span class="org-string">"C-&lt;right&gt;"</span> . sp-forward-slurp-sexp)
              (<span class="org-string">"C-}"</span> . sp-forward-barf-sexp)
              (<span class="org-string">"C-&lt;left&gt;"</span> . sp-forward-barf-sexp)
              (<span class="org-string">"C-("</span> . sp-backward-slurp-sexp)
              (<span class="org-string">"C-M-&lt;left&gt;"</span> . sp-backward-slurp-sexp)
              (<span class="org-string">"C-{"</span> . sp-backward-barf-sexp)
              (<span class="org-string">"C-M-&lt;right&gt;"</span> . sp-backward-barf-sexp)
              (<span class="org-string">"M-S"</span> . sp-split-sexp)
              <span class="org-comment-delimiter">;; </span><span class="org-comment">mine</span>
              (<span class="org-string">"C-M-k"</span> . sp-kill-sexp)
              (<span class="org-string">"C-M-w"</span> . sp-copy-sexp)
              )
  <span class="org-builtin">:diminish</span> smartparens-mode
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> sp-show-pair-delay <span class="org-highlight-numbers-number">0.2</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">avoid slowness when editing inside a comment for modes with</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">parenthesized comments (e.g. coq)</span>
        sp-show-pair-from-inside nil
        sp-cancel-autoskip-on-backward-movement nil
        sp-highlight-pair-overlay nil
        sp-highlight-wrap-overlay nil
        sp-highlight-wrap-tag-overlay nil)

  (<span class="org-keyword">my/add-hooks</span> '(emacs-lisp-mode-hook clojure-mode-hook)
                (smartparens-strict-mode)
                (evil-smartparens-mode))
  (<span class="org-keyword">my/add-hooks</span> '(prog-mode-hook coq-mode-hook comint-mode-hook css-mode-hook)
                (smartparens-mode)))

(<span class="org-keyword">use-package</span> <span class="org-constant">evil-smartparens</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> smartparens
  <span class="org-builtin">:diminish</span> evil-smartparens-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga03a86e" class="outline-3">
<h3 id="orga03a86e"><span class="section-number-3">4.7</span> Documentation &amp; help</h3>
<div class="outline-text-3" id="text-4-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">which-key</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-init . which-key-mode)
  <span class="org-builtin">:diminish</span> which-key-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0b72e3e" class="outline-3">
<h3 id="org0b72e3e"><span class="section-number-3">4.8</span> mark</h3>
<div class="outline-text-3" id="text-4-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/goto-line-show</span> ()
  <span class="org-doc">"Show line numbers temporarily, while prompting for the line number input."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((cur display-line-numbers))
    (<span class="org-keyword">unwind-protect</span>
        (<span class="org-keyword">progn</span>
          (<span class="org-keyword">setq</span> display-line-numbers t)
          (call-interactively #'goto-line))
      (<span class="org-keyword">setq</span> display-line-numbers cur))))

(global-set-key (kbd <span class="org-string">"M-g M-g"</span>) 'my/goto-line-show)

(define-key prog-mode-map (kbd <span class="org-string">"M-a"</span>) 'beginning-of-defun)
(define-key prog-mode-map (kbd <span class="org-string">"M-e"</span>) 'end-of-defun)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/push-mark-no-activate</span> ()
  <span class="org-doc">"Pushes `</span><span class="org-doc"><span class="org-constant">point</span></span><span class="org-doc">' to `</span><span class="org-doc"><span class="org-constant">mark-ring</span></span><span class="org-doc">' and does not activate the region</span>
<span class="org-doc">   Equivalent to \\[</span><span class="org-doc"><span class="org-constant">set-mark-command</span></span><span class="org-doc">] when \\[</span><span class="org-doc"><span class="org-constant">transient-mark-mode</span></span><span class="org-doc">] is disabled"</span>
  (<span class="org-keyword">interactive</span>)
  (push-mark (point) t nil)
  (message <span class="org-string">"Pushed mark to ring"</span>))

(global-set-key (kbd <span class="org-string">"C-`"</span>) 'my/push-mark-no-activate)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/jump-to-mark</span> ()
  <span class="org-doc">"Jumps to the local mark, respecting the `</span><span class="org-doc"><span class="org-constant">mark-ring</span></span><span class="org-doc">' order.</span>
<span class="org-doc">  This is the same as using \\[</span><span class="org-doc"><span class="org-constant">set-mark-command</span></span><span class="org-doc">] with the prefix argument."</span>
  (<span class="org-keyword">interactive</span>)
  (set-mark-command <span class="org-highlight-numbers-number">1</span>))

(global-set-key (kbd <span class="org-string">"M-`"</span>) 'my/jump-to-mark)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga899ff6" class="outline-3">
<h3 id="orga899ff6"><span class="section-number-3">4.9</span> imenu-list</h3>
<div class="outline-text-3" id="text-4-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">imenu-list</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-|"</span> . my/imenu-list-smart-toggle)
  <span class="org-builtin">:config</span>

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/imenu-list-jump-to-window</span> ()
    <span class="org-doc">"Jump to imenu-list window if visible, otherwise create it and jump."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">if</span> (get-buffer-window imenu-list-buffer-name)
        (select-window (get-buffer-window imenu-list-buffer-name))
      (<span class="org-keyword">progn</span>
        (imenu-list-minor-mode)
        (select-window (get-buffer-window imenu-list-buffer-name)))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/imenu-list-smart-toggle</span> ()
    <span class="org-doc">"If imenu-list window doesn't exist, create it and jump. If if does but</span>
<span class="org-doc">it is not the current buffer, jump there. If it exists and it's the current</span>
<span class="org-doc">buffer, close it."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">if</span> (eq (current-buffer) (get-buffer imenu-list-buffer-name))
        (imenu-list-quit-window)
      (my/imenu-list-jump-to-window)))

  (<span class="org-keyword">setq</span> imenu-list-size <span class="org-highlight-numbers-number">40</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd12488b" class="outline-3">
<h3 id="orgd12488b"><span class="section-number-3">4.10</span> abbrev etc</h3>
<div class="outline-text-3" id="text-4-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">dabbrev</span>
  <span class="org-builtin">:commands</span> (dabbrev-expand)
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't consider punctuation part of word for completion, helps complete</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">qualified symbols</span>
  (<span class="org-keyword">my/add-hooks</span>
   '(prog-mode-hook)
   (<span class="org-keyword">setq</span> dabbrev-abbrev-char-regexp <span class="org-string">"\\sw</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\s_</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\sw\\s."</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e0b7ac" class="outline-3">
<h3 id="org2e0b7ac"><span class="section-number-3">4.11</span> engine-mode</h3>
<div class="outline-text-3" id="text-4-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">engine-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-init . engine-mode)
  <span class="org-builtin">:bind-keymap</span> (<span class="org-string">"C-x /"</span> . engine-mode-map)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defengine</span> google
    <span class="org-string">"http://www.google.com/search?ie=utf-8&amp;oe=utf-8&amp;q=%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"g"</span>)

  (<span class="org-keyword">defengine</span> google-images
    <span class="org-string">"http://www.google.com/images?hl=en&amp;source=hp&amp;biw=1440&amp;bih=795&amp;gbv=2&amp;aq=f&amp;aqi=&amp;aql=&amp;oq=&amp;q=%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"i"</span>)

  (<span class="org-keyword">defengine</span> google-maps
    <span class="org-string">"http://maps.google.com/maps?q=%s"</span>)

  (<span class="org-keyword">defengine</span> wikipedia
    <span class="org-string">"http://www.wikipedia.org/search-redirect.php?language=en&amp;go=Go&amp;search=%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"w"</span>)

  (<span class="org-keyword">defengine</span> wiktionary
    <span class="org-string">"https://www.wikipedia.org/search-redirect.php?family=wiktionary&amp;language=en&amp;go=Go&amp;search=%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"d"</span>)

  (<span class="org-keyword">defengine</span> wolfram-alpha
    <span class="org-string">"http://www.wolframalpha.com/input/?i=%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"m"</span>)

  (<span class="org-keyword">defengine</span> youtube
    <span class="org-string">"http://www.youtube.com/results?aq=f&amp;oq=&amp;search_query=%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"v"</span>)

  (<span class="org-keyword">defengine</span> hoogle
    <span class="org-string">"https://hoogle.haskell.org/?hoogle=%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"h"</span>)

  (<span class="org-keyword">defengine</span> stackage
    <span class="org-string">"https://www.stackage.org/lts/hoogle?q=%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"s"</span>)

  (<span class="org-keyword">defengine</span> haskell-language-extensions
    <span class="org-string">"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"#"</span>)

  (<span class="org-keyword">defengine</span> pursuit
    <span class="org-string">"https://pursuit.purescript.org/search?q=%s"</span>
    <span class="org-builtin">:keybinding</span> <span class="org-string">"p"</span>)

  (<span class="org-keyword">defengine</span> coq-tactics
    <span class="org-string">"https://coq.inria.fr/refman/proof-engine/tactics.html#coq:tacn.%s"</span>)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf52f6e1" class="outline-3">
<h3 id="orgf52f6e1"><span class="section-number-3">4.12</span> anzu</h3>
<div class="outline-text-3" id="text-4-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">anzu</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-init . global-anzu-mode)
  <span class="org-builtin">:diminish</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> anzu-mode-lighter <span class="org-string">""</span>))

(<span class="org-keyword">use-package</span> <span class="org-constant">evil-anzu</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (evil anzu))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4679f2c" class="outline-3">
<h3 id="org4679f2c"><span class="section-number-3">4.13</span> math input</h3>
<div class="outline-text-3" id="text-4-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">xah-math-input</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-init . global-xah-math-input-mode)
  <span class="org-builtin">:commands</span> (xah-math-input-change-to-symbol)
  <span class="org-builtin">:diminish</span> xah-math-input-mode
  <span class="org-builtin">:config</span>
  (define-key xah-math-input-keymap (kbd <span class="org-string">"S-SPC"</span> ) nil)
  (define-key xah-math-input-keymap (kbd <span class="org-string">"S-C-SPC"</span>) 'xah-math-input-change-to-symbol)

  (puthash <span class="org-string">"::"</span> <span class="org-string">"&#8759;"</span> xah-math-input-abrvs)
  (puthash <span class="org-string">"bottom"</span> <span class="org-string">"&#8869;"</span> xah-math-input-abrvs))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga384dff" class="outline-3">
<h3 id="orga384dff"><span class="section-number-3">4.14</span> prettify symbols</h3>
<div class="outline-text-3" id="text-4-14">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">show original symbol when cursor is on it, or right next to it</span>
(<span class="org-keyword">setq</span> prettify-symbols-unprettify-at-point 'right-edge)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb147c20" class="outline-3">
<h3 id="orgb147c20"><span class="section-number-3">4.15</span> recentf</h3>
<div class="outline-text-3" id="text-4-15">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">recentf</span>
  <span class="org-builtin">:hook</span> (after-init . recentf-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> recentf-max-saved-items <span class="org-highlight-numbers-number">100</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org59eb65f" class="outline-3">
<h3 id="org59eb65f"><span class="section-number-3">4.16</span> hi-lock &amp; symbol overlay</h3>
<div class="outline-text-3" id="text-4-16">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">hi-lock</span>
  <span class="org-builtin">:hook</span> (after-init . global-hi-lock-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> hi-lock-face-defaults
        '(
          <span class="org-string">"hi-black-b"</span>
          <span class="org-string">"hi-red-b"</span>
          <span class="org-string">"hi-green-b"</span>
          <span class="org-string">"hi-blue-b"</span>
          <span class="org-string">"hi-green"</span>
          <span class="org-string">"hi-blue"</span>
          <span class="org-string">"hi-pink"</span>
          <span class="org-string">"hi-yellow"</span>
          ))
  (<span class="org-keyword">setq</span> hi-lock-auto-select-face t)
  <span class="org-builtin">:config</span>
  (define-key hi-lock-map (kbd <span class="org-string">"M-H"</span>) (lookup-key hi-lock-map (kbd <span class="org-string">"C-x w"</span>)))
  <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span><span class="org-comment">: find out why I can't just `</span><span class="org-comment"><span class="org-constant">define-key</span></span><span class="org-comment">'</span>
  (substitute-key-definition
   'highlight-regexp 'my/highlight-regexp hi-lock-map)

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/highlight-regexp</span> (regexp <span class="org-type">&amp;optional</span> face)
    (<span class="org-keyword">interactive</span>
     (list
      (hi-lock-regexp-okay
       (read-regexp <span class="org-string">"Regexp to highlight"</span> 'regexp-history-last))
      (hi-lock-read-face-name)))
    (<span class="org-keyword">or</span> (facep face) (<span class="org-keyword">setq</span> face 'hi-yellow))
    (<span class="org-keyword">unless</span> hi-lock-mode (hi-lock-mode <span class="org-highlight-numbers-number">1</span>))
    (hi-lock-set-pattern regexp face nil)))

(<span class="org-keyword">use-package</span> <span class="org-constant">symbol-overlay</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (symbol-overlay-mode)
  <span class="org-builtin">:diminish</span>
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">let</span> ((map (make-sparse-keymap)))
    (define-key map (kbd <span class="org-string">",i"</span>) 'symbol-overlay-put)
    (define-key map (kbd <span class="org-string">",d"</span>) 'symbol-overlay-remove-all)
    (define-key map (kbd <span class="org-string">"n"</span>) 'symbol-overlay-jump-next)
    (define-key map (kbd <span class="org-string">"p"</span>) 'symbol-overlay-jump-prev)
    (define-key map (kbd <span class="org-string">",q"</span>) 'symbol-overlay-query-replace)
    (define-key map (kbd <span class="org-string">",r"</span>) 'symbol-overlay-rename)
    (define-key map (kbd <span class="org-string">",w"</span>) 'symbol-overlay-save-symbol)
    (define-key map (kbd <span class="org-string">",s"</span>) 'symbol-overlay-isearch-literally)
    (<span class="org-keyword">setq</span> symbol-overlay-map map)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org10fe70b" class="outline-3">
<h3 id="org10fe70b"><span class="section-number-3">4.17</span> highlight keywords in some modes</h3>
<div class="outline-text-3" id="text-4-17">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defface</span> <span class="org-variable-name">my/special-keyword-face</span>
  '((t (<span class="org-builtin">:inherit</span> font-lock-keyword-face)))
  <span class="org-doc">"Face for highlighting special keywords"</span>
  <span class="org-builtin">:group</span> 'my/faces)

(<span class="org-keyword">defface</span> <span class="org-variable-name">my/special-comment-keyword-face</span>
  '((t (<span class="org-builtin">:inherit</span> font-lock-preprocessor-face)))
  <span class="org-doc">"Face for highlighting special keywords in comments"</span>
  <span class="org-builtin">:group</span> 'my/faces)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/highlight-keyword-in-mode</span> (mode kw <span class="org-type">&amp;optional</span> in-comment face)
  (<span class="org-keyword">let</span> ((fc (<span class="org-keyword">or</span> face (<span class="org-keyword">if</span> in-comment 'my/special-comment-keyword-face 'my/special-keyword-face)))
        (str (format <span class="org-string">"\\&lt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\&gt;"</span> kw)))
    (font-lock-add-keywords
     mode
     (<span class="org-keyword">if</span> in-comment
         `((,str <span class="org-highlight-numbers-number">1</span> ,`(<span class="org-keyword">quote</span> ,fc) prepend))
       `((,str . ,`(<span class="org-keyword">quote</span> ,fc)))))))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/comment-keywords</span>
  '(<span class="org-string">"</span><span class="org-string"><span class="org-myXspecial-comment-keyword">TODO</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-myXspecial-comment-keyword">NOTE</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-myXspecial-comment-keyword">FIXME</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-myXspecial-comment-keyword">WARNING</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-myXspecial-comment-keyword">HACK</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-myXspecial-comment-keyword">XXX</span></span><span class="org-string">"</span> <span class="org-string">"</span><span class="org-string"><span class="org-myXspecial-comment-keyword">DONE</span></span><span class="org-string">"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/highlight-comment-keywords</span> (mode <span class="org-type">&amp;optional</span> face)
  (<span class="org-keyword">dolist</span> (kw my/comment-keywords)
    (my/highlight-keyword-in-mode mode kw t face)))

(<span class="org-keyword">dolist</span>
    (mode '(haskell-mode
            literate-haskell-mode
            purescript-mode
            js2-mode
            html-mode
            python-mode
            idris-mode
            agda-mode
            rust-mode
            c-mode
            emacs-lisp-mode
            coq-mode
            markdown-mode
            ))
  (my/highlight-comment-keywords mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org155e65f" class="outline-3">
<h3 id="org155e65f"><span class="section-number-3">4.18</span> alignment</h3>
<div class="outline-text-3" id="text-4-18">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">align</span>
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-c \\"</span> . align-regexp)
  <span class="org-builtin">:config</span>
  (add-hook 'align-load-hook
            (<span class="org-keyword">lambda</span> ()
              (add-to-list 'align-rules-list
                           '(haskell-types
                             (regexp . <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\s-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">::</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">&#8759;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\s-+"</span>)
                             (modes quote (haskell-mode purescript-mode literate-haskell-mode))))
              (add-to-list 'align-rules-list
                           '(haskell-assignment
                             (regexp . <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\s-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">=\\s-+"</span>)
                             (modes quote (haskell-mode purescript-mode literate-haskell-mode))))
              (add-to-list 'align-rules-list
                           '(haskell-arrows
                             (regexp . <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\s-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">-&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">&#8594;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\s-+"</span>)
                             (modes quote (haskell-mode purescript-mode literate-haskell-mode))))
              (add-to-list 'align-rules-list
                           '(haskell-left-arrows
                             (regexp . <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\s-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">&lt;-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">&#8592;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\s-+"</span>)
                             (modes quote (haskell-mode purescript-mode literate-haskell-mode))))))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8e2beb" class="outline-3">
<h3 id="orgf8e2beb"><span class="section-number-3">4.19</span> temp project roots</h3>
<div class="outline-text-3" id="text-4-19">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/temp-project-root</span> nil)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/get-or-set-temp-root</span> (reset)
  (<span class="org-keyword">let*</span> ((reset-root (<span class="org-keyword">if</span> reset my/temp-project-root nil))
         (root
          (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> reset
                  (null my/temp-project-root)
                  (not (file-directory-p my/temp-project-root)))
              (read-directory-name <span class="org-string">"Temp root dir: "</span> reset-root)
            my/temp-project-root)))
    (<span class="org-keyword">setq</span> my/temp-project-root root)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2616ce3" class="outline-3">
<h3 id="org2616ce3"><span class="section-number-3">4.20</span> edit-indirect</h3>
<div class="outline-text-3" id="text-4-20">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">edit-indirect</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (edit-indirect-region)
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-c C-'"</span> . my/edit-indirect-region)
  <span class="org-builtin">:config</span>
  (add-hook 'edit-indirect-after-creation-hook 'my/edit-indirect-dedent)
  (add-hook 'edit-indirect-before-commit-hook 'my/edit-indirect-indent))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/edit-indirect-region</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (region-active-p) (<span class="org-warning">user-error</span> <span class="org-string">"No region selected"</span>))
  (<span class="org-keyword">save-excursion</span>
    (<span class="org-keyword">let*</span> ((begin (region-beginning))
           (end (region-end))
           (mode (my/select-a-major-mode))
           (edit-indirect-guess-mode-function
            (<span class="org-keyword">lambda</span> (_parent _beg _end)
              (funcall (intern mode)))))
      (edit-indirect-region begin end 'display-buffer))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/get-buffer-min-leading-spaces</span> (<span class="org-type">&amp;optional</span> buffer)
  (<span class="org-keyword">let*</span> ((buf (<span class="org-keyword">or</span> buffer (current-buffer)))
         (ind nil)
         )
    (<span class="org-keyword">save-excursion</span>
      (goto-char (point-min))
      (<span class="org-keyword">setq</span> ind (org-get-indentation))
      (<span class="org-keyword">while</span> (not (<span class="org-keyword">or</span> (evil-eobp) (eobp)))
        (<span class="org-keyword">unless</span> (string-match-p <span class="org-string">"\\`\\s-*$"</span> (thing-at-point 'line))
          (<span class="org-keyword">setq</span> ind (min ind (org-get-indentation))))
        (<span class="org-keyword">ignore-errors</span> (next-line))
        ))
    ind))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/edit-indirect-dedent</span> ()
  (<span class="org-keyword">let</span> ((amount (my/get-buffer-min-leading-spaces)))
    (<span class="org-keyword">setq-local</span> my/edit-indirect-dedented-amount amount)
    (<span class="org-keyword">save-excursion</span>
      (indent-rigidly (point-min) (point-max) (- amount)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/edit-indirect-indent</span> ()
  (<span class="org-keyword">when</span> (boundp 'my/edit-indirect-dedented-amount)
    (<span class="org-keyword">save-excursion</span>
      (indent-rigidly (point-min) (point-max) my/edit-indirect-dedented-amount))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3035110" class="outline-2">
<h2 id="org3035110"><span class="section-number-2">5</span> Term, eshell and comint-mode</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orga1cd7dd" class="outline-3">
<h3 id="orga1cd7dd"><span class="section-number-3">5.1</span> terms</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">term</span>
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">my/add-hooks</span>
   '(term-mode-hook)
   (define-key term-raw-map (kbd <span class="org-string">"M-o"</span>) nil)
   (define-key term-raw-map (kbd <span class="org-string">"M-+"</span>) nil))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">automatically close term buffers on EOF</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/term-exec-hook</span> ()
    (<span class="org-keyword">let*</span> ((buff (current-buffer))
           (proc (get-buffer-process buff)))
      (set-process-sentinel
       proc
       `(<span class="org-keyword">lambda</span> (process event)
          (<span class="org-keyword">if</span> (string= event <span class="org-string">"finished\n"</span>)
              (kill-buffer ,buff))))))
  (add-hook 'term-exec-hook 'my/term-exec-hook))

(<span class="org-keyword">use-package</span> <span class="org-constant">comint</span>
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> comint-prompt-read-only t)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/comint-clear-buffer</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((comint-buffer-maximum-size <span class="org-highlight-numbers-number">0</span>))
      (comint-truncate-buffer)))
  (add-hook 'comint-mode-hook
            (<span class="org-keyword">lambda</span> ()
              (define-key comint-mode-map (kbd <span class="org-string">"C-l"</span>) 'my/comint-clear-buffer))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f9c095" class="outline-3">
<h3 id="org6f9c095"><span class="section-number-3">5.2</span> eshell</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">em-hist</span> <span class="org-builtin">:after</span> eshell)

(<span class="org-keyword">use-package</span> <span class="org-constant">eshell</span>
  <span class="org-builtin">:commands</span> (eshell)
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-!"</span> . my/eshell-maybe-here)
         <span class="org-builtin">:map</span> eshell-mode-map
         (<span class="org-string">"C-l"</span> . my/eshell-clear))
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">eshell/clear doesn't work anymore because eshell has its own clear function</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/eshell-clear</span> ()
    (<span class="org-keyword">interactive</span>)
    <span class="org-string">"Clear the eshell buffer."</span>
    (<span class="org-keyword">let</span> ((eshell-buffer-maximum-lines <span class="org-highlight-numbers-number">0</span>))
      (eshell-truncate-buffer)))

  (<span class="org-keyword">defalias</span> '<span class="org-function-name">eshell/x</span> 'eshell/exit)
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">eshell/e</span> 'find-file)

  (<span class="org-keyword">setq</span> eshell-destroy-buffer-when-process-dies t
        eshell-history-size <span class="org-highlight-numbers-number">1024</span>
        eshell-prompt-regexp <span class="org-string">"^[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">#$]* [#$] "</span>)

  (<span class="org-keyword">setq</span> eshell-prompt-function
        (<span class="org-keyword">lambda</span> ()
          (concat
           (propertize
            ((<span class="org-keyword">lambda</span> (p-lst)
               (<span class="org-keyword">if</span> (&gt; (length p-lst) <span class="org-highlight-numbers-number">3</span>)
                   (concat
                    (mapconcat (<span class="org-keyword">lambda</span> (elm) (<span class="org-keyword">if</span> (zerop (length elm)) <span class="org-string">""</span>
                                               (substring elm <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">1</span>)))
                               (butlast p-lst <span class="org-highlight-numbers-number">3</span>)
                               <span class="org-string">"/"</span>)
                    <span class="org-string">"/"</span>
                    (mapconcat (<span class="org-keyword">lambda</span> (elm) elm)
                               (last p-lst <span class="org-highlight-numbers-number">3</span>)
                               <span class="org-string">"/"</span>))
                 (mapconcat (<span class="org-keyword">lambda</span> (elm) elm)
                            p-lst
                            <span class="org-string">"/"</span>)))
             (split-string (my/eshell-prompt-dir (eshell/pwd)) <span class="org-string">"/"</span>))
            'face
            'font-lock-type-face)
           (<span class="org-keyword">or</span> (my/eshell-prompt-git (eshell/pwd)))
           <span class="org-string">" "</span>
           (propertize <span class="org-string">"$"</span> 'face 'font-lock-function-name-face)
           (propertize <span class="org-string">" "</span> 'face 'default))))
  <span class="org-builtin">:config</span>
  (add-hook 'eshell-exit-hook 'delete-window)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't ask, just save</span>
  (<span class="org-keyword">if</span> (boundp 'eshell-save-history-on-exit)
      (<span class="org-keyword">setq</span> eshell-save-history-on-exit t))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">For older(?) version</span>
  (<span class="org-keyword">if</span> (boundp 'eshell-ask-to-save-history)
      (<span class="org-keyword">setq</span> eshell-ask-to-save-history 'always)))

(<span class="org-keyword">use-package</span> <span class="org-constant">em-smart</span>
  <span class="org-builtin">:after</span> eshell
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> eshell-where-to-jump 'begin
        eshell-review-quick-commands nil
        eshell-smart-space-goes-to-end t))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/eshell-maybe-here</span> (prompt)
  <span class="org-doc">"Opens up a new shell in the directory associated with the</span>
<span class="org-doc">current buffer's file. The eshell is renamed to match that</span>
<span class="org-doc">directory to make multiple eshell windows easier."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">let*</span> ((parent (<span class="org-keyword">if</span> prompt
                     (read-directory-name <span class="org-string">"Open eshell in: "</span>)
                   (<span class="org-keyword">if</span> (buffer-file-name)
                       (file-name-directory (buffer-file-name))
                     default-directory)))
         (height (/ (window-total-height) <span class="org-highlight-numbers-number">3</span>))
         (name (car (last (split-string parent <span class="org-string">"/"</span> t))))
         (bufname (format <span class="org-string">"*eshell:%s*"</span> name)))
    (split-window-vertically (- height))
    (other-window <span class="org-highlight-numbers-number">1</span>)
    (<span class="org-keyword">let</span> ((eshell-banner-message
           (format <span class="org-string">"eshell in %s\n\n"</span>
                   (propertize (abbreviate-file-name parent)
                               'face
                               'font-lock-keyword-face))))
      (eshell <span class="org-builtin">:new</span>))
    (rename-buffer (generate-new-buffer-name bufname))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">(insert "ls")</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">(eshell-send-input)</span>
    ))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/eshell-prompt-dir</span> (pwd)
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((home (expand-file-name (getenv <span class="org-string">"HOME"</span>)))
         (home-len (length home)))
    (<span class="org-keyword">if</span> (<span class="org-keyword">and</span>
         (&gt;= (length pwd) home-len)
         (equal home (substring pwd <span class="org-highlight-numbers-number">0</span> home-len)))
        (concat <span class="org-string">"~"</span> (substring pwd home-len))
      pwd)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/eshell-prompt-git</span> (cwd)
  <span class="org-doc">"Returns current git branch as a string, or the empty string if</span>
<span class="org-doc">CWD is not in a git repo (or the git command is not found)."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (eshell-search-path <span class="org-string">"git"</span>)
             (locate-dominating-file cwd <span class="org-string">".git"</span>))
    (<span class="org-keyword">let</span> ((git-output
           (shell-command-to-string
            (concat <span class="org-string">"cd "</span>
                    cwd
                    <span class="org-string">" &amp;&amp; git branch | grep '\\*' | sed -e 's/^\\* //'"</span>))))
      (concat
       (propertize
        (concat <span class="org-string">"["</span>
                (<span class="org-keyword">if</span> (&gt; (length git-output) <span class="org-highlight-numbers-number">0</span>)
                    (substring git-output <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">-1</span>)
                  <span class="org-string">"(no branch)"</span>)
                )
        'face 'font-lock-string-face)
       (my/git-collect-status cwd)
       (propertize <span class="org-string">"]"</span> 'face 'font-lock-string-face)
       )
      )))

<span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">https://github.com/xuchunyang/eshell-git-prompt/blob/master/eshell-git-prompt.el</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-collect-status</span> (cwd)
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (eshell-search-path <span class="org-string">"git"</span>)
             (locate-dominating-file cwd <span class="org-string">".git"</span>))
    (<span class="org-keyword">let</span> ((git-output
           (split-string
            (shell-command-to-string
             (concat <span class="org-string">"cd "</span>
                     cwd
                     <span class="org-string">" &amp;&amp; git status --porcelain"</span>))
            <span class="org-string">"\n"</span> t))
          (untracked <span class="org-highlight-numbers-number">0</span>)
          (modified <span class="org-highlight-numbers-number">0</span>)
          (modified-updated <span class="org-highlight-numbers-number">0</span>)
          (new-added <span class="org-highlight-numbers-number">0</span>)
          (deleted <span class="org-highlight-numbers-number">0</span>)
          (deleted-updated <span class="org-highlight-numbers-number">0</span>)
          (renamed-updated <span class="org-highlight-numbers-number">0</span>)
          (commits-ahead <span class="org-highlight-numbers-number">0</span>) <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span>
          (commits-behind <span class="org-highlight-numbers-number">0</span>) <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span>
          )
      (<span class="org-keyword">dolist</span> (x git-output)
        (<span class="org-keyword">pcase</span> (substring x <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">2</span>)
          (<span class="org-string">"??"</span> (<span class="org-keyword">cl-incf</span> untracked))
          (<span class="org-string">"MM"</span> (<span class="org-keyword">progn</span> (<span class="org-keyword">cl-incf</span> modified)
                       (<span class="org-keyword">cl-incf</span> modified-updated)))
          (<span class="org-string">" M"</span> (<span class="org-keyword">cl-incf</span> modified))
          (<span class="org-string">"M "</span> (<span class="org-keyword">cl-incf</span> modified-updated))
          (<span class="org-string">"A "</span> (<span class="org-keyword">cl-incf</span> new-added))
          (<span class="org-string">" D"</span> (<span class="org-keyword">cl-incf</span> deleted))
          (<span class="org-string">"D "</span> (<span class="org-keyword">cl-incf</span> deleted-updated))
          (<span class="org-string">"R "</span> (<span class="org-keyword">cl-incf</span> renamed-updated))
          ))
      (concat
       (propertize (<span class="org-keyword">if</span> (&gt; (+ untracked deleted) <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"&#8226;"</span> <span class="org-string">""</span>) 'face '(<span class="org-builtin">:foreground</span> <span class="org-string">"salmon3"</span>))
       (propertize (<span class="org-keyword">if</span> (&gt; modified <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"&#8226;"</span> <span class="org-string">""</span>) 'face '(<span class="org-builtin">:foreground</span> <span class="org-string">"goldenrod3"</span>))
       (propertize (<span class="org-keyword">if</span> (&gt; modified-updated <span class="org-highlight-numbers-number">0</span>) <span class="org-string">"&#8226;"</span> <span class="org-string">""</span>) 'face '(<span class="org-builtin">:foreground</span> <span class="org-string">"SeaGreen4"</span>))))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org04c3d76" class="outline-2">
<h2 id="org04c3d76"><span class="section-number-2">6</span> UI</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">highlight numbers</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">highlight-numbers</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> ((prog-mode haskell-cabal-mode css-mode) . highlight-numbers-mode))

<span class="org-comment-delimiter">;; </span><span class="org-comment">show column in modeline</span>
(<span class="org-keyword">setq</span> column-number-mode t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">disable annoying stuff</span>
(<span class="org-keyword">setq</span> ring-bell-function 'ignore
      inhibit-startup-message t
      inhibit-splash-screen t
      initial-scratch-message nil)
(menu-bar-mode <span class="org-highlight-numbers-number">-1</span>)
(scroll-bar-mode <span class="org-highlight-numbers-number">-1</span>)
(set-window-scroll-bars (minibuffer-window) nil nil)
(tool-bar-mode <span class="org-highlight-numbers-number">-1</span>)

(<span class="org-keyword">use-package</span> <span class="org-constant">linum</span>
  <span class="org-builtin">:if</span> (&lt; emacs-major-version <span class="org-highlight-numbers-number">26</span>)
  <span class="org-builtin">:init</span> (<span class="org-keyword">setq</span> linum-format 'dynamic))

(<span class="org-keyword">use-package</span> <span class="org-constant">hl-line</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:hook (prog-mode . hl-line-mode)</span>
  <span class="org-builtin">:commands</span> (hl-line-mode global-hl-line-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> hl-line-sticky-flag nil)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">my/hl-line-contrast</span> <span class="org-highlight-numbers-number">5</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/hl-line-set-bg</span> (<span class="org-type">&amp;optional</span> light-bg th)
    (<span class="org-keyword">let*</span> ((func (<span class="org-keyword">if</span> light-bg 'color-darken-name 'color-lighten-name))
           (bg (face-attribute 'default <span class="org-builtin">:background</span>))
           (theme (<span class="org-keyword">if</span> th th my/theme)))
      (custom-theme-set-faces
       theme
       `(hl-line ((t (<span class="org-builtin">:background</span> ,(funcall func bg my/hl-line-contrast)))))))))

(<span class="org-keyword">use-package</span> <span class="org-constant">display-fill-column-indicator</span>
  <span class="org-builtin">:if</span> (&gt;= emacs-major-version <span class="org-highlight-numbers-number">27</span>)
  <span class="org-builtin">:commands</span> (display-fill-column-indicator-mode)
  <span class="org-builtin">:hook</span> ((python-mode markdown-mode) . display-fill-column-indicator-mode))
</pre>
</div>
</div>

<div id="outline-container-org18814a6" class="outline-3">
<h3 id="org18814a6"><span class="section-number-3">6.1</span> highlight trailing whitespace</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">whitespace</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:diminish</span> whitespace-mode
  <span class="org-builtin">:diminish</span> global-whitespace-mode
  <span class="org-builtin">:hook</span> ((prog-mode . whitespace-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> whitespace-line-column <span class="org-highlight-numbers-number">80</span>
        whitespace-style '(face trailing)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org28bfd71" class="outline-2">
<h2 id="org28bfd71"><span class="section-number-2">7</span> Theme</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/after-set-theme</span> (<span class="org-type">&amp;optional</span> light-bg)
  (<span class="org-keyword">setq</span> my/theme-light-bg (<span class="org-keyword">if</span> light-bg t nil))
  (my/diff-hl-set-fringe-faces light-bg)
  (my/hl-line-set-bg light-bg)
  (my/org-set-src-faces light-bg))

(<span class="org-keyword">when</span> (&gt;= emacs-major-version <span class="org-highlight-numbers-number">27</span>)
  (<span class="org-keyword">setq</span> custom--inhibit-theme-enable nil))

<span class="org-comment-delimiter">;; </span><span class="org-comment">I am trying a lot of themes dammit</span>
(<span class="org-keyword">setq</span> my/all-themes
      '(
        (wombat
         (<span class="org-keyword">progn</span>
           (custom-theme-set-faces
            'wombat
            '(default ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#c7c7c7"</span> <span class="org-builtin">:background</span> <span class="org-string">"#1a1a1a"</span>))))
            '(font-lock-comment-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#828987"</span>))))
            '(font-lock-string-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#4096c9"</span>))))
            '(font-lock-doc-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#348dc1"</span>))))
            '(region ((t (<span class="org-builtin">:background</span> <span class="org-string">"#515151"</span>))))
            '(highlight ((t (<span class="org-builtin">:background</span> <span class="org-string">"#3a3a3a"</span>))))
            '(cursor ((t (<span class="org-builtin">:background</span> <span class="org-string">"#d8d8d8"</span>))))
            '(fringe ((t (<span class="org-builtin">:background</span> <span class="org-string">"#2e2e2e"</span>))))
            '(isearch ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#242424"</span> <span class="org-builtin">:background</span> <span class="org-string">"#e5786d"</span>))))
            '(vertical-border ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#b0b0b0"</span>))))
            '(show-paren-match ((t (<span class="org-builtin">:background</span> <span class="org-string">"steelblue4"</span> <span class="org-builtin">:weight</span> bold))))
            '(mode-line-buffer-id ((t (<span class="org-builtin">:weight</span> bold))))
            '(persp-selected-face ((t (<span class="org-builtin">:inherit</span> font-lock-string-face <span class="org-builtin">:weight</span> bold))))
            '(mode-line
              ((t (<span class="org-builtin">:background</span> <span class="org-string">"#454545"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#d1d1d1"</span> <span class="org-builtin">:box</span> (<span class="org-builtin">:line-width</span> <span class="org-highlight-numbers-number">1</span> <span class="org-builtin">:color</span> <span class="org-string">"#4a4a4a"</span>)))))
            '(mode-line-inactive
              ((t (<span class="org-builtin">:inherit</span> mode-line <span class="org-builtin">:background</span> <span class="org-string">"#282828"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#858585"</span>))))
            <span class="org-comment-delimiter">;; </span><span class="org-comment">'(-operator-face ((t (:foreground "#e5786d"))))</span>
            '(haskell-constructor-face ((t (<span class="org-builtin">:inherit</span> haskell-type-face <span class="org-builtin">:weight</span> normal))))
            '(ivy-grep-info ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#a4bd64"</span> <span class="org-builtin">:weight</span> bold))))
            '(ag-hit-face   ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#a4bd64"</span> <span class="org-builtin">:weight</span> bold))))
            '(sh-quoted-exec ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#72c8db"</span>))))
            )
           (my/after-set-theme)
           ))
        (zenburn
         (<span class="org-keyword">progn</span>
           (custom-theme-set-faces
            'zenburn
            '(default ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#dcdccc"</span> <span class="org-builtin">:background</span> <span class="org-string">"#3f3f3f"</span>))))
            '(region ((t (<span class="org-builtin">:background</span> <span class="org-string">"#5a5a5a"</span>))))
            '(vertical-border ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#a5a5a5"</span>))))
            '(fringe ((t (<span class="org-builtin">:background</span> <span class="org-string">"#454545"</span>))))
            '(mode-line ((t
                          (<span class="org-builtin">:box</span>
                           (<span class="org-builtin">:line-width</span> <span class="org-highlight-numbers-number">-1</span> <span class="org-builtin">:color</span> nil <span class="org-builtin">:style</span> released-button)
                           <span class="org-builtin">:foreground</span> <span class="org-string">"#a2c6a2"</span> <span class="org-builtin">:background</span> <span class="org-string">"#454545"</span>))))
            '(mode-line-inactive ((t
                                   (<span class="org-builtin">:box</span>
                                    (<span class="org-builtin">:line-width</span> <span class="org-highlight-numbers-number">-1</span> <span class="org-builtin">:color</span> nil <span class="org-builtin">:style</span> released-button)
                                    <span class="org-builtin">:foreground</span> <span class="org-string">"#5F7F5F"</span> <span class="org-builtin">:background</span> <span class="org-string">"#353535"</span>))))
            '(powerline-active0 ((t (<span class="org-builtin">:background</span> <span class="org-string">"#5F5F5F"</span> <span class="org-builtin">:inherit</span> mode-line))))
            '(powerline-active1 ((t (<span class="org-builtin">:inherit</span> mode-line))))
            '(powerline-active2 ((t (<span class="org-builtin">:background</span> <span class="org-string">"#383838"</span> <span class="org-builtin">:inherit</span> mode-line))))
            '(powerline-inactive0 ((t (<span class="org-builtin">:inherit</span> mode-line-inactive))))
            '(powerline-inactive1 ((t (<span class="org-builtin">:inherit</span> mode-line-inactive))))
            '(powerline-inactive2 ((t (<span class="org-builtin">:inherit</span> mode-line-inactive))))
            '(mode-line-buffer-id ((t (<span class="org-builtin">:weight</span> bold))))
            '(persp-selected-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#d0bf8f"</span> <span class="org-builtin">:weight</span> bold))))
            '(diff-hl-insert ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#789c78"</span> <span class="org-builtin">:background</span> <span class="org-string">"#3c543c"</span>))))
            '(diff-hl-change ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#79b3b5"</span> <span class="org-builtin">:background</span> <span class="org-string">"#425f61"</span>))))
            '(diff-hl-delete ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#ab8080"</span> <span class="org-builtin">:background</span> <span class="org-string">"#694848"</span>))))
            '(fill-column-indicator ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#5a5a5a"</span>))))
            )
           (my/hl-line-set-bg) (my/org-set-src-faces)
           (<span class="org-keyword">setq</span> pdf-view-midnight-colors '(<span class="org-string">"#dcdccc"</span> . <span class="org-string">"#383838"</span>))
           ))
        (darktooth
         (<span class="org-keyword">progn</span>
           (custom-theme-set-faces
            'darktooth
            '(default ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#ddd7b4"</span> <span class="org-builtin">:background</span> <span class="org-string">"#222222"</span>))))
            '(fringe ((t (<span class="org-builtin">:background</span> <span class="org-string">"#2d2d2d"</span>))))
            '(persp-selected-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#8ec07c"</span> <span class="org-builtin">:weight</span> bold))))
            <span class="org-comment-delimiter">;; </span><span class="org-comment">'(font-lock-function-name-face ((t (:foreground "#74b8bc"))))</span>
            '(font-lock-function-name-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#afa08b"</span>))))
            '(font-lock-preprocessor-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#d787af"</span>))))
            '(purescript-constructor-face ((t (<span class="org-builtin">:inherit</span> haskell-constructor-face))))
            '(mode-line ((t (<span class="org-builtin">:box</span> nil <span class="org-builtin">:foreground</span> <span class="org-string">"#e5dfbc"</span> <span class="org-builtin">:background</span> <span class="org-string">"#4d4845"</span>))))
            '(mode-line-inactive ((t (<span class="org-builtin">:box</span> nil <span class="org-builtin">:foreground</span> <span class="org-string">"#968a79"</span> <span class="org-builtin">:background</span> <span class="org-string">"#33302d"</span>))))
            '(vertical-border ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#a89984"</span>))))
            '(markdown-pre-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#8ec07c"</span>))))
            '(anzu-mode-line ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"magenta"</span> <span class="org-builtin">:weight</span> bold))))
            '(anzu-mode-line-no-match ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"red"</span> <span class="org-builtin">:weight</span> bold))))
            '(powerline-active0 ((t (<span class="org-builtin">:background</span> <span class="org-string">"#696461"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#e5dfbc"</span>))))
            '(powerline-active1 ((t (<span class="org-builtin">:background</span> <span class="org-string">"#55504d"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#e5dfbc"</span>))))
            '(powerline-active2 ((t (<span class="org-builtin">:background</span> <span class="org-string">"#433f3e"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#e5dfbc"</span>))))
            '(powerline-inactive0 ((t (<span class="org-builtin">:inherit</span> mode-line-inactive))))
            '(powerline-inactive1 ((t (<span class="org-builtin">:inherit</span> powerline-inactive0))))
            '(powerline-inactive2 ((t (<span class="org-builtin">:inherit</span> powerline-inactive0))))
            '(fill-column-indicator ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#464646"</span>))))
            )
           (my/after-set-theme)
           (<span class="org-keyword">setq</span> pdf-view-midnight-colors '(<span class="org-string">"#ddd7b4"</span> . <span class="org-string">"#3d3d3d"</span>))
           ))
        (nord
         (<span class="org-keyword">progn</span>
           (custom-theme-set-faces
            'nord
            '(default ((t (<span class="org-builtin">:background</span> <span class="org-string">"#1c222b"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#b6c1d3"</span>))))
            '(mode-line ((t (<span class="org-builtin">:background</span> <span class="org-string">"#3f4758"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#9ac9d7"</span>))))
            '(mode-line-inactive ((t (<span class="org-builtin">:background</span> <span class="org-string">"#2f343f"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#5e7591"</span>))))
            '(powerline-inactive0 ((t (<span class="org-builtin">:inherit</span> mode-line-inactive))))
            '(powerline-inactive1 ((t (<span class="org-builtin">:inherit</span> mode-line-inactive))))
            '(powerline-inactive2 ((t (<span class="org-builtin">:inherit</span> mode-line-inactive))))
            '(font-lock-doc-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#97aa86"</span>))))
            '(font-lock-preprocessor-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#D08770"</span>))))
            '(font-lock-variable-name-face ((t (<span class="org-builtin">:inherit</span> default))))
            '(font-lock-comment-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#707c95"</span>))))
            '(font-lock-comment-delimiter-face ((t (<span class="org-builtin">:inherit</span> font-lock-comment-face))))
            '(highlight-numbers-number ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#B48EAD"</span>))))
            '(haskell-pragma-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#B48EAD"</span>))))
            '(persp-selected-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#A3BE8C"</span> <span class="org-builtin">:weight</span> bold))))
            '(fringe ((t (<span class="org-builtin">:background</span> <span class="org-string">"#202830"</span>))))
            '(region ((t (<span class="org-builtin">:background</span> <span class="org-string">"#3b4353"</span>))))
            '(shadow ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#545d72"</span>))))
            '(show-paren-match ((t (<span class="org-builtin">:background</span> <span class="org-string">"#465d75"</span> <span class="org-builtin">:weight</span> bold))))
            '(lazy-highlight ((t (<span class="org-builtin">:background</span> <span class="org-string">"#496665"</span>))))
            '(fill-column-indicator ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#434c5e"</span>))))
            '(markdown-code-face ((t (<span class="org-builtin">:inherit</span> font-lock-string-face))))
            '(rg-match-face ((t (<span class="org-builtin">:background</span> <span class="org-string">"#35535b"</span>))))
            '(hi-green ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"black"</span> <span class="org-builtin">:background</span> <span class="org-string">"#859c73"</span>))))
            '(hi-blue ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"black"</span> <span class="org-builtin">:background</span> <span class="org-string">"#7da9b5"</span>))))
            '(hi-pink ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"black"</span> <span class="org-builtin">:background</span> <span class="org-string">"#a37f9d"</span>))))
            '(hi-green-b ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#9cb586"</span> <span class="org-builtin">:background</span> <span class="org-string">"#3b4732"</span> <span class="org-builtin">:weight</span> bold))))
            '(hi-blue-b ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#97c4c3"</span> <span class="org-builtin">:background</span> <span class="org-string">"#394b4f"</span> <span class="org-builtin">:weight</span> bold))))
            '(hi-red-b ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#bf95b7"</span> <span class="org-builtin">:background</span> <span class="org-string">"#453341"</span> <span class="org-builtin">:weight</span> bold))))
            )
           (my/after-set-theme)
           ))
        ))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/avail-themes</span> '(wombat))
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/current-theme</span> <span class="org-highlight-numbers-number">0</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/theme</span> 'wombat)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/theme-light-bg</span> nil)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/after-set-theme-hook</span> nil
  <span class="org-doc">"Hook called after setting a theme"</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/set-theme</span> (<span class="org-type">&amp;optional</span> theme-config light-bg)
  (<span class="org-keyword">let*</span> ((theme-config (<span class="org-keyword">if</span> (null theme-config)
                           (elt my/avail-themes my/current-theme)
                         theme-config))
         (theme (<span class="org-keyword">if</span> (listp theme-config)
                    (car theme-config)
                  theme-config))
         (config (<span class="org-keyword">if</span> (listp theme-config) (cadr theme-config) nil))
         (light-bg (<span class="org-keyword">if</span> (listp theme-config)
                       (caddr theme-config)
                     light-bg)))
    (mapc 'disable-theme custom-enabled-themes)
    (load-theme theme t)
    (<span class="org-keyword">setq</span> my/theme theme)
    (<span class="org-keyword">setq</span> my/theme-light-bg light-bg)
    (eval config)
    (run-hooks 'my/after-set-theme-hook)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/toggle-theme</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((next-theme (mod (1+ my/current-theme) (length my/avail-themes)))
         (theme (elt my/avail-themes next-theme)))
    (<span class="org-keyword">setq</span> my/current-theme next-theme)
    (my/set-theme)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/refresh-theme</span> ()
  (<span class="org-keyword">interactive</span>)
  (my/set-theme)
  (<span class="org-keyword">setq</span> linum-format 'dynamic))
</pre>
</div>
</div>
</div>

<div id="outline-container-org098cf03" class="outline-2">
<h2 id="org098cf03"><span class="section-number-2">8</span> Font</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/avail-fonts</span> '((<span class="org-string">"Monospace"</span> <span class="org-highlight-numbers-number">12</span>)))
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/current-font</span> <span class="org-highlight-numbers-number">0</span>)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/current-font-size</span> nil)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/font-size-step</span> <span class="org-highlight-numbers-number">0.5</span>)

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/after-set-font-hook</span> nil
  <span class="org-doc">"Hook called after updating fonts"</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/set-font</span> (<span class="org-type">&amp;optional</span> spec)
  (<span class="org-keyword">let*</span> ((spec (<span class="org-keyword">if</span> (null spec) (elt my/avail-fonts my/current-font) spec))
         (name (car spec))
         (size (cadr spec))
         (spacing (<span class="org-keyword">or</span> (caddr spec) <span class="org-highlight-numbers-number">0</span>)))
    (set-face-font 'default (format <span class="org-string">"%s-%s"</span> name size))
    (<span class="org-keyword">setq-default</span> line-spacing spacing)
    (<span class="org-keyword">setq</span> line-spacing spacing)
    (run-hooks 'my/after-set-font-hook)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/toggle-font</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((next-font (mod (1+ my/current-font) (length my/avail-fonts))))
    (<span class="org-keyword">setq</span> my/current-font-size nil)
    (my/set-font (elt my/avail-fonts next-font))
    (<span class="org-keyword">setq</span> my/current-font next-font)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/refresh-font</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">setq</span> my/current-font-size nil)
  (my/set-font (elt my/avail-fonts my/current-font)))

<span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">NOTE</span></span><span class="org-comment">: trying this out</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my/change-font-size</span> (<span class="org-type">&amp;optional</span> dec)
  (<span class="org-keyword">let*</span> ((spec (elt my/avail-fonts my/current-font))
         (name (car spec))
         (size (<span class="org-keyword">or</span> my/current-font-size (cadr spec))))
    (<span class="org-keyword">setq</span> my/current-font-size
          (<span class="org-keyword">if</span> dec
              (- size my/font-size-step)
            (+ size my/font-size-step)))
    (my/set-font (list name my/current-font-size))))

(global-set-key (kbd <span class="org-string">"C-+"</span>) #'(lambda () (<span class="org-keyword">interactive</span>) (my/change-font-size)))
(global-set-key (kbd <span class="org-string">"C--"</span>) #'(lambda () (<span class="org-keyword">interactive</span>) (my/change-font-size <span class="org-builtin">:dec</span>)))
(global-set-key (kbd <span class="org-string">"C-x C-0"</span>) #'my/refresh-font)

<span class="org-comment-delimiter">;; </span><span class="org-comment">size &amp; scaling</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq text-scale-mode-step 1.05)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(define-key global-map (kbd "C-+") 'text-scale-increase)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(define-key global-map (kbd "C--") 'text-scale-decrease)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2388c22" class="outline-2">
<h2 id="org2388c22"><span class="section-number-2">9</span> VCS</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-orgf780a8f" class="outline-3">
<h3 id="orgf780a8f"><span class="section-number-3">9.1</span> vc</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">vc</span>
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-x v p"</span> . my/vc-project)
         (<span class="org-string">"C-x v d"</span> . vc-diff))
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">prot</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/vc-project</span> ()
    (<span class="org-keyword">interactive</span>)
    (vc-dir (vc-root-dir)))
  <span class="org-builtin">:config</span>
  (define-key diff-mode-map (kbd <span class="org-string">"M-o"</span>) nil))

(<span class="org-keyword">use-package</span> <span class="org-constant">vc-git</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> vc-git-print-log-follow t))

(<span class="org-keyword">use-package</span> <span class="org-constant">vc-annotate</span>
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-x v a"</span> . vc-annotate)
         <span class="org-builtin">:map</span> vc-annotate-mode-map
         (<span class="org-string">"t"</span> . vc-annotate-toggle-annotation-visibility))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> vc-annotate-display-mode 'scale))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge588e49" class="outline-3">
<h3 id="orge588e49"><span class="section-number-3">9.2</span> magit</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/magit-set-diff-faces</span> ()
  (custom-theme-set-faces
   my/theme
   '(magit-diff-added-highlight ((t (<span class="org-builtin">:background</span> <span class="org-string">"#3f5f3f"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#afd8af"</span>))))
   '(magit-diff-removed-highlight ((t (<span class="org-builtin">:background</span> <span class="org-string">"#7c4343"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#ecb3b3"</span>))))
   '(magit-diff-added ((t (<span class="org-builtin">:background</span> <span class="org-string">"#2f4f2f"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#9fc59f"</span>))))
   '(magit-diff-removed ((t (<span class="org-builtin">:background</span> <span class="org-string">"#6c3333"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#dca3a3"</span>))))
   ))

(<span class="org-keyword">use-package</span> <span class="org-constant">magit</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (magit-status
             magit-dispatch-popup
             magit-blame-addition
             magit-log-buffer-file)
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-x g"</span> . magit-status)
         (<span class="org-string">"C-x M-g"</span> . magit-dispatch-popup))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">magb</span> 'magit-blame-addition)
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">gl</span>   'magit-log-buffer-file)
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">magl</span> 'magit-log-buffer-file)
  <span class="org-builtin">:config</span>
  (add-hook 'magit-blame-mode-hook
            (<span class="org-keyword">lambda</span> ()
              (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not (boundp 'magit-blame-mode))
                      magit-blame-mode)
                  (evil-emacs-state)
                (evil-exit-emacs-state)))))

(<span class="org-keyword">use-package</span> <span class="org-constant">magit-todos</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> magit
  <span class="org-builtin">:config</span>
  (magit-todos-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfbf676" class="outline-3">
<h3 id="orgdfbf676"><span class="section-number-3">9.3</span> git-timemachine</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">git-timemachine</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (git-timemachine)
  <span class="org-builtin">:config</span>
  (add-hook
   'git-timemachine-mode-hook
   '(lambda () (evil-local-mode <span class="org-highlight-numbers-number">-1</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd4a18e" class="outline-3">
<h3 id="orgfd4a18e"><span class="section-number-3">9.4</span> diff-hl &amp; git-gutter+</h3>
<div class="outline-text-3" id="text-9-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/diff-hl-set-fringe-faces</span> (<span class="org-type">&amp;optional</span> light-bg th)
  (<span class="org-keyword">let*</span> ((dark (not light-bg))
         (ins-bg (<span class="org-keyword">if</span> dark <span class="org-string">"#143514"</span> <span class="org-string">"#b9e0b3"</span>))
         (ins-fg (<span class="org-keyword">if</span> dark <span class="org-string">"#2b872b"</span> <span class="org-string">"#194219"</span>))
         (ch-bg (<span class="org-keyword">if</span> dark <span class="org-string">"#122544"</span> <span class="org-string">"#b5d8f4"</span>))
         (ch-fg (<span class="org-keyword">if</span> dark <span class="org-string">"#4171c1"</span> <span class="org-string">"#2b4775"</span>))
         (del-bg (<span class="org-keyword">if</span> dark <span class="org-string">"#491111"</span> <span class="org-string">"#f4b5b5"</span>))
         (del-fg (<span class="org-keyword">if</span> dark <span class="org-string">"#bc4d4d"</span> <span class="org-string">"#561a1a"</span>))
         (theme (<span class="org-keyword">if</span> th th my/theme)))
    (custom-theme-set-faces
     theme
     `(diff-hl-insert ((t (<span class="org-builtin">:background</span> ,ins-bg <span class="org-builtin">:foreground</span> ,ins-fg))))
     `(diff-hl-change ((t (<span class="org-builtin">:background</span> ,ch-bg <span class="org-builtin">:foreground</span> ,ch-fg))))
     `(diff-hl-delete ((t (<span class="org-builtin">:background</span> ,del-bg <span class="org-builtin">:foreground</span> ,del-fg)))))))

(<span class="org-keyword">use-package</span> <span class="org-constant">diff-hl</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> is-gui
  <span class="org-builtin">:hook</span> ((after-init . global-diff-hl-mode)
         (dired-mode . diff-hl-dired-mode))
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">https://github.com/dgutov/diff-hl#magit</span>
  (add-hook 'magit-post-refresh-hook 'diff-hl-magit-post-refresh))

(<span class="org-keyword">use-package</span> <span class="org-constant">git-gutter+</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:unless</span> is-gui
  <span class="org-builtin">:diminish</span>
  <span class="org-builtin">:hook</span> (after-init . global-git-gutter+-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc882db5" class="outline-3">
<h3 id="orgc882db5"><span class="section-number-3">9.5</span> Helpers</h3>
<div class="outline-text-3" id="text-9-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-blame-current-line</span> ()
  <span class="org-doc">"Runs `git blame` on the current line and</span>
<span class="org-doc">   adds the commit id to the kill ring"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((line-number (<span class="org-keyword">save-excursion</span>
                        (goto-char (point-at-bol))
                        (+ <span class="org-highlight-numbers-number">1</span> (count-lines <span class="org-highlight-numbers-number">1</span> (point)))))
         (line-arg (format <span class="org-string">"%d,%d"</span> line-number line-number))
         (commit-buf (generate-new-buffer <span class="org-string">"*git-blame-line-commit*"</span>)))
    (call-process <span class="org-string">"git"</span> nil commit-buf nil
                  <span class="org-string">"blame"</span> (buffer-file-name) <span class="org-string">"-L"</span> line-arg)
    (<span class="org-keyword">let*</span> ((commit-id (<span class="org-keyword">with-current-buffer</span> commit-buf
                        (buffer-substring <span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">9</span>)))
           (log-buf (generate-new-buffer <span class="org-string">"*git-blame-line-log*"</span>)))
      (kill-new commit-id)
      (call-process <span class="org-string">"git"</span> nil log-buf nil
                    <span class="org-string">"log"</span> <span class="org-string">"-1"</span> <span class="org-string">"--pretty=%h   %an   %s"</span> commit-id)
      (<span class="org-keyword">with-current-buffer</span> log-buf
        (message <span class="org-string">"Line %d: %s"</span>
                 line-number
                 (replace-regexp-in-string <span class="org-string">"\n\\'"</span> <span class="org-string">""</span> (buffer-string))))
      (kill-buffer log-buf))
    (kill-buffer commit-buf)))

(global-set-key (kbd <span class="org-string">"M-L"</span>) #'my/git-blame-current-line)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb4d0b4" class="outline-2">
<h2 id="orgfb4d0b4"><span class="section-number-2">10</span> keybindings</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-orgd31d8fb" class="outline-3">
<h3 id="orgd31d8fb"><span class="section-number-3">10.1</span> keybind to command mapping</h3>
<div class="outline-text-3" id="text-10-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> my/leader-keys
      '(
        (<span class="org-string">"SPC"</span> display-fill-column-indicator-mode)

        (<span class="org-string">"a"</span> align-regexp)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">dired</span>
        (<span class="org-string">"dn"</span> find-name-dired)
        (<span class="org-string">"dg"</span> find-grep-dired)
        (<span class="org-string">"dv"</span> my/git-grep-dired)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">errors</span>
        (<span class="org-string">"el"</span> my/toggle-flycheck-error-list)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">browsing/files</span>
        (<span class="org-string">"fc"</span> my/copy-file-path)
        (<span class="org-string">"fd"</span> pwd)
        (<span class="org-string">"fp"</span> my/try-open-dominating-file)
        (<span class="org-string">"fs"</span> my/create-scratch-buffer-with-mode)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">git/vc</span>
        (<span class="org-string">"gb"</span> my/git-blame-current-line)

        (<span class="org-string">"h"</span>  help)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">insert</span>
        (<span class="org-string">"iu"</span> counsel-unicode-char)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">project</span>
        (<span class="org-string">"pa"</span> counsel-projectile-ag)
        (<span class="org-string">"pr"</span> counsel-projectile-rg)
        (<span class="org-string">"ps"</span> my/rg-project-or-ask)
        (<span class="org-string">"pt"</span> my/counsel-ag-todos-global)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">show/display</span>
        (<span class="org-string">"sd"</span> pwd)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">find/search</span>
        (<span class="org-string">"sa"</span> ag)
        (<span class="org-string">"sr"</span> rg)
        (<span class="org-string">"sca"</span> counsel-ag)
        (<span class="org-string">"scr"</span> counsel-rg)
        (<span class="org-string">"sr"</span> rgrep)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">toggle</span>
        (<span class="org-string">"t8"</span> display-fill-column-indicator-mode)
        (<span class="org-string">"tc"</span> global-company-mode)
        (<span class="org-string">"tf"</span> my/toggle-font)
        (<span class="org-string">"tg"</span> global-diff-hl-mode)
        (<span class="org-string">"tl"</span> my/line-numbers)
        (<span class="org-string">"to"</span> symbol-overlay-mode)
        (<span class="org-string">"th"</span> hl-line-mode)
        (<span class="org-string">"ts"</span> flycheck-mode)
        (<span class="org-string">"tt"</span> my/toggle-theme)
        (<span class="org-string">"tw"</span> toggle-truncate-lines)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">ui</span>
        (<span class="org-string">"uh"</span> rainbow-mode)
        (<span class="org-string">"um"</span> (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (call-interactively 'tool-bar-mode) (call-interactively 'menu-bar-mode)))
        (<span class="org-string">"up"</span> rainbow-delimiters-mode)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">windows</span>
        (<span class="org-string">"wf"</span> my/window-fixed)
        (<span class="org-string">"wd"</span> my/window-dedicated)

        <span class="org-comment-delimiter">;; </span><span class="org-comment">theme</span>
        (<span class="org-string">"Ts"</span> counsel-load-theme)

        (<span class="org-string">"Q"</span> evil-local-mode)
        ))
</pre>
</div>
</div>
</div>

<div id="outline-container-org66204e6" class="outline-3">
<h3 id="org66204e6"><span class="section-number-3">10.2</span> setup keybindings</h3>
<div class="outline-text-3" id="text-10-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-prefix-command 'my/leader-map)

<span class="org-comment-delimiter">;; </span><span class="org-comment">(define-key ctl-x-map "m" 'my/leader-map)</span>
(define-prefix-command 'my/leader-map)
(global-set-key (kbd <span class="org-string">"C-c m"</span>) 'my/leader-map)

(<span class="org-keyword">dolist</span> (i my/leader-keys)
  (<span class="org-keyword">let</span> ((k (car i))
        (f (cadr i)))
    (define-key my/leader-map (kbd k) f)))

(define-prefix-command 'my/major-mode-map)

(<span class="org-keyword">if</span> is-gui
    (<span class="org-keyword">progn</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">distinguish `C-m` from `RET`</span>
      (define-key input-decode-map [?\C-m] [C-m])
      <span class="org-comment-delimiter">;; </span><span class="org-comment">distinguish `C-i` from `TAB`</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">(define-key input-decode-map [?\C-i] [C-i])</span>
      (global-set-key (kbd <span class="org-string">"C-c &lt;C-m&gt;"</span>) 'my/leader-map)
      (<span class="org-keyword">setq</span> my/major-mode-map-key <span class="org-string">"&lt;C-m&gt;"</span>))
  (<span class="org-keyword">setq</span> my/major-mode-map-key <span class="org-string">"C-c m m"</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">on hold</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(defun my/define-major-mode-keys (hook &amp;rest combinations)</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">"Bind all pairs of (key . function) under `</span><span class="org-comment"><span class="org-constant">my/major-mode-map-key</span></span><span class="org-comment">'</span>
<span class="org-comment-delimiter">;;</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">The keys are bound after `</span><span class="org-comment"><span class="org-constant">hook</span></span><span class="org-comment">'."</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(add-hook</span>
<span class="org-comment-delimiter">;;    </span><span class="org-comment">hook</span>
<span class="org-comment-delimiter">;;    </span><span class="org-comment">`(lambda ()</span>
<span class="org-comment-delimiter">;;       </span><span class="org-comment">(let ((map (make-sparse-keymap)))</span>
<span class="org-comment-delimiter">;;         </span><span class="org-comment">(local-set-key (kbd ,my/major-mode-map-key) map)</span>
<span class="org-comment-delimiter">;;         </span><span class="org-comment">(dolist (comb (quote ,combinations))</span>
<span class="org-comment-delimiter">;;           </span><span class="org-comment">(define-key map (kbd (car comb)) (cdr comb)))))))</span>

(<span class="org-keyword">defun</span> <span class="org-function-name">my/define-major-mode-key</span> (mode key func)
  (<span class="org-keyword">let*</span> ((map-symbol (intern (format <span class="org-string">"my/%s-map"</span> mode)))
         (hook (intern (format <span class="org-string">"%s-hook"</span> mode)))
         (map
          (<span class="org-keyword">if</span> (boundp map-symbol)
              (symbol-value map-symbol)
            (<span class="org-keyword">progn</span>
              (<span class="org-keyword">let</span> ((map- (make-sparse-keymap)))
                (add-hook
                 hook
                 `(<span class="org-keyword">lambda</span> ()
                    (local-set-key (kbd ,my/major-mode-map-key) (<span class="org-keyword">quote</span> ,map-))))
                (set (intern (format <span class="org-string">"my/%s-map"</span> mode)) map-))))))
    (define-key map (kbd key) func)
    (evil-leader/set-key-for-mode mode (kbd (format <span class="org-string">"m %s"</span> key)) func)))

(<span class="org-keyword">if</span> is-gui
    (global-set-key (kbd <span class="org-string">"&lt;C-m&gt;"</span>) 'my/major-mode-map)
  (global-set-key (kbd <span class="org-string">"C-c m m"</span>) 'my/major-mode-map))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org29ec215" class="outline-2">
<h2 id="org29ec215"><span class="section-number-2">11</span> evil-mode</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-org510a7b2" class="outline-3">
<h3 id="org510a7b2"><span class="section-number-3">11.1</span> evil-mode setup</h3>
<div class="outline-text-3" id="text-11-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil-leader</span>
  <span class="org-builtin">:hook</span> (evil-local-mode . evil-leader-mode)
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(global-evil-leader-mode)</span>
  (evil-leader/set-leader <span class="org-string">"&lt;SPC&gt;"</span>)
  (<span class="org-keyword">dolist</span> (i my/leader-keys)
    (<span class="org-keyword">let</span> ((k (car i))
          (f (cadr i)))
      (evil-leader/set-key k f))))

(<span class="org-keyword">use-package</span> <span class="org-constant">evil-visualstar</span>
  <span class="org-builtin">:hook</span> (evil-local-mode . evil-visualstar-mode)
  <span class="org-builtin">:ensure</span> t)

(<span class="org-keyword">use-package</span> <span class="org-constant">evil</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> ((prog-mode
          text-mode
          haskell-cabal-mode
          coq-mode easycrypt-mode phox-mode
          conf-unix-mode
          conf-colon-mode
          conf-space-mode
          conf-windows-mode
          conf-toml-mode)
         . evil-local-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> evil-want-C-i-jump nil
        evil-intercept-esc t
        evil-mode-line-format '(before . mode-line-front-space))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq evil-move-cursor-back nil)  ;; works better with lisp navigation</span>
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/make-emacs-mode</span> (mode)
    <span class="org-doc">"Make `</span><span class="org-doc"><span class="org-constant">mode</span></span><span class="org-doc">' use emacs keybindings."</span>
    (delete mode evil-insert-state-modes)
    (add-to-list 'evil-emacs-state-modes mode))

  (global-set-key (kbd <span class="org-string">"&lt;f5&gt;"</span>) 'evil-local-mode)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">don't need C-n, C-p</span>
  (define-key evil-insert-state-map (kbd <span class="org-string">"C-n"</span>) nil)
  (define-key evil-insert-state-map (kbd <span class="org-string">"C-p"</span>) nil)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">magit</span>
  (<span class="org-keyword">evil-define-key</span> 'normal magit-blame-mode-map (kbd <span class="org-string">"q"</span>) 'magit-blame-quit)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">intercept ESC when running in terminal</span>
  (evil-esc-mode)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">move search result to center of the screen</span>
  (<span class="org-keyword">defadvice</span> <span class="org-function-name">evil-search-next</span>
      (after advice-for-evil-search-next activate)
    (evil-scroll-line-to-center (line-number-at-pos)))

  (<span class="org-keyword">defadvice</span> <span class="org-function-name">evil-search-previous</span>
      (after advice-for-evil-search-previous activate)
    (evil-scroll-line-to-center (line-number-at-pos)))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">this is needed to be able to use C-h</span>
  (global-set-key (kbd <span class="org-string">"C-h"</span>) 'help)
  (define-key evil-normal-state-map (kbd <span class="org-string">"C-h"</span>) 'undefined)
  (define-key evil-insert-state-map (kbd <span class="org-string">"C-h"</span>) 'undefined)
  (define-key evil-visual-state-map (kbd <span class="org-string">"C-h"</span>) 'undefined)

  (define-key evil-emacs-state-map (kbd <span class="org-string">"C-h"</span>) 'help)
  (define-key evil-insert-state-map (kbd <span class="org-string">"C-k"</span>) nil)

  (define-key evil-normal-state-map (kbd <span class="org-string">"M-."</span>) nil)

  (define-key evil-normal-state-map (kbd <span class="org-string">"C-h"</span>) 'evil-window-left)
  (define-key evil-normal-state-map (kbd <span class="org-string">"C-j"</span>) 'evil-window-down)
  (define-key evil-normal-state-map (kbd <span class="org-string">"C-k"</span>) 'evil-window-up)
  (define-key evil-normal-state-map (kbd <span class="org-string">"C-l"</span>) 'evil-window-right)

  (define-key evil-normal-state-map (kbd <span class="org-string">";"</span>) 'evil-ex)
  (define-key evil-visual-state-map (kbd <span class="org-string">";"</span>) 'evil-ex)
  (<span class="org-keyword">evil-ex-define-cmd</span> <span class="org-string">"sv"</span> 'evil-window-split)

  (define-key evil-normal-state-map (kbd <span class="org-string">"C-p"</span>) 'counsel-projectile-find-file)

  (define-key evil-insert-state-map (kbd <span class="org-string">"C-M-i"</span>) 'company-complete)

  (define-key evil-visual-state-map (kbd <span class="org-string">"&lt;"</span>) #'(lambda ()
                                                  (<span class="org-keyword">interactive</span>)
                                                  (<span class="org-keyword">progn</span>
                                                    (call-interactively 'evil-shift-left)
                                                    (execute-kbd-macro <span class="org-string">"gv"</span>))))

  (define-key evil-visual-state-map (kbd <span class="org-string">"&gt;"</span>) #'(lambda ()
                                                  (<span class="org-keyword">interactive</span>)
                                                  (<span class="org-keyword">progn</span>
                                                    (call-interactively 'evil-shift-right)
                                                    (execute-kbd-macro <span class="org-string">"gv"</span>))))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">redefine so that $ doesn't include the EOL char</span>
  (<span class="org-keyword">setq</span> my/evil-$-include-eol nil)
  (<span class="org-keyword">evil-define-motion</span> <span class="org-function-name">evil-end-of-line</span> (count)
    <span class="org-doc">"Move the cursor to the end of the current line.</span>

<span class="org-doc">If COUNT is given, move COUNT - 1 lines downward first."</span>
    <span class="org-builtin">:type</span> inclusive
    (move-end-of-line count)
    (<span class="org-keyword">when</span> evil-track-eol
      (<span class="org-keyword">setq</span> temporary-goal-column most-positive-fixnum
            this-command 'next-line))
    (<span class="org-keyword">unless</span> (<span class="org-keyword">and</span> (evil-visual-state-p) my/evil-$-include-eol)
      (evil-adjust-cursor)
      (<span class="org-keyword">when</span> (eolp)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">prevent "c$" and "d$" from deleting blank lines</span>
        (<span class="org-keyword">setq</span> evil-this-type 'exclusive))))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">https://github.com/emacs-evil/evil-surround/issues/141</span>
  (<span class="org-keyword">defmacro</span> <span class="org-function-name">my/evil-define-text-object</span> (name key start-regex end-regex)
    (<span class="org-keyword">let</span> ((inner-name (make-symbol (concat <span class="org-string">"evil-inner-"</span> name)))
          (outer-name (make-symbol (concat <span class="org-string">"evil-a-"</span> name))))
      `(<span class="org-keyword">progn</span>
         (<span class="org-keyword">evil-define-text-object</span> ,inner-name (count <span class="org-type">&amp;optional</span> beg end type)
           (evil-select-paren ,start-regex ,end-regex beg end type count nil))
         (<span class="org-keyword">evil-define-text-object</span> ,outer-name (count <span class="org-type">&amp;optional</span> beg end type)
           (evil-select-paren ,start-regex ,end-regex beg end type count t))
         (define-key evil-inner-text-objects-map ,key #',inner-name)
         (define-key evil-outer-text-objects-map ,key #',outer-name))))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org28c70c2" class="outline-3">
<h3 id="org28c70c2"><span class="section-number-3">11.2</span> evil packages that can be used without evil-mode</h3>
<div class="outline-text-3" id="text-11-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">evil-nerd-commenter</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-string">"M-;"</span> . evilnc-comment-or-uncomment-lines)
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">evilnc toggles instead of commenting/uncommenting</span>
  (<span class="org-keyword">setq</span> evilnc-invert-comment-line-by-line t))

(<span class="org-keyword">use-package</span> <span class="org-constant">evil-surround</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-init . global-evil-surround-mode)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">evil-define-key</span> 'visual evil-surround-mode-map <span class="org-string">"s"</span> 'evil-surround-region)
  (<span class="org-keyword">defconst</span> <span class="org-variable-name">my/mark-active-alist</span>
    `((mark-active
       ,@(<span class="org-keyword">let</span> ((m (make-sparse-keymap)))
           (define-key m (kbd <span class="org-string">"C-c s"</span>) 'evil-surround-region)
           m))))
  (add-to-list 'emulation-mode-map-alists 'my/mark-active-alist))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2048338" class="outline-2">
<h2 id="org2048338"><span class="section-number-2">12</span> Hybrid input mode</h2>
<div class="outline-text-2" id="text-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'evil
  (<span class="org-keyword">defcustom</span> <span class="org-variable-name">hybrid-mode-default-state</span> 'normal
    <span class="org-doc">"Value of `</span><span class="org-doc"><span class="org-constant">evil-default-state</span></span><span class="org-doc">' for hybrid-mode."</span>
    <span class="org-builtin">:group</span> 'my
    <span class="org-builtin">:type</span> 'symbol)

  (<span class="org-keyword">defcustom</span> <span class="org-variable-name">hybrid-mode-enable-evilified-state</span> t
    <span class="org-doc">"If non nil then evilified states is enabled in buffer supporting it."</span>
    <span class="org-builtin">:group</span> 'my
    <span class="org-builtin">:type</span> 'boolean)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">hybrid-mode-default-state-backup</span> evil-default-state
    <span class="org-doc">"Backup of `</span><span class="org-doc"><span class="org-constant">evil-default-state</span></span><span class="org-doc">'."</span>)

  (<span class="org-keyword">defadvice</span> <span class="org-function-name">evil-insert-state</span> (around hybrid-insert-to-hybrid-state disable)
    <span class="org-doc">"Forces Hybrid state."</span>
    (evil-hybrid-state))

  (<span class="org-keyword">defadvice</span> <span class="org-function-name">evil-evilified-state</span> (around hybrid-evilified-to-hybrid-state disable)
    <span class="org-doc">"Forces Hybrid state."</span>
    (<span class="org-keyword">if</span> (equal <span class="org-highlight-numbers-number">-1</span> (ad-get-arg <span class="org-highlight-numbers-number">0</span>))
        ad-do-it
      (<span class="org-keyword">if</span> hybrid-mode-enable-evilified-state
          ad-do-it
        <span class="org-comment-delimiter">;; </span><span class="org-comment">seems better to set the emacs state instead of hybrid for evilified</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">buffers</span>
        (evil-emacs-state))))

<span class="org-comment-delimiter">;;;</span><span class="org-comment">###</span><span class="org-comment"><span class="org-warning">autoload</span></span>
  (<span class="org-keyword">define-minor-mode</span> <span class="org-function-name">hybrid-mode</span>
    <span class="org-doc">"Global minor mode to replace insert state by hybrid state."</span>
    <span class="org-builtin">:global</span> t
    <span class="org-builtin">:lighter</span> <span class="org-string">""</span>
    <span class="org-builtin">:group</span> 'my
    (<span class="org-keyword">if</span> hybrid-mode
        (enable-hybrid-editing-style)
      (disable-hybrid-editing-style)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">enable-hybrid-editing-style</span> ()
    <span class="org-doc">"Enable the hybrid editing style."</span>
    (<span class="org-keyword">setq</span> hybrid-mode-default-state-backup evil-default-state
          evil-default-state hybrid-mode-default-state)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">replace evil states by `hybrid state'</span>
    (ad-enable-advice 'evil-insert-state
                      'around 'hybrid-insert-to-hybrid-state)
    (ad-enable-advice 'evil-evilified-state
                      'around 'hybrid-evilified-to-hybrid-state)
    (ad-activate 'evil-insert-state)
    (ad-activate 'evil-evilified-state)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">key bindings hooks for dynamic switching of editing styles</span>
    (run-hook-with-args 'spacemacs-editing-style-hook 'hybrid)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">initiate `hybrid state'</span>
    )

  (<span class="org-keyword">defun</span> <span class="org-function-name">disable-hybrid-editing-style</span> ()
    <span class="org-doc">"Disable the hybrid editing style (reverting to 'vim style)."</span>
    (<span class="org-keyword">setq</span> evil-default-state hybrid-mode-default-state-backup)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">restore evil states</span>
    (ad-disable-advice 'evil-insert-state
                       'around 'hybrid-insert-to-hybrid-state)
    (ad-disable-advice 'evil-evilified-state
                       'around 'hybrid-evilified-to-hybrid-state)
    (ad-activate 'evil-insert-state)
    (ad-activate 'evil-evilified-state)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">restore key bindings</span>
    (run-hook-with-args 'spacemacs-editing-style-hook 'vim)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">restore the states</span>
    )

  <span class="org-comment-delimiter">;; </span><span class="org-comment">This code is from evil insert state definition, any change upstream</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">should be reflected here</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">see https://github.com/emacs-evil/evil/blob/56e92f7cb4e04e665670460093b41f58446b7a2b/evil-states.el#L108</span>
  (<span class="org-keyword">evil-define-state</span> <span class="org-function-name">hybrid</span>
    <span class="org-doc">"Hybrid state for hybrid mode."</span>
    <span class="org-builtin">:tag</span> <span class="org-string">" &lt;I&gt; "</span>
    <span class="org-builtin">:cursor</span> (bar . <span class="org-highlight-numbers-number">2</span>)
    <span class="org-builtin">:message</span> <span class="org-string">"-- HYBRID --"</span>
    <span class="org-builtin">:entry-hook</span> (evil-start-track-last-insertion)
    <span class="org-builtin">:exit-hook</span> (evil-cleanup-insert-state evil-stop-track-last-insertion)
    <span class="org-builtin">:input-method</span> t
    (<span class="org-keyword">cond</span>
     ((evil-hybrid-state-p)
      (add-hook 'post-command-hook #'evil-maybe-remove-spaces)
      (add-hook 'pre-command-hook #'evil-insert-repeat-hook)
      (<span class="org-keyword">setq</span> evil-maybe-remove-spaces t)
      (<span class="org-keyword">unless</span> (eq evil-want-fine-undo t)
        (evil-start-undo-step)))
     (t
      (remove-hook 'post-command-hook #'evil-maybe-remove-spaces)
      (remove-hook 'pre-command-hook #'evil-insert-repeat-hook)
      (evil-maybe-remove-spaces t)
      (<span class="org-keyword">setq</span> evil-insert-repeat-info evil-repeat-info)
      (evil-set-marker ?^ nil t)
      (<span class="org-keyword">unless</span> (eq evil-want-fine-undo t)
        (evil-end-undo-step))
      (<span class="org-keyword">when</span> evil-move-cursor-back
        (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (evil-normal-state-p evil-next-state)
                  (evil-motion-state-p evil-next-state))
          (evil-move-cursor-back))))))

  (define-key evil-hybrid-state-map [escape] 'evil-normal-state)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Override stock evil function `</span><span class="org-comment"><span class="org-constant">evil-insert-state-p</span></span><span class="org-comment">'</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">evil-insert-state-p</span> (<span class="org-type">&amp;optional</span> state)
    <span class="org-doc">"Whether the current state is insert."</span>
    (<span class="org-keyword">and</span> evil-local-mode
         (memq (<span class="org-keyword">or</span> state evil-state) '(insert hybrid))))

  (define-key evil-hybrid-state-map [escape] 'evil-normal-state)
  (define-key evil-hybrid-state-map (kbd <span class="org-string">"C-w"</span>) 'evil-delete-backward-word)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6d4de2" class="outline-2">
<h2 id="orga6d4de2"><span class="section-number-2">13</span> Spell checking</h2>
<div class="outline-text-2" id="text-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">flyspell</span>
  <span class="org-builtin">:commands</span> (flyspell-mode flyspell-prog-mode)
  <span class="org-builtin">:config</span>
  (add-hook 'flyspell-mode-hook
            (<span class="org-keyword">lambda</span> () (add-hook 'hack-local-variables-hook 'flyspell-buffer))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org83695ed" class="outline-2">
<h2 id="org83695ed"><span class="section-number-2">14</span> Buffer &amp; window management</h2>
<div class="outline-text-2" id="text-14">
</div>
<div id="outline-container-org8606e28" class="outline-3">
<h3 id="org8606e28"><span class="section-number-3">14.1</span> ibuffer</h3>
<div class="outline-text-3" id="text-14-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">ibuffer</span>
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">`/ R` to toggle showing these groups</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">`/ \` to disable</span>
  (<span class="org-keyword">setq-default</span> ibuffer-saved-filter-groups
                `((<span class="org-string">"Default"</span>
                   (<span class="org-string">"rg"</span> (name . <span class="org-string">"</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">*rg.*</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">*"</span>))
                   (<span class="org-string">"Dired"</span> (mode . dired-mode))
                   (<span class="org-string">"Scratch"</span> (name . <span class="org-string">"</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">*scratch.*"</span>))
                   (<span class="org-string">"Temporary"</span> (name . <span class="org-string">"</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">*.*</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">*"</span>))
                   )))
  (<span class="org-keyword">setq</span> ibuffer-show-empty-filter-groups nil)
  <span class="org-builtin">:config</span>
  (define-key ibuffer-mode-map (kbd <span class="org-string">"M-o"</span>) nil)
  (global-set-key (kbd <span class="org-string">"C-x C-b"</span>) 'ibuffer)
  (add-hook 'ibuffer-mode-hook #'(lambda () (ibuffer-auto-mode <span class="org-highlight-numbers-number">1</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd747847" class="outline-3">
<h3 id="orgd747847"><span class="section-number-3">14.2</span> avy</h3>
<div class="outline-text-3" id="text-14-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">avy</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-c i"</span> . avy-goto-line))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ce9e0a" class="outline-3">
<h3 id="org1ce9e0a"><span class="section-number-3">14.3</span> ace-window</h3>
<div class="outline-text-3" id="text-14-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">ace-window</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-c o"</span> . ace-window)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> aw-dispatch-always nil
        aw-keys (string-to-list <span class="org-string">"asdfghjkl;"</span>))
  <span class="org-builtin">:config</span>
  (custom-set-faces
   '(aw-leading-char-face ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"magenta"</span> <span class="org-builtin">:background</span> <span class="org-string">"gray16"</span> <span class="org-builtin">:weight</span> bold <span class="org-builtin">:height</span> <span class="org-highlight-numbers-number">1.8</span>))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf041f7d" class="outline-3">
<h3 id="orgf041f7d"><span class="section-number-3">14.4</span> buffer-move</h3>
<div class="outline-text-3" id="text-14-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">buffer-move</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> ((<span class="org-string">"&lt;C-S-up&gt;"</span> . buf-move-up)
         (<span class="org-string">"&lt;C-S-down&gt;"</span> . buf-move-down)
         (<span class="org-string">"&lt;C-S-left&gt;"</span> . buf-move-left)
         (<span class="org-string">"&lt;C-S-right&gt;"</span> . buf-move-right)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f75b84" class="outline-3">
<h3 id="org7f75b84"><span class="section-number-3">14.5</span> zoom</h3>
<div class="outline-text-3" id="text-14-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">zoom</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-string">"M-+"</span> . zoom)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> zoom-size '(<span class="org-highlight-numbers-number">190</span> . <span class="org-highlight-numbers-number">92</span>)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5f8a8fc" class="outline-2">
<h2 id="org5f8a8fc"><span class="section-number-2">15</span> dired</h2>
<div class="outline-text-2" id="text-15">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">dired</span>
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> dired-mode-map
              (<span class="org-string">"j"</span> . dired-next-line)
              (<span class="org-string">"J"</span> . dired-next-dirline)
              (<span class="org-string">"k"</span> . dired-previous-line)
              (<span class="org-string">"K"</span> . dired-prev-dirline)
              (<span class="org-string">"h"</span> . backward-char)
              (<span class="org-string">"l"</span> . forward-char)
              (<span class="org-string">"C-c n"</span> . my/dired-find-file-ace)
              (<span class="org-string">"M-j"</span> . my/dired-file-jump-from-here)
              (<span class="org-string">"M-u"</span> . dired-up-directory)
              (<span class="org-string">"C-c C-q"</span> . my/dired-kill-all-buffers))
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">hide files being edited &amp; flycheck files from dired</span>
  (<span class="org-keyword">setq</span> dired-omit-files <span class="org-string">"\\`[.]?#</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">\\`.flycheck_"</span>
        dired-omit-verbose nil)
  <span class="org-builtin">:config</span>
  (add-hook 'dired-mode-hook #'auto-revert-mode)
  (add-hook 'dired-mode-hook #'dired-omit-mode)

  (define-key dired-mode-map
    (kbd <span class="org-string">"C-c v"</span>)
    (<span class="org-keyword">my/control-function-window-split</span>
     dired-find-file-other-window
     nil <span class="org-highlight-numbers-number">0</span>))
  (define-key dired-mode-map
    (kbd <span class="org-string">"C-c s"</span>)
    (<span class="org-keyword">my/control-function-window-split</span>
     dired-find-file-other-window
     <span class="org-highlight-numbers-number">0</span> nil)))

(<span class="org-keyword">use-package</span> <span class="org-constant">dired-sidebar</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (dired-sidebar-hide-sidebar
             dired-sidebar-showing-sidebar-p
             dired-sidebar-jump-to-sidebar
             dired-sidebar-toggle-sidebar
             dired-sidebar-toggle-with-current-directory)
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-\\"</span> . my/dired-sidebar-smart-toggle)
         <span class="org-builtin">:map</span> dired-sidebar-mode-map
         (<span class="org-string">"M-u"</span> . dired-sidebar-up-directory))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> dired-sidebar-theme 'none))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/dired-sidebar-smart-toggle</span> (curdir)
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">if</span> (eq major-mode 'dired-sidebar-mode)
      (dired-sidebar-hide-sidebar)
    (<span class="org-keyword">if</span> (dired-sidebar-showing-sidebar-p)
        (dired-sidebar-jump-to-sidebar)
      (<span class="org-keyword">if</span> curdir
          (dired-sidebar-toggle-with-current-directory)
        (dired-sidebar-toggle-sidebar)))))

(<span class="org-keyword">use-package</span> <span class="org-constant">dired-subtree</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> dired
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> dired-mode-map
              (<span class="org-string">"&lt;tab&gt;"</span> . dired-subtree-toggle)
              (<span class="org-string">"TAB"</span> . dired-subtree-toggle)))

(<span class="org-keyword">use-package</span> <span class="org-constant">dired-filter</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> dired)

(<span class="org-keyword">use-package</span> <span class="org-constant">dired-git-info</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> dired
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> dired-mode-map (<span class="org-string">")"</span> . dired-git-info-mode))
  <span class="org-builtin">:commands</span> (dired-git-info-mode))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/dired-find-file-ace</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((find-file-run-dired t)
        (fname (dired-get-file-for-visit)))
    (<span class="org-keyword">if</span> (ace-select-window)
        (find-file fname))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/dired-file-jump-from-here</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((find-file-run-dired t)
        (fname (dired-get-file-for-visit)))
    (my/counsel-file-jump-from-here fname)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/dired-kill-all-buffers</span> ()
  (<span class="org-keyword">interactive</span>)
  (mapc (<span class="org-keyword">lambda</span> (buf)
          (<span class="org-keyword">when</span> (eq 'dired-mode
                    (buffer-local-value 'major-mode buf))
            (kill-buffer buf)))
        (buffer-list)))

(<span class="org-keyword">use-package</span> <span class="org-constant">dired-x</span>
  <span class="org-builtin">:after</span> dired
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">if</span> is-mac (<span class="org-keyword">setq</span> dired-use-ls-dired nil)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">https://gist.github.com/surajacharya/4127526</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-grep-dired</span> (repo wildcards regexp)
  <span class="org-doc">"Find Git-controlled files in DIR with a name like WILDCARDS containing a regexp REGEXP and start Dired on output."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"DGit-grep (directory): \nsGit-grep (filename wildcard(s), e.g. *.xml): \nsGit-grep (grep regexp): "</span>)
  (<span class="org-keyword">setq</span> repo (file-name-as-directory (expand-file-name repo)))
  (switch-to-buffer (concat <span class="org-string">"*Git Grep "</span> repo <span class="org-string">"*"</span>))
  (fundamental-mode)
  (<span class="org-keyword">setq</span> buffer-read-only nil)
  (erase-buffer)
  (<span class="org-keyword">setq</span> default-directory repo)
  (<span class="org-keyword">let</span> ((cmd (format <span class="org-string">"git --git-dir %s/.git ls-files -z%s | xargs -0 grep -lZ -- %s | xargs -0 ls -l"</span>
                     repo
                     (apply 'concat (mapcar (<span class="org-keyword">lambda</span> (s) (concat <span class="org-string">" "</span> (shell-quote-argument s))) (split-string wildcards)))
                     (shell-quote-argument regexp))))
    (insert <span class="org-string">" "</span> cmd <span class="org-string">"\n "</span> repo <span class="org-string">":\n"</span>)
    (call-process-shell-command (concat cmd <span class="org-string">" | sed -e 's/^/ /g'"</span>) nil t))
  (dired-mode)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">(dired-build-subdir-alist)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">From find-dired:</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Set subdir-alist so that Tree Dired will work:</span>
  (<span class="org-keyword">if</span> (fboundp 'dired-simple-subdir-alist)
      <span class="org-comment-delimiter">;; </span><span class="org-comment">will work even with nested dired format (dired-nstd.el,v 1.15</span>
      <span class="org-comment-delimiter">;; </span><span class="org-comment">and later)</span>
      (dired-simple-subdir-alist)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">else we have an ancient tree dired (or classic dired, where</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">this does no harm)</span>
    (set (make-local-variable 'dired-subdir-alist)
         (list (cons default-directory (point-min-marker)))))
  (goto-line <span class="org-highlight-numbers-number">2</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org47d2b05" class="outline-2">
<h2 id="org47d2b05"><span class="section-number-2">16</span> nix</h2>
<div class="outline-text-2" id="text-16">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">nix-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.nix\\'"</span> . nix-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> nix-nixfmt-bin <span class="org-string">"nixpkgs-fmt"</span>)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">my/add-hooks</span> '(nix-mode-hook) (subword-mode <span class="org-highlight-numbers-number">1</span>))
  (my/define-major-mode-key 'nix-mode <span class="org-string">"s"</span> 'my/nix-format-and-save)
  (my/define-major-mode-key 'nix-mode <span class="org-string">"m"</span> 'my/nix-mark-multiline-string)
  (define-key nix-mode-map (kbd <span class="org-string">"C-c '"</span>) 'my/nix-edit-indirect-multiline-string))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/nix-format-and-save</span> ()
  (<span class="org-keyword">interactive</span>)
  (nix-format-buffer)
  (save-buffer))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/nix-mark-multiline-string</span> ()
  (<span class="org-keyword">interactive</span>)
  (deactivate-mark)
  (re-search-backward <span class="org-string">"''$"</span> nil t)
  (next-line)
  (beginning-of-line <span class="org-highlight-numbers-number">1</span>)
  (call-interactively 'set-mark-command)
  (re-search-forward <span class="org-string">"^\s*''"</span> nil t)
  (previous-line)
  (end-of-line <span class="org-highlight-numbers-number">1</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/nix-edit-indirect-multiline-string</span> ()
  (<span class="org-keyword">interactive</span>)
  (my/nix-mark-multiline-string)
  (my/edit-indirect-region))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6091940" class="outline-2">
<h2 id="org6091940"><span class="section-number-2">17</span> direnv</h2>
<div class="outline-text-2" id="text-17">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">direnv</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"direnv"</span>)
  <span class="org-builtin">:hook</span> (after-init . direnv-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> direnv-show-paths-in-summary nil
        direnv-always-show-summary nil)
  (<span class="org-keyword">unless</span> (fboundp 'file-attribute-size)
    (<span class="org-keyword">defun</span> <span class="org-function-name">file-attribute-size</span> (attrs) (elt attrs <span class="org-highlight-numbers-number">7</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org91fe7d8" class="outline-2">
<h2 id="org91fe7d8"><span class="section-number-2">18</span> Haskell</h2>
<div class="outline-text-2" id="text-18">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">haskell-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.hs\\'"</span> . haskell-mode)
         (<span class="org-string">"\\.lhs\\'"</span> . literate-haskell-mode)
         (<span class="org-string">"\\.cabal\\'"</span> . haskell-cabal-mode)
         (<span class="org-string">"\\.c2hs\\'"</span> . haskell-c2hs-mode)
         (<span class="org-string">"\\.hcr\\'"</span> . ghc-core-mode)
         (<span class="org-string">"\\.dump-simpl\\'"</span> . ghc-core-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> haskell-align-imports-pad-after-name t
        haskell-hoogle-command <span class="org-string">"hoogle --count=100"</span>
        haskell-interactive-popup-errors nil
        <span class="org-comment-delimiter">;; </span><span class="org-comment">choices: auto, ghci, cabal-repl, cabal-new-repl, stack-ghci</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">cabal-new-repl is the one to use with nix-shell &amp; direnv</span>
        haskell-process-type 'cabal-new-repl
        )

  (<span class="org-keyword">with-eval-after-load</span> 'evil
    (<span class="org-keyword">my/evil-define-text-object</span> <span class="org-string">"haskell-inline-comment"</span> <span class="org-string">"#"</span> <span class="org-string">"{- "</span> <span class="org-string">" -}"</span>))

  <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span><span class="org-comment">: sort out this shit</span>
  (<span class="org-keyword">with-eval-after-load</span> 'smartparens
    (<span class="org-keyword">with-eval-after-load</span> 'haskell-mode
      (sp-local-pair 'haskell-mode <span class="org-string">"'"</span> nil <span class="org-builtin">:actions</span> nil)))

  <span class="org-builtin">:config</span>
  (my/highlight-keyword-in-mode 'haskell-mode <span class="org-string">"error"</span> nil 'font-lock-preprocessor-face)
  (my/highlight-keyword-in-mode 'haskell-mode <span class="org-string">"undefined"</span> nil 'font-lock-preprocessor-face)

  (my/define-major-mode-key 'haskell-mode <span class="org-string">"aa"</span> 'my/haskell-align-and-sort-everything)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"ai"</span> 'my/haskell-align-and-sort-imports)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"al"</span> 'my/haskell-align-and-sort-language-extensions)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"c"</span> 'projectile-compile-project)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"d"</span> 'my/haskell-open-haddock-documentation)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"h"</span> 'hoogle)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"i"</span> 'my/haskell-insert-import)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"l"</span> 'my/haskell-insert-language-extension)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"o"</span> 'my/haskell-insert-ghc-option)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"r"</span> 'my/haskell-insert-ghcid-repl-statement)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"s"</span> 'my/haskell-format-and-save)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"/"</span> 'engine/search-hoogle)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"?"</span> 'engine/search-stackage)
  (my/define-major-mode-key 'haskell-mode <span class="org-string">"#"</span> 'engine/search-haskell-language-extensions)

  (<span class="org-keyword">my/add-hooks</span>
   '(haskell-mode-hook)
   (<span class="org-keyword">setq</span> evil-shift-width <span class="org-highlight-numbers-number">2</span>)
   (<span class="org-keyword">push</span> '(?# . (<span class="org-string">"{- "</span> . <span class="org-string">" -}"</span>)) evil-surround-pairs-alist)
   (haskell-decl-scan-mode)
   (subword-mode <span class="org-highlight-numbers-number">1</span>)
   )
  )

(<span class="org-keyword">use-package</span> <span class="org-constant">ormolu</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (ormolu-format
             ormolu-format-buffer
             ormolu-format-region
             ormolu-format-on-save-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> ormolu-extra-args
        '(<span class="org-string">"-o"</span> <span class="org-string">"-XTypeApplications"</span>
          <span class="org-string">"-o"</span> <span class="org-string">"-XInstanceSigs"</span>
          <span class="org-string">"-o"</span> <span class="org-string">"-XBangPatterns"</span>
          <span class="org-string">"-o"</span> <span class="org-string">"-XPatternSynonyms"</span>
          <span class="org-string">"-o"</span> <span class="org-string">"-XUnicodeSyntax"</span>
          )))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/haskell-align-stuff</span> t)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/haskell-use-ormolu</span> nil)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/haskell-format-brittany</span> ()
  (<span class="org-keyword">interactive</span>)
  (my/format-and-save <span class="org-string">"brittany"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/haskell-format-and-save</span> (use-ormolu)
  <span class="org-doc">"Formats the import statements using haskell-stylish and saves</span>
<span class="org-doc">the current file."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (save-buffer)
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> use-ormolu my/haskell-use-ormolu)
      (ormolu-format-buffer)
    (<span class="org-keyword">progn</span>
      (my/haskell-align-and-sort-imports)
      (my/haskell-align-and-sort-language-extensions)))
  (save-buffer))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/haskell-align-and-sort-imports</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">save-excursion</span>
    (goto-char <span class="org-highlight-numbers-number">0</span>)
    (<span class="org-keyword">let</span> ((n-runs <span class="org-highlight-numbers-number">0</span>)
          (max-runs <span class="org-highlight-numbers-number">10</span>))
      (<span class="org-keyword">while</span> (<span class="org-keyword">and</span> (&lt; n-runs max-runs)
                  (haskell-navigate-imports))
        (<span class="org-keyword">progn</span>
          (<span class="org-keyword">setq</span> n-runs (1+ n-runs))
          (<span class="org-keyword">when</span> my/haskell-align-stuff (call-interactively 'haskell-align-imports))
          (call-interactively 'haskell-sort-imports)))
      (<span class="org-keyword">if</span> (&gt;= n-runs max-runs)
          (message <span class="org-string">"Sorting/aligning imports probably timed out"</span>)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/-haskell-mark-language-extensions</span> ()
  (<span class="org-keyword">interactive</span>)
  (deactivate-mark)
  (goto-char <span class="org-highlight-numbers-number">0</span>)
  (re-search-forward <span class="org-string">"^{-# LANGUAGE"</span> nil t)
  (beginning-of-line <span class="org-highlight-numbers-number">1</span>)
  (call-interactively 'set-mark-command)
  (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"^{-# LANGUAGE"</span> nil t)
    nil)
  (end-of-line <span class="org-highlight-numbers-number">1</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/haskell-align-and-sort-language-extensions</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">save-excursion</span>
    (<span class="org-keyword">when</span> my/haskell-align-stuff
      (my/-haskell-mark-language-extensions)
      (align-regexp (region-beginning) (region-end) <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\s-*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">#-"</span>))
    (my/-haskell-mark-language-extensions)
    (sort-lines nil (region-beginning) (region-end))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/haskell-insert-language-extension</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((all-exts
          (split-string (shell-command-to-string <span class="org-string">"ghc --supported-languages"</span>)))
         (ext
          (completing-read <span class="org-string">"extension: "</span>
                           all-exts
                           nil nil nil nil nil)))
    (<span class="org-keyword">save-excursion</span>
      (goto-char <span class="org-highlight-numbers-number">0</span>)
      (re-search-forward <span class="org-string">"^{-#"</span> nil t)
      (beginning-of-line <span class="org-highlight-numbers-number">1</span>)
      (open-line <span class="org-highlight-numbers-number">1</span>)
      (insert (format <span class="org-string">"{-# LANGUAGE %s #-}"</span> ext))
      (my/haskell-align-and-sort-language-extensions))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/haskell-insert-ghc-option</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((all-opts
          (split-string (shell-command-to-string <span class="org-string">"ghc --show-options"</span>)))
         (ext
          (completing-read <span class="org-string">"option: "</span>
                           all-opts
                           nil nil nil nil nil)))
    (<span class="org-keyword">save-excursion</span>
      (goto-char <span class="org-highlight-numbers-number">0</span>)
      (re-search-forward <span class="org-string">"^module"</span> nil t)
      (beginning-of-line <span class="org-highlight-numbers-number">1</span>)
      (open-line <span class="org-highlight-numbers-number">1</span>)
      (insert (format <span class="org-string">"{-# OPTIONS_GHC %s #-}"</span> ext)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/haskell-align-and-sort-everything</span> ()
  (<span class="org-keyword">interactive</span>)
  (my/haskell-align-and-sort-imports)
  (my/haskell-align-and-sort-language-extensions))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/haskell-insert-ghcid-repl-statement</span> (new-line)
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">setq</span> current-prefix-arg nil)
  (<span class="org-keyword">when</span> new-line
    (end-of-line <span class="org-highlight-numbers-number">1</span>)
    (call-interactively 'newline))
  (beginning-of-line <span class="org-highlight-numbers-number">1</span>)
  (call-interactively 'delete-horizontal-space)
  (insert <span class="org-string">"-- $&gt; "</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/haskell-open-haddock-documentation</span> (use-eww)
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">let</span> ((url <span class="org-string">"https://haskell-haddock.readthedocs.io/en/latest/markup.html"</span>))
    (<span class="org-keyword">if</span> use-eww
        (eww url)
      (browse-url url))))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/ghc-source-path</span> (expand-file-name <span class="org-string">"~/sources/ghc/"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/visit-ghc-tags-table</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((tags (concat my/ghc-source-path <span class="org-string">"TAGS"</span>)))
    (<span class="org-keyword">if</span> (file-exists-p tags)
        (visit-tags-table tags)
      (<span class="org-warning">error</span> <span class="org-string">"No TAGS file found in ghc source directory"</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">intero</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> haskell-mode
  <span class="org-builtin">:commands</span> (intero-mode-blacklist)
  <span class="org-builtin">:hook</span> (haskell-mode . intero-mode-blacklist)
  <span class="org-builtin">:diminish</span> intero-mode
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> intero-blacklist '(<span class="org-string">"~/.xmonad"</span>))
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">pretty print (use :pretty, :prettyl, :no-pretty in ghci)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">this has to be installed in every repo until I find a solution</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq intero-extra-ghci-options '("-package" "pretty-simple"))</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">don't auto insert matching single quotes in haskell mode, since I</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">mostly use them for promoted data types</span>
  (define-key intero-mode-map (kbd <span class="org-string">"M-."</span>) nil)
  (sp-local-pair 'intero-repl-mode <span class="org-string">"'"</span> nil <span class="org-builtin">:actions</span> nil)

  (flycheck-add-next-checker 'intero '(t . haskell-hlint)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">dante</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> haskell-mode
  <span class="org-builtin">:commands</span> (dante-mode)
  <span class="org-builtin">:hook</span> (haskell-mode . dante-mode)
  <span class="org-builtin">:init</span>
  (add-hook 'dante-mode-hook
            '(lambda () (flycheck-add-next-checker
                         'haskell-dante
                         '(warning . haskell-hlint)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7d3a09" class="outline-2">
<h2 id="orge7d3a09"><span class="section-number-2">19</span> Purescript</h2>
<div class="outline-text-2" id="text-19">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">purescript-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.purs\\'"</span> . purescript-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> purescript-indent-offset <span class="org-highlight-numbers-number">2</span>
        purescript-align-imports-pad-after-name t)
  <span class="org-builtin">:config</span>
  (my/define-major-mode-key 'purescript-mode <span class="org-string">"a"</span> 'my/purescript-sort-and-align-imports)
  (my/define-major-mode-key 'purescript-mode <span class="org-string">"i"</span> 'purescript-navigate-imports)
  (my/define-major-mode-key 'purescript-mode <span class="org-string">"s"</span> 'my/purescript-format-and-save)
  (my/define-major-mode-key 'purescript-mode <span class="org-string">"/"</span> 'engine/search-pursuit)
  (add-hook
   'purescript-mode-hook
   (<span class="org-keyword">lambda</span> ()
     (<span class="org-keyword">setq</span> evil-shift-width <span class="org-highlight-numbers-number">2</span>)
     (turn-on-purescript-indentation)
     (turn-on-purescript-decl-scan)
     <span class="org-comment-delimiter">;; </span><span class="org-comment">(turn-on-purescript-font-lock)</span>
     (<span class="org-keyword">push</span> '(?# . (<span class="org-string">"{- "</span> . <span class="org-string">" -}"</span>)) evil-surround-pairs-alist)
     (subword-mode <span class="org-highlight-numbers-number">1</span>)
     (make-variable-buffer-local 'find-tag-default-function)
     (<span class="org-keyword">setq</span> find-tag-default-function (<span class="org-keyword">lambda</span> () (current-word t t)))
     ))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">xref for purescript works a bit weird with qualified identifiers</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(define-key purescript-mode-map (kbd "M-.")</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">#'(lambda () (interactive) (xref-find-definitions (current-word t t))))</span>
  )

(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/purescript-align-stuff</span> t)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/purescript-sort-and-align-imports</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">save-excursion</span>
    (goto-line <span class="org-highlight-numbers-number">1</span>)
    (<span class="org-keyword">while</span> (purescript-navigate-imports)
      (<span class="org-keyword">progn</span>
        (purescript-sort-imports)
        (<span class="org-keyword">when</span> my/purescript-align-stuff (purescript-align-imports))))
    (purescript-navigate-imports-return)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/purescript-format-and-save</span> ()
  <span class="org-doc">"Formats the import statements using haskell-stylish and saves</span>
<span class="org-doc">the current file."</span>
  (<span class="org-keyword">interactive</span>)
  (my/purescript-sort-and-align-imports)
  (save-buffer))

<span class="org-comment-delimiter">;; </span><span class="org-comment">This needs to exist in the `</span><span class="org-comment"><span class="org-constant">load-path</span></span><span class="org-comment">'</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">custom-purescript-font-lock</span>
  <span class="org-builtin">:after</span> purescript-mode)

<span class="org-comment-delimiter">;; </span><span class="org-comment">copy these into the purescript-mode definition</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-local font-lock-defaults</span>
<span class="org-comment-delimiter">;;             </span><span class="org-comment">'((purescript-font-lock-keywords)</span>
<span class="org-comment-delimiter">;;               </span><span class="org-comment">nil nil nil nil</span>
<span class="org-comment-delimiter">;;               </span><span class="org-comment">(font-lock-syntactic-face-function</span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">. purescript-syntactic-face-function)</span>
<span class="org-comment-delimiter">;;               </span><span class="org-comment">(parse-sexp-lookup-properties . t)</span>
<span class="org-comment-delimiter">;;               </span><span class="org-comment">(font-lock-extra-managed-props . (composition purescript-type))))</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq-local font-lock-multiline t)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgedabe6c" class="outline-2">
<h2 id="orgedabe6c"><span class="section-number-2">20</span> Python</h2>
<div class="outline-text-2" id="text-20">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">python</span>
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.py\\'"</span> . python-mode)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> python-mode-map
              (<span class="org-string">"C-c C-j"</span> . counsel-imenu))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> python-shell-prompt-detect-failure-warning nil)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">my/add-hooks</span>
   '(python-mode-hook)
   (<span class="org-keyword">setq-default</span> flycheck-disabled-checkers
                 (append flycheck-disabled-checkers
                         '(python-pycompile)))))

(<span class="org-keyword">use-package</span> <span class="org-constant">blacken</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"black"</span>)
  <span class="org-builtin">:after</span> python
  <span class="org-builtin">:commands</span> (blacken-mode blacken-buffer)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> blacken-line-length <span class="org-highlight-numbers-number">80</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/python-format-and-save</span> ()
    (<span class="org-keyword">interactive</span>)
    (blacken-buffer)
    (save-buffer))
  (my/define-major-mode-key 'python-mode <span class="org-string">"s"</span> 'my/python-format-and-save))

(<span class="org-keyword">use-package</span> <span class="org-constant">anaconda-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span> ((python-mode . anaconda-mode)
         (python-mode . anaconda-eldoc-mode)
         )
  <span class="org-builtin">:diminish</span> anaconda-mode
  <span class="org-builtin">:diminish</span> anaconda-eldoc-mode)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-venv</span> ())
(<span class="org-keyword">use-package</span> <span class="org-constant">pyvenv</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> python
  <span class="org-builtin">:commands</span> (pyvenv-workon)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-venv</span> ()
    (<span class="org-keyword">if</span> (string= major-mode <span class="org-string">"python-mode"</span>)
        (<span class="org-keyword">let</span> ((venv (<span class="org-keyword">if</span> (null pyvenv-virtual-env-name)
                        <span class="org-string">"-"</span>
                      pyvenv-virtual-env-name)))
          (concat
           <span class="org-string">"["</span>
           (propertize venv 'face '(<span class="org-builtin">:underline</span> t))
           <span class="org-string">"] "</span>))
      <span class="org-string">""</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">eshell/workon</span> (arg) (pyvenv-workon arg))
(<span class="org-keyword">defun</span> <span class="org-function-name">eshell/deactivate</span> () (pyvenv-deactivate))
</pre>
</div>
</div>
</div>

<div id="outline-container-org47c643d" class="outline-2">
<h2 id="org47c643d"><span class="section-number-2">21</span> js/ts/html/css</h2>
<div class="outline-text-2" id="text-21">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">rjsx-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.jsx?\\'"</span> . rjsx-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> js2-mode-show-strict-warnings nil)
  <span class="org-builtin">:config</span>
  (my/define-major-mode-key 'rjsx-mode <span class="org-string">"s"</span> 'my/prettier-and-save)
  (<span class="org-keyword">my/add-hooks</span>
   '(rjsx-mode-hook)
   (<span class="org-keyword">setq</span> evil-shift-width <span class="org-highlight-numbers-number">2</span>)
   (define-key js2-mode-map (kbd <span class="org-string">"C-c C-f"</span>) nil)))

(<span class="org-keyword">use-package</span> <span class="org-constant">typescript-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.ts\\'"</span> . typescript-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> typescript-indent-level <span class="org-highlight-numbers-number">2</span>)
  <span class="org-builtin">:config</span>
  (my/define-major-mode-key 'typescript-mode <span class="org-string">"s"</span> 'my/prettier-and-save)
  (<span class="org-keyword">my/add-hooks</span>
   '(typescript-mode-hook)
   (subword-mode <span class="org-highlight-numbers-number">1</span>)
   (<span class="org-keyword">setq</span> evil-shift-width <span class="org-highlight-numbers-number">2</span>)))

(<span class="org-keyword">use-package</span> <span class="org-constant">web-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.html\\'"</span> . web-html-mode)
         (<span class="org-string">"\\.tsx\\'"</span> . web-tsx-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> web-mode-markup-indent-offset <span class="org-highlight-numbers-number">2</span>
        web-mode-css-indent-offset <span class="org-highlight-numbers-number">2</span>
        web-mode-code-indent-offset <span class="org-highlight-numbers-number">2</span>
        web-mode-attr-indent-offset <span class="org-highlight-numbers-number">2</span>)
  (<span class="org-keyword">define-derived-mode</span> <span class="org-function-name">web-tsx-mode</span> web-mode <span class="org-string">"web-tsx"</span>)
  (<span class="org-keyword">define-derived-mode</span> <span class="org-function-name">web-html-mode</span> web-mode <span class="org-string">"web-html"</span>)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">web-tsx-mode</span>
  (my/define-major-mode-key 'web-tsx-mode <span class="org-string">"s"</span> 'my/prettier-and-save)
  (<span class="org-keyword">my/add-hooks</span> '(web-tsx-mode) (subword-mode <span class="org-highlight-numbers-number">1</span>)))

(<span class="org-keyword">use-package</span> <span class="org-constant">css-mode</span>
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.css\\'"</span> . css-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> css-indent-offset <span class="org-highlight-numbers-number">2</span>
        css-fontify-colors nil))

(<span class="org-keyword">use-package</span> <span class="org-constant">js</span>
  <span class="org-builtin">:commands</span> (js-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> js-indent-level <span class="org-highlight-numbers-number">2</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">(use-package prettier-js</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:ensure t</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:commands (prettier-js prettier-js-mode my/prettier-and-save)</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">:init</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(setq prettier-js-args '("--trailing-comma" "es5"</span>
<span class="org-comment-delimiter">;;                            </span><span class="org-comment">"--tab-width" "2"</span>
<span class="org-comment-delimiter">;;                            </span><span class="org-comment">"--semi" "false"</span>
<span class="org-comment-delimiter">;;                            </span><span class="org-comment">"--single-quote" "false")))</span>

(<span class="org-keyword">defun</span> <span class="org-function-name">my/prettier-and-save</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (executable-find <span class="org-string">"prettier"</span>)
    (<span class="org-warning">user-error</span> <span class="org-string">"`</span><span class="org-string"><span class="org-constant">prettier</span></span><span class="org-string">' executable not found"</span>))
  (<span class="org-keyword">let*</span> ((fn (file-name-nondirectory buffer-file-name)))
    (my/format-and-save <span class="org-string">"prettier"</span> <span class="org-string">"--stdin"</span> <span class="org-string">"--stdin-filepath"</span> fn))
  (save-buffer))

(<span class="org-keyword">use-package</span> <span class="org-constant">emmet-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (emmet-expand-line)
  <span class="org-builtin">:bind</span> ((<span class="org-string">"&lt;C-return&gt;"</span> . emmet-expand-line))
  <span class="org-builtin">:hook</span> ((web-html-mode html-mode css-mode) . emmet-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e53b1a" class="outline-2">
<h2 id="org2e53b1a"><span class="section-number-2">22</span> Lisps</h2>
<div class="outline-text-2" id="text-22">
</div>
<div id="outline-container-org9e6835e" class="outline-3">
<h3 id="org9e6835e"><span class="section-number-3">22.1</span> all lisps</h3>
<div class="outline-text-3" id="text-22-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">expand macros in another window</span>
(define-key
  lisp-mode-map
  (kbd <span class="org-string">"C-c C-m"</span>)
  #'(lambda () (<span class="org-keyword">interactive</span>) (macrostep-expand t)))

(<span class="org-keyword">my/add-hooks</span>
 '(lisp-mode-hook emacs-lisp-mode-hook lisp-interaction-mode-hook)
 (eldoc-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org07ad714" class="outline-3">
<h3 id="org07ad714"><span class="section-number-3">22.2</span> emacs lisp</h3>
<div class="outline-text-3" id="text-22-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">elisp-mode</span>
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.el\\'"</span> . emacs-lisp-mode)
         (<span class="org-string">"\\.elc\\'"</span> . elisp-byte-code-mode))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/emacs-lisp-format-and-save</span> ()
    (<span class="org-keyword">interactive</span>)
    (my/indent-region-or-buffer)
    (save-buffer))

  (my/define-major-mode-key 'emacs-lisp-mode <span class="org-string">"s"</span> #'my/emacs-lisp-format-and-save))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge0956f0" class="outline-2">
<h2 id="orge0956f0"><span class="section-number-2">23</span> Coq (proof-general)</h2>
<div class="outline-text-2" id="text-23">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">proof-general</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> proof-splash-enable nil
        proof-script-fly-past-comments t))

(<span class="org-keyword">use-package</span> <span class="org-constant">holes</span>
  <span class="org-builtin">:ensure</span> proof-general
  <span class="org-builtin">:after</span> proof-general coq-mode
  <span class="org-builtin">:commands</span> (holes-mode)
  <span class="org-builtin">:diminish</span>)

(<span class="org-keyword">use-package</span> <span class="org-constant">coq-mode</span>
  <span class="org-builtin">:ensure</span> proof-general
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.v\\'"</span> . coq-mode))
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> coq-mode-map
              (<span class="org-string">"C-c ."</span> . proof-electric-terminator-toggle))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> coq-one-command-per-line nil
        coq-compile-before-require t)
  <span class="org-builtin">:config</span>
  (add-hook 'my/after-set-theme-hook 'coq-highlight-selected-hyps)
  (my/define-major-mode-key 'coq-mode <span class="org-string">"t"</span> 'engine/search-coq-tactics)
  (<span class="org-keyword">my/add-hooks</span>
   '(coq-mode-hook)
   (<span class="org-keyword">setq</span> evil-shift-width <span class="org-highlight-numbers-number">2</span>)
   (<span class="org-keyword">push</span> '(?# . (<span class="org-string">"(* "</span> . <span class="org-string">" *)"</span>)) evil-surround-pairs-alist)
   (undo-tree-mode <span class="org-highlight-numbers-number">1</span>)
   (whitespace-mode <span class="org-highlight-numbers-number">1</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org51371c9" class="outline-2">
<h2 id="org51371c9"><span class="section-number-2">24</span> Markdown</h2>
<div class="outline-text-2" id="text-24">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">markdown-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (markdown-mode gfm-mode)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> markdown-mode-map
              (<span class="org-string">"M-a"</span> . beginning-of-defun)
              (<span class="org-string">"M-e"</span> . end-of-defun)
              (<span class="org-string">"TAB"</span> . my/markdown-toggle-heading)
              (<span class="org-string">"&lt;tab&gt;"</span> . my/markdown-toggle-heading))
  <span class="org-builtin">:mode</span> ((<span class="org-string">"README\\.md\\'"</span> . gfm-mode)
         (<span class="org-string">"\\.md\\'"</span> . markdown-mode)
         (<span class="org-string">"\\.markdown\\'"</span> . markdown-mode)
         (<span class="org-string">"\\.page\\'"</span> . gfm-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">if</span> (executable-find <span class="org-string">"marked"</span>)
      (<span class="org-keyword">setq</span> markdown-command <span class="org-string">"marked"</span>))
  (<span class="org-keyword">setq</span> markdown-asymmetric-header t
        markdown-gfm-use-electric-backquote nil
        markdown-css-paths
        (list (expand-file-name (concat user-emacs-directory <span class="org-string">"static/github.css"</span>)))
        )
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">my/add-hooks</span>
   '(markdown-mode-hook)
   (auto-fill-mode <span class="org-highlight-numbers-number">1</span>)
   (whitespace-mode <span class="org-highlight-numbers-number">+1</span>)
   <span class="org-comment-delimiter">;; </span><span class="org-comment">(orgtbl-mode +1)</span>
   (<span class="org-keyword">push</span> '(?# . (<span class="org-string">"&lt;!-- "</span> . <span class="org-string">" --&gt;"</span>)) evil-surround-pairs-alist))

  (<span class="org-keyword">defun</span> <span class="org-function-name">markdown-org-table-align-advice</span> ()
    <span class="org-doc">"Replace \"+\" sign with \"|\" in tables."</span>
    (<span class="org-keyword">when</span> (member major-mode '(markdown-mode gfm-mode))
      (<span class="org-keyword">save-excursion</span>
        (<span class="org-keyword">save-restriction</span>
          (narrow-to-region (org-table-begin) (org-table-end))
          (goto-char (point-min))
          (<span class="org-keyword">while</span> (search-forward <span class="org-string">"-+-"</span> nil t)
            (replace-match <span class="org-string">"-|-"</span>))))))
  (advice-add 'org-table-align <span class="org-builtin">:after</span> 'markdown-org-table-align-advice)

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/markdown-toggle-heading</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">when</span> (markdown-heading-at-point)
      (outline-toggle-children))))

(<span class="org-keyword">use-package</span> <span class="org-constant">markdown-toc</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> markdown-mode
  <span class="org-builtin">:commands</span> (markdown-toc-refresh-toc
             markdown-toc-generate-toc
             markdown-toc-generate-or-refresh-toc)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">mtoc</span> 'markdown-toc-generate-or-refresh-toc))
</pre>
</div>
</div>
</div>

<div id="outline-container-org17c057d" class="outline-2">
<h2 id="org17c057d"><span class="section-number-2">25</span> LaTeX</h2>
<div class="outline-text-2" id="text-25">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">tex-mode</span>
  <span class="org-builtin">:ensure</span> auctex
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.tex\\'"</span> . latex-mode)))

(<span class="org-keyword">use-package</span> <span class="org-constant">latex-preview-pane</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> tex-mode
  <span class="org-builtin">:commands</span> (latex-preview-pane-mode
             latex-preview-pane-enable))
</pre>
</div>
</div>
</div>

<div id="outline-container-org07aa952" class="outline-2">
<h2 id="org07aa952"><span class="section-number-2">26</span> Other prog modes</h2>
<div class="outline-text-2" id="text-26">
</div>
<div id="outline-container-org7cf9cff" class="outline-3">
<h3 id="org7cf9cff"><span class="section-number-3">26.1</span> idris</h3>
<div class="outline-text-3" id="text-26-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">idris-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.idr\\'"</span> . idris-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8db807b" class="outline-3">
<h3 id="org8db807b"><span class="section-number-3">26.2</span> c/c++</h3>
<div class="outline-text-3" id="text-26-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> c-default-style <span class="org-string">"linux"</span>
      c-basic-offset <span class="org-highlight-numbers-number">4</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef24466" class="outline-3">
<h3 id="orgef24466"><span class="section-number-3">26.3</span> dhall</h3>
<div class="outline-text-3" id="text-26-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">dhall-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.dhall\\'"</span> . dhall-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> dhall-format-at-save nil
        dhall-format-arguments '(<span class="org-string">"--ascii"</span>))

  (<span class="org-keyword">with-eval-after-load</span> 'smartparens
    (<span class="org-keyword">with-eval-after-load</span> 'dhall-mode
      (sp-local-pair 'dhall-mode <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">"</span> <span class="org-string">")"</span>)))

  <span class="org-builtin">:config</span>
  (<span class="org-keyword">my/add-hooks</span>
   '(dhall-mode-hook)
   (<span class="org-keyword">setq</span> indent-tabs-mode nil)
   (<span class="org-keyword">setq</span> evil-shift-width <span class="org-highlight-numbers-number">2</span>))
  (my/define-major-mode-key 'dhall-mode <span class="org-string">"d"</span> #'my/dhall-browse-docs)
  (my/define-major-mode-key 'dhall-mode <span class="org-string">"s"</span> #'my/dhall-format-and-save)
  (my/define-major-mode-key 'dhall-mode <span class="org-string">"t"</span> #'my/dhall-show-type))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/dhall-format-and-save</span> ()
  (<span class="org-keyword">interactive</span>)
  (dhall-format-buffer)
  (save-buffer))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/dhall-show-type</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((tp (dhall-buffer-type))
        (errbuf (get-buffer <span class="org-string">"*dhall-buffer-type-errors*"</span>)))
    (<span class="org-keyword">if</span> (null tp)
        (display-buffer-below-selected errbuf '(nil (inhibit-same-window .t)))
      (message tp))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/dhall-browse-docs</span> ()
  (<span class="org-keyword">interactive</span>)
  (browse-url <span class="org-string">"https://docs.dhall-lang.org/references/Built-in-types.html"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9303154" class="outline-3">
<h3 id="org9303154"><span class="section-number-3">26.4</span> bazel</h3>
<div class="outline-text-3" id="text-26-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">bazel-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.bazel\\'"</span> . bazel-mode)
         (<span class="org-string">"\\.bzl\\'"</span> . bazel-mode))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/bazel-format-and-save</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let*</span> ((fn (file-name-nondirectory buffer-file-name))
           (ext (file-name-extension fn))
           (tp (<span class="org-keyword">cond</span>
                ((string= fn <span class="org-string">"BUILD.bazel"</span>) <span class="org-string">"build"</span>)
                ((string= ext <span class="org-string">"bzl"</span>) <span class="org-string">"bzl"</span>)
                (t (<span class="org-warning">user-error</span> (format <span class="org-string">"Not a bazel file extension: %s"</span> ext))))))
      (my/format-and-save <span class="org-string">"buildifier"</span> <span class="org-string">"--type"</span> tp))
    (save-buffer))
  (my/define-major-mode-key 'bazel-mode <span class="org-string">"s"</span> #'my/bazel-format-and-save))

</pre>
</div>
</div>
</div>

<div id="outline-container-org81b0b8b" class="outline-3">
<h3 id="org81b0b8b"><span class="section-number-3">26.5</span> nginx</h3>
<div class="outline-text-3" id="text-26-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">nginx-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"nginx\\.conf\\'"</span> . nginx-mode)
         (<span class="org-string">"nginx\\.conf\\.template\\'"</span> . nginx-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org46a0af0" class="outline-3">
<h3 id="org46a0af0"><span class="section-number-3">26.6</span> terraform</h3>
<div class="outline-text-3" id="text-26-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">terraform-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.tf\\'"</span> . terraform-mode)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/terraform-format-and-save</span> ()
    (<span class="org-keyword">interactive</span>)
    (terraform-format-buffer)
    (save-buffer))
  (my/define-major-mode-key 'terraform-mode <span class="org-string">"s"</span> #'my/terraform-format-and-save))

</pre>
</div>
</div>
</div>

<div id="outline-container-orga96dee3" class="outline-3">
<h3 id="orga96dee3"><span class="section-number-3">26.7</span> docker</h3>
<div class="outline-text-3" id="text-26-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">dockerfile-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> (<span class="org-string">"Dockerfile.*"</span> . dockerfile-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5725389" class="outline-3">
<h3 id="org5725389"><span class="section-number-3">26.8</span> elasticsearch</h3>
<div class="outline-text-3" id="text-26-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'auto-mode-alist '(<span class="org-string">".es\\'"</span> . js-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d83bee" class="outline-3">
<h3 id="org6d83bee"><span class="section-number-3">26.9</span> json</h3>
<div class="outline-text-3" id="text-26-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">json-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.json\\'"</span> . json-mode)
         (<span class="org-string">"\\.json.tmpl\\'"</span> . json-mode))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/json-format-and-save</span> ()
    (<span class="org-keyword">interactive</span>)
    (json-mode-beautify)
    (save-buffer))
  (my/define-major-mode-key 'json-mode <span class="org-string">"s"</span> #'my/json-format-and-save))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe44dff" class="outline-3">
<h3 id="orgbe44dff"><span class="section-number-3">26.10</span> yaml</h3>
<div class="outline-text-3" id="text-26-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">yaml-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.ya?ml\\'"</span> . yaml-mode)
         (<span class="org-string">"\\.ya?ml.template\\'"</span> . yaml-mode)))

(<span class="org-keyword">use-package</span> <span class="org-constant">flycheck-yamllint</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (flycheck yaml-mode)
  <span class="org-builtin">:commands</span> (flycheck-yamllint-setup)
  <span class="org-builtin">:hook</span> (yaml-mode . flycheck-yamllint-setup))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe9aaa8" class="outline-3">
<h3 id="orgbe9aaa8"><span class="section-number-3">26.11</span> conf</h3>
<div class="outline-text-3" id="text-26-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">add env files to conf-mode alist</span>
(add-to-list 'auto-mode-alist '(<span class="org-string">".env\\'"</span> . conf-mode))
(add-to-list 'auto-mode-alist '(<span class="org-string">".env.local\\'"</span> . conf-mode))
(add-to-list 'auto-mode-alist '(<span class="org-string">"env\\.example\\'"</span> . conf-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org639d4a1" class="outline-3">
<h3 id="org639d4a1"><span class="section-number-3">26.12</span> reStructuredText</h3>
<div class="outline-text-3" id="text-26-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">rst</span>
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.rst\\'"</span> . rst-mode)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> rst-mode-map
              (<span class="org-string">"M-a"</span> . rst-backward-section)
              (<span class="org-string">"M-e"</span> . rst-forward-section))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> rst-indent-width <span class="org-highlight-numbers-number">2</span>)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">my/add-hooks</span>
   '(rst-mode-hook)
   (<span class="org-keyword">setq</span> evil-shift-width rst-indent-width)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6e49ab" class="outline-3">
<h3 id="orge6e49ab"><span class="section-number-3">26.13</span> asciidoc</h3>
<div class="outline-text-3" id="text-26-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">adoc-mode</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.adoc\\'"</span> . adoc-mode))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbee5441" class="outline-2">
<h2 id="orgbee5441"><span class="section-number-2">27</span> Other major modes</h2>
<div class="outline-text-2" id="text-27">
</div>
<div id="outline-container-orgbb5f98f" class="outline-3">
<h3 id="orgbb5f98f"><span class="section-number-3">27.1</span> elfeed</h3>
<div class="outline-text-3" id="text-27-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">elfeed-web</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (elfeed-web-start)
  <span class="org-builtin">:after</span> elfeed)

(<span class="org-keyword">use-package</span> <span class="org-constant">elfeed</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (elfeed)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> elfeed-search-mode-map
              (<span class="org-string">"h"</span> . backward-char)
              (<span class="org-string">"j"</span> . next-line)
              (<span class="org-string">"k"</span> . previous-line)
              (<span class="org-string">"l"</span> . forward-char)
              (<span class="org-string">"U"</span> . elfeed-update)
              <span class="org-builtin">:map</span> elfeed-show-mode-map
              (<span class="org-string">"h"</span> . backward-char)
              (<span class="org-string">"j"</span> . next-line)
              (<span class="org-string">"k"</span> . previous-line)
              (<span class="org-string">"l"</span> . forward-char)
              (<span class="org-string">"w"</span> . forward-word)
              (<span class="org-string">"b"</span> . backward-word))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> elfeed-db-directory (concat my/dropbox-dir <span class="org-string">"elfeed"</span>)
        elfeed-search-filter <span class="org-string">"@10-days-ago +unread"</span>)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/elfeed-hide-images</span> (tog)
    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
    (<span class="org-keyword">let</span> ((shr-inhibit-images (not tog)))
      (elfeed-show-refresh)))
  (define-key elfeed-show-mode-map (kbd <span class="org-string">"i"</span>) #'my/elfeed-hide-images)

  (add-hook 'elfeed-show-mode-hook #'(lambda () (<span class="org-keyword">setq-local</span> shr-width <span class="org-highlight-numbers-number">100</span>)))

  (add-hook 'elfeed-new-entry-hook
            (elfeed-make-tagger <span class="org-builtin">:before</span> <span class="org-string">"2 weeks ago"</span>
                                <span class="org-builtin">:remove</span> 'unread))

  (add-hook 'elfeed-search-update-hook #'elfeed-db-save)
  (add-hook 'elfeed-update-init-hooks #'elfeed-db-save)

  (<span class="org-keyword">defface</span> <span class="org-variable-name">my/elfeed-important</span>
    '((t (<span class="org-builtin">:foreground</span> <span class="org-string">"salmon"</span>)))
    <span class="org-doc">"Elfeed unread"</span>
    <span class="org-builtin">:group</span> 'my/faces)
  (<span class="org-keyword">push</span> '(important my/elfeed-important) elfeed-search-face-alist)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">get feeds from personal dir</span>
  (load-file (concat my/dropbox-dir <span class="org-string">"lisp/elfeed-feeds.el"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bde1bf" class="outline-3">
<h3 id="org1bde1bf"><span class="section-number-3">27.2</span> pdf tools</h3>
<div class="outline-text-3" id="text-27-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">pdf-tools</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:magic</span> (<span class="org-string">"%PDF"</span> . pdf-view-mode)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> pdf-view-mode-map
              (<span class="org-string">"j"</span> . pdf-view-next-line-or-next-page)
              (<span class="org-string">"k"</span> . pdf-view-previous-line-or-previous-page)
              (<span class="org-string">"h"</span> . image-backward-hscroll)
              (<span class="org-string">"l"</span> . image-forward-hscroll)
              (<span class="org-string">"C-s"</span> . isearch-forward))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> pdf-view-display-size 'fit-page
        pdf-view-midnight-colors '(<span class="org-string">"#b3dfdd"</span> . <span class="org-string">"#0a3749"</span>))
  <span class="org-builtin">:config</span>
  (pdf-tools-install <span class="org-builtin">:no-query</span>))

(<span class="org-keyword">use-package</span> <span class="org-constant">pdf-outline</span>
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> pdf-outline-buffer-mode-map
              (<span class="org-string">"&lt;backtab&gt;"</span> . outline-hide-sublevels)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org085972c" class="outline-3">
<h3 id="org085972c"><span class="section-number-3">27.3</span> erc</h3>
<div class="outline-text-3" id="text-27-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">erc</span>
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:commands</span> (erc my/erc-freenode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> erc-rename-buffers t
        erc-prompt-for-nickserv-password nil
        erc-autojoin-timing 'ident
        erc-fill-function 'erc-fill-static
        erc-fill-static-center <span class="org-highlight-numbers-number">22</span>
        erc-server-reconnect-attempts <span class="org-highlight-numbers-number">5</span>
        erc-server-reconnect-timeout <span class="org-highlight-numbers-number">3</span>
        erc-interpret-mirc-color t
        erc-lurker-hide-list '(<span class="org-string">"JOIN"</span> <span class="org-string">"PART"</span> <span class="org-string">"QUIT"</span>)
        erc-autojoin-channels-alist '((<span class="org-string">"freenode.net"</span> <span class="org-string">"#haskell"</span>))
        erc-fill-column <span class="org-highlight-numbers-number">80</span>
        my/erc-default-nick <span class="org-string">"runforestrun"</span>)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/erc-freenode</span> (select-nick)
    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
    (<span class="org-keyword">let</span> ((nick
           (<span class="org-keyword">if</span> select-nick
               (read-string <span class="org-string">"Nick: "</span>)
             my/erc-default-nick)))
      (erc <span class="org-builtin">:server</span> <span class="org-string">"irc.freenode.net"</span> <span class="org-builtin">:port</span> <span class="org-highlight-numbers-number">6667</span> <span class="org-builtin">:nick</span> nick)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/erc-preprocess</span> (string)
    <span class="org-doc">"Avoids channel flooding."</span>
    (<span class="org-keyword">setq</span> str
          (string-trim
           (replace-regexp-in-string <span class="org-string">"\n+"</span> <span class="org-string">" "</span> str))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/erc-switch-to-buffer</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((read-buffer-function nil))
      (call-interactively 'erc-switch-to-buffer)))
  (define-key erc-mode-map (kbd <span class="org-string">"C-c C-b"</span>) 'my/erc-switch-to-buffer))

<span class="org-comment-delimiter">;; </span><span class="org-comment">put a bar after the last read message in erc</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">https://www.emacswiki.org/emacs/ErcBar</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">erc-track</span>
  <span class="org-builtin">:after</span> erc
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">erc-bar-move-back</span> (n)
    <span class="org-doc">"Moves back n message lines. Ignores wrapping, and server messages."</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"nHow many lines ? "</span>)
    (re-search-backward <span class="org-string">"^.*&lt;.*&gt;"</span> nil t n))

  (<span class="org-keyword">defun</span> <span class="org-function-name">erc-bar-update-overlay</span> ()
    <span class="org-doc">"Update the overlay for current buffer, based on the content of</span>
<span class="org-doc">erc-modified-channels-alist. Should be executed on window change."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let*</span> ((info (assq (current-buffer) erc-modified-channels-alist))
           (count (cadr info)))
      (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> info (&gt; count erc-bar-threshold))
          (<span class="org-keyword">save-excursion</span>
            (end-of-buffer)
            (<span class="org-keyword">when</span> (erc-bar-move-back count)
              (<span class="org-keyword">let</span> ((inhibit-field-text-motion t))
                (move-overlay erc-bar-overlay
                              (line-beginning-position)
                              (line-end-position)
                              (current-buffer)))))
        (delete-overlay erc-bar-overlay))))

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">erc-bar-threshold</span> <span class="org-highlight-numbers-number">0</span>
    <span class="org-doc">"Display bar when there are more than erc-bar-threshold unread messages."</span>)
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">erc-bar-overlay</span> nil
    <span class="org-doc">"Overlay used to set bar"</span>)
  (<span class="org-keyword">setq</span> erc-bar-overlay (make-overlay <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">0</span>))
  (overlay-put erc-bar-overlay 'face '(<span class="org-builtin">:overline</span> <span class="org-string">"grey40"</span>))
  <span class="org-comment-delimiter">;;</span><span class="org-comment">put the hook before erc-modified-channels-update</span>
  (<span class="org-keyword">defadvice</span> <span class="org-function-name">erc-track-mode</span> (after erc-bar-setup-hook
                                   (<span class="org-type">&amp;rest</span> args) activate)
    <span class="org-comment-delimiter">;;</span><span class="org-comment">remove and add, so we know it's in the first place</span>
    (remove-hook 'window-configuration-change-hook 'erc-bar-update-overlay)
    (add-hook 'window-configuration-change-hook 'erc-bar-update-overlay))
  (add-hook 'erc-send-completed-hook (<span class="org-keyword">lambda</span> (str)
                                       (erc-bar-update-overlay))))

<span class="org-comment-delimiter">;; </span><span class="org-comment">https://www.reddit.com/r/emacs/comments/8ml6na/tip_how_to_make_erc_fun_to_use/</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">erc-hl-nicks</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> erc
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> erc-hl-nicks-skip-nicks '(<span class="org-string">"so"</span> <span class="org-string">"So"</span> <span class="org-string">"bind"</span> <span class="org-string">"hackage"</span>)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge4f2999" class="outline-2">
<h2 id="orge4f2999"><span class="section-number-2">28</span> Searching</h2>
<div class="outline-text-2" id="text-28">
</div>
<div id="outline-container-org178498a" class="outline-3">
<h3 id="org178498a"><span class="section-number-3">28.1</span> isearch</h3>
<div class="outline-text-3" id="text-28-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">isearch</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> search-whitespace-regexp <span class="org-string">".*?"</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">spaces match anything</span>
        isearch-lax-whitespace t  <span class="org-comment-delimiter">;; </span><span class="org-comment">the default</span>
        isearch-regex-lax-whitespace nil
        isearch-lazy-count t  <span class="org-comment-delimiter">;; </span><span class="org-comment">show match count and current match index</span>
        lazy-count-prefix-format <span class="org-string">"(%s/%s) "</span>
        lazy-count-suffix-format nil)
  <span class="org-builtin">:config</span>
  (define-key isearch-mode-map
    (kbd <span class="org-string">"M-s M-s"</span>)
    (<span class="org-keyword">lambda</span> () (<span class="org-keyword">interactive</span>) (isearch-exit) (swiper isearch-string))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbcb1b59" class="outline-3">
<h3 id="orgbcb1b59"><span class="section-number-3">28.2</span> rg</h3>
<div class="outline-text-3" id="text-28-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">rg</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (rg my/rg-project-or-ask)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> rg-mode-map
              (<span class="org-string">"m"</span> . rg-menu)
              (<span class="org-string">"s"</span> . my/rg-save-search-as-name)
              (<span class="org-string">"N"</span> . my/rg-open-ace-window)
              (<span class="org-string">"C-n"</span> . next-line)
              (<span class="org-string">"C-p"</span> . previous-line)
              (<span class="org-string">"j"</span> . next-line)
              (<span class="org-string">"k"</span> . previous-line)
              (<span class="org-string">"M-n"</span> . rg-next-file)
              (<span class="org-string">"M-p"</span> . rg-prev-file))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> rg-group-result t
        rg-ignore-case 'smart)
  (<span class="org-keyword">setq</span> rg-custom-type-aliases
        '((<span class="org-string">"coq"</span> . <span class="org-string">"*.v"</span>)))
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">rgp</span> 'my/rg-project-or-ask)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">rg-define-toggle</span> <span class="org-string">"--multiline --multiline-dotall"</span> <span class="org-string">"u"</span>)
  (<span class="org-keyword">rg-define-toggle</span> <span class="org-string">"--word-regexp"</span> <span class="org-string">"w"</span>)
  (<span class="org-keyword">rg-define-search</span> <span class="org-function-name">my/rg-project-or-ask</span>
    <span class="org-builtin">:query</span> ask
    <span class="org-builtin">:format</span> regexp
    <span class="org-builtin">:files</span> <span class="org-string">"all"</span>
    <span class="org-builtin">:dir</span> (<span class="org-keyword">or</span> (projectile-project-root)
             (read-directory-name <span class="org-string">"rg in: "</span>))
    <span class="org-builtin">:confirm</span> prefix)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">https://protesilaos.com/dotemacs/#h:31622bf2-526b-4426-9fda-c0fc59ac8f4b</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/rg-save-search-as-name</span> ()
    <span class="org-doc">"Save `</span><span class="org-doc"><span class="org-constant">rg</span></span><span class="org-doc">' buffer, naming it after the current search query."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((pattern (rg-search-pattern rg-cur-search)))
      (rg-save-search-as-name (concat <span class="org-string">"&#171;"</span> pattern <span class="org-string">"&#187;"</span>))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/rg-open-ace-window</span> (<span class="org-type">&amp;optional</span> event)
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">flet</span> ((pop-to-buffer (buf <span class="org-type">&amp;rest</span> args)
                          (<span class="org-keyword">let</span> ((pop-up-windows nil))
                            (<span class="org-keyword">if</span> (get-buffer-window buf)
                                (<span class="org-keyword">while</span> (not (equal buf (current-buffer)))
                                  (other-window <span class="org-highlight-numbers-number">1</span>))
                              (<span class="org-keyword">progn</span>
                                (ace-window nil)
                                (switch-to-buffer buf))))))
          (compile-goto-error event)))
  )

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8285f20" class="outline-2">
<h2 id="org8285f20"><span class="section-number-2">29</span> Company</h2>
<div class="outline-text-2" id="text-29">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">company</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:diminish</span> company-mode
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-M-i"</span> . company-complete)
         <span class="org-builtin">:map</span> company-active-map
         (<span class="org-string">"C-p"</span> . company-select-previous)
         (<span class="org-string">"C-n"</span> . company-select-next)
         (<span class="org-string">"C-f"</span> . company-show-location)
         (<span class="org-string">"TAB"</span> . company-complete-common-or-cycle)
         (<span class="org-string">"&lt;tab&gt;"</span> . company-complete-common-or-cycle)
         (<span class="org-string">"&lt;escape&gt;"</span> . company-abort))
  <span class="org-builtin">:hook</span> ((after-init . global-company-mode)
         (global-company-mode . company-quickhelp-mode))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> company-dabbrev-downcase nil
        company-minimum-prefix-length <span class="org-highlight-numbers-number">3</span>
        company-idle-delay <span class="org-highlight-numbers-number">0.4</span>)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> company-backends (delete 'company-dabbrev company-backends))
  (<span class="org-keyword">setq</span> company-backends (delete 'company-capf company-backends))
  (add-to-list 'company-backends 'company-elisp)
  (add-to-list 'company-backends 'company-anaconda)
  (add-to-list 'company-backends 'company-files))

(<span class="org-keyword">use-package</span> <span class="org-constant">company-quickhelp</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> company)

(<span class="org-keyword">use-package</span> <span class="org-constant">company-anaconda</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (company anaconda-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2326367" class="outline-2">
<h2 id="org2326367"><span class="section-number-2">30</span> Flycheck</h2>
<div class="outline-text-2" id="text-30">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-flycheck</span> ())

(<span class="org-keyword">use-package</span> <span class="org-constant">flycheck</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:diminish</span> flycheck-mode
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c ! t"</span> . flycheck-mode))
  <span class="org-builtin">:hook</span> (after-init . global-flycheck-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> flycheck-temp-prefix <span class="org-string">".flycheck"</span>
        flycheck-emacs-lisp-load-path 'inherit
        flycheck-check-syntax-automatically '(save mode-enabled)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">to check while typing:</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">flycheck-check-syntax-automatically '(save idle-change new-line mode-enabled)</span>
        )
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/toggle-flycheck-error-list</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">-if-let</span> (window (flycheck-get-error-list-window))
        (quit-window nil window)
      (flycheck-list-errors)))

  (add-to-list 'display-buffer-alist
               `(,(<span class="org-keyword">rx</span> bos <span class="org-string">"*Flycheck errors*"</span> eos)
                 (display-buffer-reuse-window
                  display-buffer-in-side-window)
                 (side            . bottom)
                 (reusable-frames . visible)
                 (window-height   . <span class="org-highlight-numbers-number">0.33</span>)))

  (<span class="org-keyword">setq-default</span> flycheck-disabled-checkers
                (append flycheck-disabled-checkers
                        '(javascript-jshint haskell-ghc haskell-stack-ghc)))
  (flycheck-add-mode 'javascript-eslint 'web-mode)
  (flycheck-add-mode 'javascript-eslint 'js2-mode)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">modeline stuff</span>
  (<span class="org-keyword">defface</span> <span class="org-variable-name">modeline-flycheck-error</span>
    '((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#e05e5e"</span> <span class="org-builtin">:distant-foreground</span> <span class="org-string">"#e05e5e"</span>)))
    <span class="org-doc">"Face for flycheck error feedback in the modeline."</span>
    <span class="org-builtin">:group</span> 'modeline-flycheck)
  (<span class="org-keyword">defface</span> <span class="org-variable-name">modeline-flycheck-warning</span>
    '((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#bfb03d"</span> <span class="org-builtin">:distant-foreground</span> <span class="org-string">"#bfb03d"</span>)))
    <span class="org-doc">"Face for flycheck warning feedback in the modeline."</span>
    <span class="org-builtin">:group</span> 'modeline-flycheck)
  (<span class="org-keyword">defface</span> <span class="org-variable-name">modeline-flycheck-info</span>
    '((t (<span class="org-builtin">:foreground</span> <span class="org-string">"DeepSkyBlue3"</span> <span class="org-builtin">:distant-foreground</span> <span class="org-string">"DeepSkyBlue3"</span>)))
    <span class="org-doc">"Face for flycheck info feedback in the modeline."</span>
    <span class="org-builtin">:group</span> 'modeline-flycheck)
  (<span class="org-keyword">defface</span> <span class="org-variable-name">modeline-flycheck-ok</span>
    '((t (<span class="org-builtin">:foreground</span> <span class="org-string">"SeaGreen3"</span> <span class="org-builtin">:distant-foreground</span> <span class="org-string">"SeaGreen3"</span>)))
    <span class="org-doc">"Face for flycheck ok feedback in the modeline."</span>
    <span class="org-builtin">:group</span> 'modeline-flycheck)

  (<span class="org-keyword">defvar</span> <span class="org-variable-name">modeline-flycheck-bullet</span> <span class="org-string">"&#8226;%s"</span>)

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-flycheck-state</span> (state)
    (<span class="org-keyword">let*</span> ((counts (flycheck-count-errors flycheck-current-errors))
           (errorp (flycheck-has-current-errors-p state))
           (err (<span class="org-keyword">or</span> (cdr (assq state counts)) <span class="org-string">"?"</span>))
           (running (eq 'running flycheck-last-status-change))
           (face (intern (format <span class="org-string">"modeline-flycheck-%S"</span> state))))
      (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> errorp running)
          (propertize (format modeline-flycheck-bullet err) 'face face))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-flycheck</span> ()
    (<span class="org-keyword">let*</span> ((ml-error (my/mode-line-flycheck-state 'error))
           (ml-warning (my/mode-line-flycheck-state 'warning))
           (ml-info (my/mode-line-flycheck-state 'info))
           (ml-status (concat ml-error ml-warning ml-info)))
      (<span class="org-keyword">if</span> (null ml-status) <span class="org-string">""</span> (concat <span class="org-string">" "</span> ml-status <span class="org-string">" "</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab82bcd" class="outline-2">
<h2 id="orgab82bcd"><span class="section-number-2">31</span> Projectile</h2>
<div class="outline-text-2" id="text-31">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">projectile</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-init . projectile-mode)
  <span class="org-builtin">:bind-keymap</span> (<span class="org-string">"C-c p"</span> . projectile-command-map)
  <span class="org-builtin">:diminish</span> projectile-mode
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> projectile-completion-system 'ivy)
  (<span class="org-keyword">setq</span>
   projectile-mode-line-function
   '(lambda () (format <span class="org-string">" P[%s]"</span> (<span class="org-keyword">or</span> (projectile-project-name) <span class="org-string">"-"</span>)))))

(<span class="org-keyword">use-package</span> <span class="org-constant">perspective</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-init . persp-mode)
  <span class="org-builtin">:bind</span> ((<span class="org-string">"M-N"</span> . persp-next)
         (<span class="org-string">"M-P"</span> . persp-prev)
         (<span class="org-string">"M-J"</span> . persp-switch))
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">emacs window title</span>
  (<span class="org-keyword">defadvice</span> <span class="org-function-name">persp-switch</span>
      (after advice-for-persp-switch activate)
    (message (persp-name (persp-curr))))
  (<span class="org-keyword">setq</span> frame-title-format
        '(<span class="org-string">""</span> invocation-name <span class="org-string">"@"</span> system-name
          (<span class="org-builtin">:eval</span> (<span class="org-keyword">when</span> persp-mode (format <span class="org-string">"[%s]"</span> (persp-name (persp-curr))))))))

(<span class="org-keyword">use-package</span> <span class="org-constant">persp-projectile</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (perspective projectile))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">override chosen project names</span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/projectile-project-name-overrides</span> '())

(<span class="org-keyword">defun</span> <span class="org-function-name">my/projectile-add-to-project-name-overrides</span> (proj name)
  (add-to-list
   'my/projectile-project-name-overrides
   `(,(file-name-as-directory (expand-file-name proj)) . ,name)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/projectile-override-project-name</span> (orig <span class="org-type">&amp;rest</span> args)
  (<span class="org-keyword">let*</span> ((dir (file-name-as-directory (expand-file-name (car args))))
         (match (assoc dir my/projectile-project-name-overrides))
         (name (<span class="org-keyword">if</span> (null match) nil (cdr match))))
    (<span class="org-keyword">if</span> (null name)
        (apply orig args)
      name)))

(advice-add 'projectile-default-project-name <span class="org-builtin">:around</span> #'my/projectile-override-project-name)

<span class="org-comment-delimiter">;; </span><span class="org-comment">usage:</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(dolist (override '(</span>
<span class="org-comment-delimiter">;;                     </span><span class="org-comment">("/path/to/my/project" . "some-name")</span>
<span class="org-comment-delimiter">;;                     </span><span class="org-comment">("/other/project" . "some-other-name")</span>
<span class="org-comment-delimiter">;;                     </span><span class="org-comment">))</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(let ((proj (car override))</span>
<span class="org-comment-delimiter">;;         </span><span class="org-comment">(name (cdr override)))</span>
<span class="org-comment-delimiter">;;     </span><span class="org-comment">(my/projectile-add-to-project-name-overrides proj name)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2633c06" class="outline-2">
<h2 id="org2633c06"><span class="section-number-2">32</span> Ivy/Counsel/Swiper</h2>
<div class="outline-text-2" id="text-32">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">counsel-projectile</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> projectile
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> projectile-command-map
              (<span class="org-string">"f"</span> . counsel-projectile-find-file)
              (<span class="org-string">"s"</span> . counsel-projectile-rg)
              (<span class="org-string">"b"</span> . counsel-projectile-switch-to-buffer))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> projectile-switch-project-action 'counsel-projectile-find-file))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/swiper</span> (fuzzy)
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">if</span> fuzzy
      (<span class="org-keyword">let*</span> ((temp-builders
              (copy-alist ivy-re-builders-alist))
             (ivy-re-builders-alist
              (add-to-list 'temp-builders
                           '(swiper . ivy--regex-fuzzy))))
        (swiper))
    (swiper)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/swiper-isearch</span> (fuzzy)
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">if</span> fuzzy
      (<span class="org-keyword">let*</span> ((temp-builders
              (copy-alist ivy-re-builders-alist))
             (ivy-re-builders-alist
              (add-to-list 'temp-builders
                           '(swiper-isearch . ivy--regex-fuzzy))))
        (swiper-isearch))
    (swiper-isearch)))

(<span class="org-keyword">use-package</span> <span class="org-constant">swiper</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-comment-delimiter">;; </span><span class="org-comment">:bind ("C-s" . my/swiper)</span>
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-s"</span> . my/swiper-isearch)
  <span class="org-builtin">:commands</span> (swiper swiper-isearch swiper-all swiper-multi)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">swi</span> 'my/swiper-isearch)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">use regular isearch when in minibuffer</span>
  (define-key minibuffer-local-map (kbd <span class="org-string">"C-s"</span>) #'isearch-forward))

<span class="org-comment-delimiter">;; </span><span class="org-comment">better fuzzy matching</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">flx</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> ivy)

<span class="org-comment-delimiter">;; </span><span class="org-comment">mostly to bring recently used M-x targets at the top</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">smex</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> ivy
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> smex-history-length <span class="org-highlight-numbers-number">12</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/ivy-reset-builders</span> ()
  (<span class="org-keyword">setq</span> ivy-re-builders-alist
        '((swiper               . ivy--regex-plus)
          (swiper-isearch       . ivy--regex-plus)
          (ivy-bibtex           . ivy--regex-ignore-order)
          (counsel-unicode-char . ivy--regex-ignore-order)
          (insert-char          . ivy--regex-ignore-order)
          (ucs-insert           . ivy--regex-ignore-order)
          (counsel-unicode-char . ivy--regex-ignore-order)
          (counsel-ag           . ivy--regex-ignore-order)  <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">NOTE</span></span><span class="org-comment">: testing</span>
          (counsel-rg           . ivy--regex-ignore-order)
          (t                    . ivy--regex-fuzzy))))

(<span class="org-keyword">use-package</span> <span class="org-constant">counsel</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> ((<span class="org-string">"M-x"</span> . counsel-M-x)
         (<span class="org-string">"M-i"</span> . counsel-imenu)
         (<span class="org-string">"C-x C-f"</span> . counsel-find-file)
         (<span class="org-string">"C-x f"</span> . counsel-file-jump)
         (<span class="org-string">"C-x r b"</span> . counsel-bookmark)
         (<span class="org-string">"C-x C-a"</span> . counsel-recentf)
         <span class="org-builtin">:map</span> org-mode-map
         (<span class="org-string">"M-i"</span> . counsel-outline))
  <span class="org-builtin">:after</span> ivy
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> counsel-ag-base-command <span class="org-string">"ag --vimgrep --nocolor --nogroup %s"</span>
        counsel-rg-base-command <span class="org-string">"rg --with-filename --no-heading --line-number --color never -S %s"</span>)
  <span class="org-builtin">:config</span>
  (my/ivy-reset-builders)
  (<span class="org-keyword">setq</span> ivy-initial-inputs-alist nil) <span class="org-comment-delimiter">;; </span><span class="org-comment">no ^ initially</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">counsel-ag</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">S-SPC doesn't work properly in counsel-ag anyway</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">NOTE</span></span><span class="org-comment">: this also applies to rg</span>
  (define-key counsel-ag-map (kbd <span class="org-string">"S-SPC"</span>) nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">counsel-rg</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">NOTE</span></span><span class="org-comment">: testing this (added `</span><span class="org-comment"><span class="org-constant">-S</span></span><span class="org-comment">' for smart case in ivy-occur buffers)</span>
  (global-set-key (kbd <span class="org-string">"C-c s"</span>)
                  (<span class="org-keyword">lambda</span> ()
                    (<span class="org-keyword">interactive</span>)
                    (counsel-rg nil (read-directory-name <span class="org-string">"rg in: "</span>) <span class="org-string">""</span>)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/counsel-file-jump-temp-root</span> (reset)
    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
    (my/get-or-set-temp-root reset)
    (<span class="org-keyword">let</span> ((current-prefix-arg nil))
      (counsel-file-jump nil my/temp-project-root)))

  (global-set-key (kbd <span class="org-string">"C-S-p"</span>) #'my/counsel-file-jump-temp-root)

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/counsel-rg-temp-root</span> (reset)
    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
    (my/get-or-set-temp-root reset)
    (<span class="org-keyword">let</span> ((current-prefix-arg nil))
      (counsel-rg <span class="org-string">""</span> my/temp-project-root)))

  (global-set-key (kbd <span class="org-string">"C-S-s"</span>) #'my/counsel-rg-temp-root)

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/counsel-file-jump-from-here</span> (path)
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let</span> ((dir (<span class="org-keyword">if</span> (file-directory-p path)
                   path
                 (file-name-directory path))))
      (counsel-file-jump <span class="org-string">""</span> dir)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/set-temp-root-and-jump</span> (dir)
    (<span class="org-keyword">setq</span> my/temp-project-root dir)
    (my/counsel-file-jump-temp-root nil))

  (<span class="org-keyword">dolist</span> (action '(counsel-find-file counsel-file-jump counsel-recentf))
    (ivy-set-actions
     action
     `(
       (<span class="org-string">"s"</span>
        ,(<span class="org-keyword">my/control-function-window-split</span>
          find-file-other-window
          <span class="org-highlight-numbers-number">0</span> nil)
        <span class="org-string">"split horizontally"</span>)
       (<span class="org-string">"v"</span>
        ,(<span class="org-keyword">my/control-function-window-split</span>
          find-file-other-window
          nil <span class="org-highlight-numbers-number">0</span>)
        <span class="org-string">"split vertically"</span>)
       (<span class="org-string">"n"</span>
        ,(<span class="org-keyword">my/execute-f-with-hook</span>
          find-file
          ace-select-window)
        <span class="org-string">"select window"</span>)
       (<span class="org-string">"e"</span>
        my/eshell-in-dir
        <span class="org-string">"eshell"</span>)
       (<span class="org-string">"j"</span>
        my/counsel-file-jump-from-here
        <span class="org-string">"jump"</span>)
       (<span class="org-string">"J"</span>
        my/set-temp-root-and-jump
        <span class="org-string">"set temp root and jump"</span>)
       (<span class="org-string">"r"</span>
        (<span class="org-keyword">lambda</span> (dir) (counsel-rg nil dir))
        <span class="org-string">"counsel-rg"</span>)
       )))

  (<span class="org-keyword">dolist</span> (action '(counsel-projectile-find-file projectile-recentf))
    (ivy-set-actions
     action
     `((<span class="org-string">"s"</span>
        ,(<span class="org-keyword">my/control-function-window-split</span>
          counsel-projectile-find-file-action-other-window
          <span class="org-highlight-numbers-number">0</span> nil)
        <span class="org-string">"split horizontally"</span>)
       (<span class="org-string">"v"</span>
        ,(<span class="org-keyword">my/control-function-window-split</span>
          counsel-projectile-find-file-action-other-window
          nil <span class="org-highlight-numbers-number">0</span>)
        <span class="org-string">"split vertically"</span>)
       (<span class="org-string">"n"</span>
        ,(<span class="org-keyword">my/execute-f-with-hook</span>
          counsel-projectile-find-file-action
          ace-select-window)
        <span class="org-string">"select window"</span>)
       (<span class="org-string">"R"</span>
        (<span class="org-keyword">lambda</span> (f) (projectile-recentf))
        <span class="org-string">"recent files"</span>)
       (<span class="org-string">"e"</span>
        (<span class="org-keyword">lambda</span> (f) (my/eshell-in-dir (projectile-expand-root f)))
        <span class="org-string">"eshell"</span>)
       )))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">also applies to counsel-projectile-ag</span>
  (<span class="org-keyword">dolist</span> (action '(counsel-ag counsel-rg))
    (ivy-set-actions
     action
     '((<span class="org-string">"v"</span>
        (<span class="org-keyword">lambda</span> (x) (split-window-right) (windmove-right) (counsel-git-grep-action x))
        <span class="org-string">"split vertically"</span>)
       (<span class="org-string">"s"</span>
        (<span class="org-keyword">lambda</span> (x) (split-window-below) (windmove-down) (counsel-git-grep-action x))
        <span class="org-string">"split horizontally"</span>)
       (<span class="org-string">"n"</span>
        (<span class="org-keyword">lambda</span> (x) (ace-select-window) (counsel-git-grep-action x))
        <span class="org-string">"select window"</span>)
       ))))

(<span class="org-keyword">use-package</span> <span class="org-constant">ivy</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:diminish</span> ivy-mode
  <span class="org-builtin">:hook</span> (after-init . ivy-mode)
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c r"</span> . ivy-resume)
         (<span class="org-string">"C-x b"</span> . ivy-switch-buffer)
         <span class="org-builtin">:map</span> ivy-minibuffer-map
         (<span class="org-string">"C-l"</span> . ivy-call-and-recenter))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> ivy-use-virtual-buffers nil
        ivy-count-format <span class="org-string">"(%d/%d) "</span>
        ivy-magic-tilde nil)
  <span class="org-builtin">:config</span>
  (my/ivy-reset-builders)
  (<span class="org-keyword">setq</span> ivy-initial-inputs-alist nil) <span class="org-comment-delimiter">;; </span><span class="org-comment">no ^ initially</span>
  (define-key ivy-minibuffer-map (kbd <span class="org-string">"C-l"</span>) 'ivy-call-and-recenter)

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/ivy-yank-current-region-or-word</span> (<span class="org-type">&amp;optional</span> qual)
    <span class="org-doc">"Insert current region, if it's active, otherwise the current word,into</span>
<span class="org-doc">the minibuffer."</span>
    (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
    (<span class="org-keyword">let</span> (text)
      (with-ivy-window
        (<span class="org-keyword">unwind-protect</span>
            (<span class="org-keyword">setq</span> text
                  (<span class="org-keyword">if</span> (region-active-p)
                      (buffer-substring-no-properties (region-beginning) (region-end))
                    (current-word t (not qual))))))
      (<span class="org-keyword">when</span> text (insert text))))
  (define-key ivy-minibuffer-map (kbd <span class="org-string">"M-j"</span>) 'my/ivy-yank-current-region-or-word)
  <span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span><span class="org-comment">: something's up with rotation</span>
  (define-key ivy-minibuffer-map (kbd <span class="org-string">"M-r"</span>) 'ivy-rotate-preferred-builders)

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/ivy-minibuffer-grow</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let*</span> ((prefix (prefix-numeric-value current-prefix-arg))
           (nlines (<span class="org-keyword">cond</span>
                    ((= prefix <span class="org-highlight-numbers-number">1</span>) <span class="org-highlight-numbers-number">1</span>)
                    ((= prefix <span class="org-highlight-numbers-number">4</span>) (/ (frame-height) <span class="org-highlight-numbers-number">2</span>))
                    (t (- (frame-height) <span class="org-highlight-numbers-number">5</span>))))
           (current-prefix-arg nil))
      (<span class="org-keyword">while</span> (&gt; nlines <span class="org-highlight-numbers-number">0</span>)
        (ivy-minibuffer-grow)
        (<span class="org-keyword">setq</span> nlines (1- nlines)))))

  (define-key ivy-minibuffer-map (kbd <span class="org-string">"C-o"</span>) #'my/ivy-minibuffer-grow)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">minibuffer actions for specific commands</span>

  (ivy-set-actions
   'ivy-switch-buffer
   `((<span class="org-string">"s"</span>
      ,(<span class="org-keyword">my/control-function-window-split</span>
        ivy--switch-buffer-other-window-action
        <span class="org-highlight-numbers-number">0</span> nil)
      <span class="org-string">"split horizontally"</span>)
     (<span class="org-string">"v"</span>
      ,(<span class="org-keyword">my/control-function-window-split</span>
        ivy--switch-buffer-other-window-action
        nil <span class="org-highlight-numbers-number">0</span>)
      <span class="org-string">"split vertically"</span>)
     (<span class="org-string">"n"</span>
      ,(<span class="org-keyword">my/execute-f-with-hook</span>
        (<span class="org-keyword">lambda</span> (b) (switch-to-buffer b nil 'force-same-window))
        ace-select-window)
      <span class="org-string">"select window"</span>)
     (<span class="org-string">"k"</span> kill-buffer <span class="org-string">"kill buffer"</span>)
     ))

  (ivy-set-actions
   'projectile-switch-project
   '((<span class="org-string">"d"</span>
      dired
      <span class="org-string">"Open Dired in project's directory"</span>)
     (<span class="org-string">"v"</span>
      projectile-vc
      <span class="org-string">"Open project root in vc-dir or magit"</span>)
     (<span class="org-string">"r"</span>
      projectile-remove-known-project
      <span class="org-string">"Remove project(s)"</span>))))

(<span class="org-keyword">use-package</span> <span class="org-constant">ivy-xref</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">currently in lisp/ because of patches</span>
  <span class="org-builtin">:config</span> (<span class="org-keyword">setq</span> xref-show-xrefs-function 'ivy-xref-show-xrefs)
  <span class="org-builtin">:after</span> ivy)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cfd7b5" class="outline-2">
<h2 id="org5cfd7b5"><span class="section-number-2">33</span> Yasnippet</h2>
<div class="outline-text-2" id="text-33">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">yasnippet-snippets</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> yasnippet
  <span class="org-builtin">:config</span>
  (yas-reload-all))

(<span class="org-keyword">use-package</span> <span class="org-constant">yasnippet</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (yas-expand)
  <span class="org-builtin">:diminish</span> yas-minor-mode
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">setup keys in `</span><span class="org-comment"><span class="org-constant">prog-mode-map</span></span><span class="org-comment">' initially ...</span>
  (define-key prog-mode-map (kbd <span class="org-string">"&lt;C-return&gt;"</span>) 'yas-expand)
  (define-key prog-mode-map (kbd <span class="org-string">"C-c y"</span>) 'yas-expand)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">... remove them from `</span><span class="org-comment"><span class="org-constant">prog-mode-map</span></span><span class="org-comment">' when mode is initialized ...</span>
  (define-key prog-mode-map (kbd <span class="org-string">"&lt;C-return&gt;"</span>) nil)
  (define-key prog-mode-map (kbd <span class="org-string">"C-c y"</span>) nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">... and add them to `</span><span class="org-comment"><span class="org-constant">yas-minor-mode-map</span></span><span class="org-comment">'</span>
  (define-key yas-minor-mode-map (kbd <span class="org-string">"&lt;C-return&gt;"</span>) 'yas-expand)
  (define-key yas-minor-mode-map (kbd <span class="org-string">"C-c y"</span>) 'yas-expand)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">this will run once (since it's in :config)</span>
  (<span class="org-keyword">when</span> (derived-mode-p 'prog-mode)
    (yas-minor-mode))
  (add-hook 'prog-mode-hook #'yas-minor-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgada2def" class="outline-2">
<h2 id="orgada2def"><span class="section-number-2">34</span> Modeline</h2>
<div class="outline-text-2" id="text-34">
</div>
<div id="outline-container-org64b20b0" class="outline-3">
<h3 id="org64b20b0"><span class="section-number-3">34.1</span> Selected window &amp; focused frame</h3>
<div class="outline-text-3" id="text-34-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">is window selected?</span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/-selected-window</span> nil)
<span class="org-comment-delimiter">;; </span><span class="org-comment">(add-hook 'post-command-hook '(lambda () (setq my/-selected-window (selected-window))))</span>
(add-hook 'post-command-hook
          '(lambda ()
             (<span class="org-keyword">when</span> (not (minibuffer-window-active-p (selected-window)))
               (<span class="org-keyword">setq</span> my/-selected-window (selected-window)))))
(add-hook 'buffer-list-update-hook '(lambda () (force-mode-line-update t)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">is emacs focused?</span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/-focused-in</span> t)
(add-hook 'focus-in-hook '(lambda () (<span class="org-keyword">setq</span> my/-focused-in t)))
(add-hook 'focus-out-hook '(lambda () (<span class="org-keyword">setq</span> my/-focused-in nil)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/current-window-active-p</span> ()
  (<span class="org-keyword">and</span> my/-focused-in
       (eq my/-selected-window (selected-window))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org755d628" class="outline-3">
<h3 id="org755d628"><span class="section-number-3">34.2</span> Regular modeline</h3>
<div class="outline-text-3" id="text-34-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq-default</span> mode-line-format
              '(<span class="org-string">"%e"</span>
                mode-line-front-space
                <span class="org-comment-delimiter">;; </span><span class="org-comment">evil-mode-line-tag</span>
                mode-line-mule-info
                mode-line-client mode-line-modified mode-line-remote
                mode-line-frame-identification mode-line-buffer-identification <span class="org-string">" "</span>
                mode-line-position
                (vc-mode vc-mode)
                (<span class="org-builtin">:eval</span> (my/mode-line-flycheck))
                (<span class="org-builtin">:eval</span> (my/mode-line-venv))
                mode-line-modes mode-line-misc-info mode-line-end-spaces))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-window-info</span> ()
  (<span class="org-keyword">let*</span> ((dedicated (window-dedicated-p))
         (fixed window-size-fixed)
         (pad (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> dedicated fixed) <span class="org-string">" "</span> <span class="org-string">""</span>)))
    (format <span class="org-string">"%s%s%s%s"</span>
            pad
            (<span class="org-keyword">if</span> dedicated <span class="org-string">"&#215;"</span> <span class="org-string">""</span>)
            (<span class="org-keyword">if</span> fixed <span class="org-string">"+"</span> <span class="org-string">""</span>)
            pad)))

(<span class="org-keyword">setq</span> mode-line-misc-info
      (cons '(<span class="org-builtin">:eval</span> (my/mode-line-window-info)) mode-line-misc-info))
</pre>
</div>
</div>
</div>

<div id="outline-container-org71a2800" class="outline-3">
<h3 id="org71a2800"><span class="section-number-3">34.3</span> Experimental new modeline</h3>
<div class="outline-text-3" id="text-34-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">for the position hud</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">powerline</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:commands</span> (pl/render powerline-hud))

<span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span><span class="org-comment">: make it better</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my/split-mode-line-render</span> (left right-wide right-narrow right-super-narrow)
  (<span class="org-keyword">let*</span> ((fmt-left (format-mode-line left))
         (available-width (- (window-total-width)
                             (+ (length fmt-left)
                                (length (format-mode-line right-wide)))))
         (right right-wide))
    (<span class="org-keyword">when</span> (&lt; available-width <span class="org-highlight-numbers-number">0</span>)  <span class="org-comment-delimiter">;; </span><span class="org-comment">narrow</span>
      (<span class="org-keyword">setq</span> right right-narrow)
      (<span class="org-keyword">setq</span> available-width (- (window-total-width)
                               (+ (length fmt-left)
                                  (length (format-mode-line right-narrow))))))
    (<span class="org-keyword">when</span> (&lt; available-width <span class="org-highlight-numbers-number">0</span>)  <span class="org-comment-delimiter">;; </span><span class="org-comment">super narrow</span>
      (<span class="org-keyword">setq</span> right right-super-narrow)
      (<span class="org-keyword">setq</span> available-width (- (window-total-width)
                               (+ (length fmt-left)
                                  (length (format-mode-line right-super-narrow))))))
    (append left
            (list (format (format <span class="org-string">"%%%ds"</span> available-width) <span class="org-string">""</span>))
            right)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-hud</span> ()
  (<span class="org-keyword">let*</span> ((active (eq my/-selected-window (selected-window)))
         (face0 (<span class="org-keyword">if</span> active 'powerline-active0 'powerline-inactive0))
         (face2 (<span class="org-keyword">if</span> active 'powerline-active2 'powerline-inactive2)))
    (pl/render (powerline-hud face0 face2))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-vc</span> ()
  (<span class="org-keyword">let</span> ((fname (buffer-file-name)))
    (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (null fname) (null vc-mode))
        nil
      (<span class="org-keyword">let</span> ((br (<span class="org-keyword">let</span> ((backend (vc-backend fname)))
                  (substring vc-mode (+ (<span class="org-keyword">if</span> (eq backend 'Hg) <span class="org-highlight-numbers-number">2</span> <span class="org-highlight-numbers-number">3</span>) <span class="org-highlight-numbers-number">2</span>))))
            (st (<span class="org-keyword">pcase</span> (vc-state fname)
                  ('up-to-date (propertize <span class="org-string">"&#10003;"</span> 'face '(<span class="org-builtin">:inherit</span> compilation-info <span class="org-builtin">:weight</span> bold)))
                  ('edited (propertize <span class="org-string">"&#8226;"</span> 'face 'compilation-warning))
                  ('added (propertize <span class="org-string">"+"</span> 'face '(<span class="org-builtin">:inherit</span> compilation-info <span class="org-builtin">:weight</span> bold)))
                  ('removed (propertize <span class="org-string">"&#10007;"</span> 'face '(<span class="org-builtin">:inherit</span> compilation-error <span class="org-builtin">:weight</span> bold)))
                  ('missing (propertize <span class="org-string">"?"</span> 'face '(<span class="org-builtin">:inherit</span> compilation-error <span class="org-builtin">:weight</span> bold)))
                  (_ <span class="org-string">"?"</span>))))
        (format <span class="org-string">"%s %s "</span>
                (truncate-string-to-width br <span class="org-highlight-numbers-number">21</span> nil nil <span class="org-string">"&#8230;"</span>)
                st)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-region-info</span> ()
  (<span class="org-keyword">when</span> mark-active
    (<span class="org-keyword">let*</span> ((evilp (<span class="org-keyword">and</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">evil</span>) (<span class="org-keyword">or</span> evil-local-mode evil-mode)))
           (beg (<span class="org-keyword">if</span> evilp evil-visual-beginning (region-beginning)))
           (end (<span class="org-keyword">if</span> evilp evil-visual-end (region-end)))
           (lines (count-lines beg end))
           (words (count-words beg end))
           (chars (abs (- beg end)))
           (l (propertize <span class="org-string">"l"</span> 'face 'compilation-info))
           (w (propertize <span class="org-string">"w"</span> 'face 'compilation-warning))
           (c (propertize <span class="org-string">"c"</span> 'face 'compilation-error)))
      (propertize (format <span class="org-string">"%s:%s %s:%s %s:%s"</span> l lines w words c chars)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-position</span> ()
  (<span class="org-keyword">let*</span> ((ln <span class="org-string">"%l"</span>)
         (col-tmpl <span class="org-string">"%2c"</span>)
         (cur-col (current-column))
         (col (<span class="org-keyword">if</span> (&gt;= cur-col fill-column)
                  (propertize col-tmpl 'face 'compilation-warning)
                col-tmpl)))
    (format <span class="org-string">"(%s,%s) "</span> ln col)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-server</span> ()
  (<span class="org-keyword">when</span> server-mode
    (propertize <span class="org-string">" srv "</span> 'face 'compilation-info)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mode-line-unicode-char</span> ()
  (<span class="org-keyword">let</span> ((ch (following-char)))
    (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> ch (&gt;= ch <span class="org-highlight-numbers-number">127</span>))
      (format <span class="org-string">"%s  "</span> (propertize
                      (get-char-code-property (following-char) 'name)
                      'face
                      'compilation-error)))))

(<span class="org-keyword">setq</span> global-mode-string (delete '(<span class="org-builtin">:eval</span> (persp-mode-line)) global-mode-string))
(setcar mode-line-position <span class="org-string">""</span>)

(<span class="org-keyword">setq-default</span>
 mode-line-format
 '((<span class="org-builtin">:eval</span>
    (my/split-mode-line-render
     <span class="org-comment-delimiter">;; </span><span class="org-comment">left</span>
     (<span class="org-keyword">quote</span>
      (<span class="org-string">"%e"</span> <span class="org-string">" "</span>
       mode-line-modified <span class="org-string">"  "</span>
       mode-line-buffer-identification <span class="org-string">" "</span>
       (<span class="org-builtin">:eval</span> (string-remove-suffix <span class="org-string">"-mode"</span> (format <span class="org-string">"%s"</span> major-mode)))
       (<span class="org-builtin">:eval</span> mode-line-process)
       (<span class="org-builtin">:eval</span> (my/mode-line-window-info))
       (<span class="org-builtin">:eval</span> (my/mode-line-flycheck)) <span class="org-string">" "</span>
       (<span class="org-builtin">:eval</span> (my/mode-line-region-info))
       ))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">right</span>
     (<span class="org-keyword">quote</span>
      (
       (<span class="org-builtin">:eval</span> (my/mode-line-unicode-char))
       (<span class="org-builtin">:eval</span> (my/mode-line-vc))
       (<span class="org-builtin">:eval</span> minor-mode-alist) <span class="org-string">" "</span>
       (<span class="org-builtin">:eval</span> (my/mode-line-server))
       (<span class="org-builtin">:eval</span> (frame-parameter nil 'persp--modestring)) <span class="org-string">"  "</span>
       (<span class="org-builtin">:eval</span> (my/mode-line-position))
       (<span class="org-builtin">:eval</span> (my/mode-line-hud)) <span class="org-string">"  "</span>
       ))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">right if too narrow</span>
     (<span class="org-keyword">quote</span>
      ((<span class="org-builtin">:eval</span> (my/mode-line-vc))
       (<span class="org-builtin">:eval</span> (frame-parameter nil 'persp--modestring)) <span class="org-string">"  "</span>
       (<span class="org-builtin">:eval</span> (my/mode-line-position))
       (<span class="org-builtin">:eval</span> (my/mode-line-hud)) <span class="org-string">"  "</span>
       ))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">right if super narrow</span>
     (<span class="org-keyword">quote</span>
      ((<span class="org-builtin">:eval</span> (frame-parameter nil 'persp--modestring)) <span class="org-string">"  "</span>
       (<span class="org-builtin">:eval</span> (my/mode-line-position))
       (<span class="org-builtin">:eval</span> (my/mode-line-hud)) <span class="org-string">"  "</span>
       ))
     ))))

<span class="org-comment-delimiter">;; </span><span class="org-comment">evil-mode-line-tag</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">mode-line-mule-info</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">mode-line-client</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">mode-line-remote</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(vc-mode vc-mode)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">mode-line-modes</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">mode-line-misc-info</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(:eval minor-mode-alist)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(:eval (my/mode-line-venv))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org60fe19b" class="outline-3">
<h3 id="org60fe19b"><span class="section-number-3">34.4</span> Powerline</h3>
<div class="outline-text-3" id="text-34-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">local for now</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">powerline-default-evil-theme</span>
  <span class="org-builtin">:commands</span> (powerline-default-evil-theme)
  <span class="org-builtin">:config</span>
  (add-to-list
   'powerline-default-evil-theme-state-faces
   '(hybrid . powerline-active0-evil-insert)))

(<span class="org-keyword">use-package</span> <span class="org-constant">powerline</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> flycheck
  <span class="org-builtin">:if</span> is-gui
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> powerline-display-buffer-size nil)
  (<span class="org-keyword">setq</span> powerline-display-mule-info nil)
  (<span class="org-keyword">setq</span> flycheck-mode-line '(<span class="org-builtin">:eval</span> (my/mode-line-flycheck)))
  (<span class="org-keyword">setq</span> global-mode-string
        (append global-mode-string '((<span class="org-builtin">:eval</span> (my/mode-line-venv)))))
  (<span class="org-keyword">setq</span> global-mode-string
        (cons '(<span class="org-builtin">:eval</span> (<span class="org-keyword">if</span> (window-dedicated-p) <span class="org-string">"&#215; "</span> <span class="org-string">""</span>)) global-mode-string))
  <span class="org-builtin">:config</span>
  (powerline-default-evil-theme)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(powerline-default-theme)</span>
  (diminish-undo 'flycheck-mode)
  (add-hook 'my/after-set-theme-hook 'powerline-reset)
  (add-hook 'my/after-set-font-hook 'powerline-reset)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Try this to see if it fixes powerline hiccups</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">powerline-selected-window-active</span> ()
    <span class="org-doc">"Return whether the current window is active."</span>
    (my/current-window-active-p))
  )
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org71e7552" class="outline-2">
<h2 id="org71e7552"><span class="section-number-2">35</span> org-mode</h2>
<div class="outline-text-2" id="text-35">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">this is the same as doing org-babel-load-languages</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">ob-python</span> <span class="org-builtin">:commands</span> (org-babel-execute:python))
(<span class="org-keyword">use-package</span> <span class="org-constant">ob-sql</span> <span class="org-builtin">:commands</span> (org-babel-execute:sql))

<span class="org-comment-delimiter">;; </span><span class="org-comment">use this bookmark:</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">javascript:location.href='org-protocol://capture?template=l'+</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">'&amp;url='+encodeURIComponent(location.href)+</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">'&amp;title='+encodeURIComponent(document.title)+</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">'&amp;body='+encodeURIComponent(window.getSelection())</span>
(<span class="org-keyword">require</span> '<span class="org-constant">org-protocol</span>)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Without this, quitting an org-protocol capture results in re-opening</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">the link with another mimeapp (firefox), and might result in an</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">infinite loop. This still deletes the client, but it does so cleanly.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment"><span class="org-myXspecial-comment-keyword">TODO</span></span><span class="org-comment">: think of a better way</span>
(advice-add 'server-return-error
            <span class="org-builtin">:override</span>
            '(lambda (proc err)
               (message <span class="org-string">"exiting client"</span>)
               (server-delete-client proc)))

(<span class="org-keyword">use-package</span> <span class="org-constant">org-capture</span>
  <span class="org-builtin">:after</span> org
  <span class="org-builtin">:commands</span> (org-capture)
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c c"</span> . org-capture))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> org-capture-templates
        '((<span class="org-string">"l"</span>
           <span class="org-string">"Web link (roam)"</span>
           entry
           (file my/org-roam-find-filename)
           <span class="org-string">"* %^{Title|%:description}\n  %U\n  Source: %a \n\n  %i"</span>
           <span class="org-builtin">:empty-lines</span> <span class="org-highlight-numbers-number">1</span>)
          (<span class="org-string">"c"</span>
           <span class="org-string">"Code comment"</span>
           entry
           (file+headline org-default-notes-file <span class="org-string">"Code comments"</span>)
           <span class="org-string">"\n\n* %?\n\n#+BEGIN_SRC %^{Language}\n%i\n#+END_SRC\n\n%a\n"</span>))))

(<span class="org-keyword">use-package</span> <span class="org-constant">org</span>
  <span class="org-builtin">:mode</span> (<span class="org-string">"\\.org\\'"</span> . org-mode)
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c a"</span> . org-agenda)
         (<span class="org-string">"C-c b"</span> . org-iswitchb)
         (<span class="org-string">"C-c l"</span> . org-store-link))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> org-log-done 'time
        org-confirm-babel-evaluate nil
        org-clock-into-drawer nil
        org-src-fontify-natively t
        org-src-preserve-indentation t
        org-src-tab-acts-natively t
        org-src-window-setup 'other-window
        org-adapt-indentation nil
        org-directory (concat my/dropbox-dir <span class="org-string">"org/"</span>)
        org-default-notes-file (concat org-directory <span class="org-string">"notes.org"</span>)
        org-ellipsis <span class="org-string">"&#8230;"</span>
        org-tags-column <span class="org-highlight-numbers-number">-80</span>
        org-todo-keywords '((sequence <span class="org-string">"</span><span class="org-string"><span class="org-myXspecial-comment-keyword">TODO</span></span><span class="org-string">"</span> <span class="org-string">"IN PROGRESS"</span> <span class="org-string">"|"</span> <span class="org-string">"</span><span class="org-string"><span class="org-myXspecial-comment-keyword">DONE</span></span><span class="org-string">"</span>))
        org-todo-keyword-faces '((<span class="org-string">"IN PROGRESS"</span> . (<span class="org-builtin">:foreground</span> <span class="org-string">"DarkOrange3"</span> <span class="org-builtin">:weight</span> bold))))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">format string used when creating CLOCKSUM lines and when generating a</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">time duration (avoid showing days)</span>
  (<span class="org-keyword">setq</span> org-time-clocksum-format
        '(<span class="org-builtin">:hours</span> <span class="org-string">"%d"</span> <span class="org-builtin">:require-hours</span> t <span class="org-builtin">:minutes</span> <span class="org-string">":%02d"</span> <span class="org-builtin">:require-minutes</span> t))

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/org-insert-template</span> ()
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let*</span> ((templ-dir (expand-file-name (concat user-emacs-directory <span class="org-string">"org-templates/"</span>)))
           (ls (directory-files templ-dir nil <span class="org-string">"^[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">.]"</span>))
           (file (completing-read <span class="org-string">"Template: "</span> ls))
           (path (concat templ-dir file)))
      (insert-file-contents path)))

  <span class="org-builtin">:config</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">org-tempo</span> nil <span class="org-builtin">:noerror</span>)
  (add-hook 'org-babel-after-execute-hook 'org-display-inline-images 'append)
  (<span class="org-keyword">my/add-hooks</span>
   '(org-mode-hook)
   (define-key org-mode-map (kbd <span class="org-string">"TAB"</span>) 'org-cycle)
   (define-key org-mode-map (kbd <span class="org-string">"&lt;tab&gt;"</span>) 'org-cycle)
   (define-key evil-normal-state-map (kbd <span class="org-string">"TAB"</span>) 'org-cycle)
   (my/set-mode-fill-width 'org-mode-hook <span class="org-highlight-numbers-number">100</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-set-src-faces</span> (<span class="org-type">&amp;optional</span> light-bg th)
  (<span class="org-keyword">let*</span> ((func (<span class="org-keyword">if</span> light-bg 'color-darken-name 'color-lighten-name))
         (rfunc (<span class="org-keyword">if</span> light-bg 'color-lighten-name 'color-darken-name))
         (bg (face-attribute 'default <span class="org-builtin">:background</span>))
         (bg+ (funcall func bg <span class="org-highlight-numbers-number">1</span>))
         (bg++ (funcall func bg <span class="org-highlight-numbers-number">4.5</span>))
         (fg (face-attribute 'default <span class="org-builtin">:foreground</span>))
         (theme (<span class="org-keyword">if</span> th th my/theme))
         (cur-line-fg (face-attribute 'org-block-begin-line <span class="org-builtin">:foreground</span> nil t))
         (cur-block-fg (funcall rfunc (face-attribute 'default <span class="org-builtin">:foreground</span> nil t) <span class="org-highlight-numbers-number">11</span>))
         )
    (custom-theme-set-faces
     theme
     `(org-block ((t (<span class="org-builtin">:background</span> ,bg+ <span class="org-builtin">:foreground</span> ,cur-block-fg))))
     `(org-block-begin-line ((t (<span class="org-builtin">:background</span> ,bg++ <span class="org-builtin">:foreground</span> ,cur-line-fg))))
     `(org-block-end-line ((t (<span class="org-builtin">:background</span> ,bg++ <span class="org-builtin">:foreground</span> ,cur-line-fg)))))))

(<span class="org-keyword">use-package</span> <span class="org-constant">org-bullets</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> is-gui
  <span class="org-builtin">:after</span> org
  <span class="org-builtin">:hook</span> (org-mode . org-bullets-mode)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> org-hide-leading-stars t))

<span class="org-comment-delimiter">;; </span><span class="org-comment">auto-generated if a heading has a :TOC: tag</span>
(<span class="org-keyword">use-package</span> <span class="org-constant">toc-org</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> org
  <span class="org-builtin">:hook</span> (org-mode . toc-org-mode))

(<span class="org-keyword">use-package</span> <span class="org-constant">htmlize</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> org-html-htmlize-output-type 'css))
</pre>
</div>
</div>
</div>

<div id="outline-container-org457a7e8" class="outline-2">
<h2 id="org457a7e8"><span class="section-number-2">36</span> org-roam</h2>
<div class="outline-text-2" id="text-36">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">org-roam</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-init . org-roam-mode)
  <span class="org-builtin">:diminish</span>
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> org-roam-mode-map
              ((<span class="org-string">"C-c n b"</span> . org-roam-switch-to-buffer)
               (<span class="org-string">"C-c n c"</span> . org-roam-capture)
               (<span class="org-string">"C-c n d"</span> . deft)
               (<span class="org-string">"C-c n f"</span> . org-roam-find-file)
               (<span class="org-string">"C-c n l"</span> . org-roam)
               (<span class="org-string">"C-c n x"</span> . org-roam-jump-to-index))
              <span class="org-builtin">:map</span> org-mode-map
              ((<span class="org-string">"C-c n i"</span> . org-roam-insert)
               (<span class="org-string">"C-c n I"</span> . my/org-roam-insert-link-to-heading)))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> org-roam-directory (concat my/dropbox-dir <span class="org-string">"org-roam/"</span>)
        org-roam-index-file <span class="org-string">"index.org"</span>
        org-roam-link-title-format <span class="org-string">"%s"</span>)
  <span class="org-builtin">:config</span>
  (add-hook 'org-roam-backlinks-mode-hook 'org-indent-mode))

(<span class="org-keyword">use-package</span> <span class="org-constant">org-roam-protocol</span>
  <span class="org-builtin">:after</span> org-roam)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-roam-filename-from-title</span> (title)
  (<span class="org-keyword">let*</span> ((tmpl (concat org-roam-capture--file-name-default <span class="org-string">"-${slug}"</span>))
         (slug (org-roam--title-to-slug title)))
    (string-trim (org-roam-capture--fill-template tmpl `((slug . ,slug))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-roam-find-filename</span> ()
  (<span class="org-keyword">let*</span> ((completions (org-roam--get-title-path-completions))
         (title (org-roam-completion--completing-read <span class="org-string">"File: "</span> completions))
         (filename (cdr (assoc title completions))))
    (<span class="org-keyword">if</span> (null filename)
        (<span class="org-keyword">let*</span> ((create-fn (concat (my/org-roam-filename-from-title title) <span class="org-string">".org"</span>))
               (key (format <span class="org-string">"#+TITLE: %s\n"</span> title)))
          (<span class="org-keyword">setq</span> filename (expand-file-name (concat org-roam-directory create-fn)))
          (write-region key nil filename)
          (org-roam-db-build-cache <span class="org-builtin">:force</span>)))
    filename))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-mode-select-heading</span> (<span class="org-type">&amp;optional</span> filename)
  (<span class="org-keyword">if</span> (null filename)
      (my/-org-mode-select-heading)
    (<span class="org-keyword">with-temp-buffer</span>
      (insert-file-contents filename)
      (org-mode)
      (my/-org-mode-select-heading))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/-org-mode-select-heading</span> ()
  (<span class="org-keyword">let*</span> ((settings (cdr (assq 'org-mode counsel-outline-settings)))
         (res (substring-no-properties
               (ivy-read <span class="org-string">"Heading: "</span> (counsel-outline-candidates settings)
                         <span class="org-builtin">:history</span> (<span class="org-keyword">or</span> (plist-get settings <span class="org-builtin">:history</span>)
                                      'counsel-outline-history)
                         <span class="org-builtin">:preselect</span> (max (1- counsel-outline--preselect) <span class="org-highlight-numbers-number">0</span>)
                         <span class="org-builtin">:caller</span> (<span class="org-keyword">or</span> (plist-get settings <span class="org-builtin">:caller</span>)
                                     'counsel-outline)))))
    (car (last (split-string res <span class="org-string">"/"</span>)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-roam-insert-link-to-heading</span> ()
  (<span class="org-keyword">interactive</span>)
  (advice-add 'org-link-make-string <span class="org-builtin">:filter-args</span> 'my/org-link-make-string-with-heading)
  (funcall-interactively 'org-roam-insert)
  (advice-remove 'org-link-make-string 'my/org-link-make-string-with-heading))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-link-make-string-with-heading</span> (params)
  (<span class="org-keyword">let*</span> ((link (car params))
         (description (cadr params))
         (fname (string-trim-left link <span class="org-string">"file:"</span>))
         (heading (my/org-mode-select-heading fname))
         (newlink (format <span class="org-string">"%s::%s"</span> link heading))
         (newdescription (<span class="org-keyword">if</span> (null description)
                             nil
                           (format <span class="org-string">"%s::%s"</span> description heading))))
    (list newlink newdescription)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ecf9df" class="outline-2">
<h2 id="org2ecf9df"><span class="section-number-2">37</span> deft</h2>
<div class="outline-text-2" id="text-37">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">deft</span>
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> org-roam
  <span class="org-builtin">:bind</span> ((<span class="org-string">"&lt;f8&gt;"</span> . deft)
         (<span class="org-string">"C-x &lt;f8&gt;"</span> . deft-find-file))
  <span class="org-builtin">:commands</span> (deft deft-cache-initialize
              deft-parse-title deft-sort-files-by-mtime)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">deft-directory (concat my/dropbox-dir "deft")</span>
        deft-directory org-roam-directory
        deft-recursive t
        <span class="org-comment-delimiter">;; </span><span class="org-comment">deft-extensions '("md" "org" "txt")</span>
        deft-extensions '(<span class="org-string">"org"</span> <span class="org-string">"md"</span> <span class="org-string">"txt"</span>)
        deft-ignore-file-regexp <span class="org-string">"_sidebar</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">.md</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">index</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">.md"</span>
        deft-markdown-mode-title-level <span class="org-highlight-numbers-number">1</span>
        deft-use-filter-string-for-filename t
        deft-file-naming-rules '((noslash . <span class="org-string">"_"</span>)
                                 (nospace . <span class="org-string">"_"</span>)
                                 (case-fn . downcase)))
  (<span class="org-keyword">with-eval-after-load</span> 'markdown-mode
    (define-key markdown-mode-map (kbd <span class="org-string">"C-c &lt;f8&gt;"</span>) 'my/generate-deft-link))

  (<span class="org-keyword">defun</span> <span class="org-function-name">my/deft-search</span> ()
    (<span class="org-keyword">interactive</span>)
    (counsel-rg <span class="org-string">""</span>
                deft-directory
                <span class="org-string">"-g !_sidebar.md -g !index.md -g !index.html -g !static/"</span>))
  (<span class="org-keyword">defalias</span> '<span class="org-function-name">ds</span> 'my/deft-search)

  <span class="org-builtin">:config</span>
  (advice-add 'deft-cache-update-all <span class="org-builtin">:after</span> 'my/deft-docsify-write-sidebar)
  (advice-add 'deft-new-file-named <span class="org-builtin">:filter-args</span> '(lambda (n) (mapcar 'my/org-roam-filename-from-title n)))
  (advice-add 'deft-cache-update-all <span class="org-builtin">:after</span> '(lambda () (org-roam-db-build-cache <span class="org-builtin">:force</span>)))
  )

(<span class="org-keyword">defun</span> <span class="org-function-name">my/get-deft-file-by-title</span> ()
  (<span class="org-keyword">if</span> (<span class="org-keyword">or</span> (not (boundp 'deft-hash-mtimes)) (null deft-hash-mtimes))
      (deft-cache-initialize)
    (deft-cache-update-all))
  (<span class="org-keyword">let*</span> ((files (deft-sort-files-by-mtime (deft-find-all-files)))
         (titles (mapcar 'deft-file-title files))
         (cands (-zip titles files))
         (title (completing-read <span class="org-string">"Deft file: "</span> titles)))
    (assoc title cands)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/get-deft-file-by-filename</span> ()
  (<span class="org-keyword">let*</span> ((name
          (string-trim-left
           (completing-read <span class="org-string">"Deft file: "</span> (deft-find-all-files-no-prefix))
           <span class="org-string">"/"</span>))
         (dir (string-trim-right (expand-file-name deft-directory) <span class="org-string">"/"</span>))
         (path (concat dir <span class="org-string">"/"</span> name))
         (contents (<span class="org-keyword">with-temp-buffer</span>
                     (insert-file-contents path)
                     (buffer-string)))
         (title (deft-parse-title path contents)))
    `(,title . ,path)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/generate-deft-link</span> (by-filename)
  <span class="org-doc">"Interactively generate a relative markdown link to a deft file.</span>

<span class="org-doc">With prefix arg or non-nil BY-FILENAME the completion shows the filenames</span>
<span class="org-doc">instead of the title as seen by deft."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"P"</span>)
  (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (null (buffer-file-name))
            (not (string-prefix-p (expand-file-name deft-directory)
                                  (file-name-directory (buffer-file-name)))))
    (<span class="org-warning">user-error</span> <span class="org-string">"Not currently editing a deft file"</span>))
  (<span class="org-keyword">let*</span> ((info (<span class="org-keyword">if</span> by-filename
                   (my/get-deft-file-by-filename)
                 (my/get-deft-file-by-title)))
         (title (car info))
         (path (cdr info))
         (prompt (format <span class="org-string">"Link text [%s]: "</span> title))
         (link-text (read-string prompt nil nil title))
         (curdir (file-name-directory (buffer-file-name)))
         (link-path (file-relative-name path curdir)))
    (insert (format <span class="org-string">"[%s](%s)"</span> link-text link-path))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/deft-docsify-sidebar-content</span> ()
  (<span class="org-keyword">let*</span> ((files (deft-sort-files-by-mtime (deft-find-all-files)))
         (titles (mapcar 'deft-file-title files))
         (dd (expand-file-name deft-directory))
         (paths (mapcar #'(lambda (p) (file-relative-name p dd)) files))
         (pairs (-zip titles paths)))
    (-reduce-from
     #'(lambda (acc pair)
         (<span class="org-keyword">let*</span> ((fname (car pair))
                (path (cdr pair))
                (link (format <span class="org-string">"[%s](%s)"</span> fname path)))
           (concat acc <span class="org-string">"- "</span> link <span class="org-string">"\n"</span>)))
     <span class="org-string">"- [Index](index.md)\n"</span>
     pairs)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/deft-docsify-write-sidebar</span> ()
  (<span class="org-keyword">let*</span> ((dir (string-trim-right (expand-file-name deft-directory) <span class="org-string">"/"</span>))
         (fname <span class="org-string">"_sidebar.md"</span>)
         (path (concat dir <span class="org-string">"/"</span> fname)))
    (<span class="org-keyword">with-temp-file</span> path
      (erase-buffer)
      (insert (my/deft-docsify-sidebar-content)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/wiki-refresh</span> ()
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (not (boundp 'deft-hash-mtimes)) (null deft-hash-mtimes))
    (deft-cache-initialize))
  (deft-cache-update-all)
  (my/deft-docsify-write-sidebar))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9bc3c2c" class="outline-2">
<h2 id="org9bc3c2c"><span class="section-number-2">38</span> Setup</h2>
<div class="outline-text-2" id="text-38">
</div>
<div id="outline-container-org4c204b8" class="outline-3">
<h3 id="org4c204b8"><span class="section-number-3">38.1</span> Per-workstation setup</h3>
<div class="outline-text-3" id="text-38-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/after-init-hook</span> nil <span class="org-doc">"Hook called after initialization"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">these have to be paths to projects that projectile recognizes (e.g. git)</span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/start-up-projects</span> '())

(<span class="org-keyword">defun</span> <span class="org-function-name">my/open-start-up-projects</span> ()
  (<span class="org-keyword">unless</span> (null my/start-up-projects)
    (<span class="org-keyword">let</span> ((projectile-switch-project-action 'projectile-dired))
      (<span class="org-keyword">dolist</span> (proj my/start-up-projects)
        (projectile-persp-switch-project proj)))
    (persp-switch <span class="org-string">"main"</span>)))

(add-hook 'my/after-init-hook 'my/open-start-up-projects)

<span class="org-comment-delimiter">;; </span><span class="org-comment">usage:</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(add-to-list 'my/start-up-projects "/path/to/some/project")</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">https://nicolas.petton.fr/blog/per-computer-emacs-settings.html</span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/hosts-dir</span> (expand-file-name (concat user-emacs-directory <span class="org-string">"hosts/"</span>)))
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/hostname</span> (substring (shell-command-to-string <span class="org-string">"hostname"</span>) <span class="org-highlight-numbers-number">0</span> <span class="org-highlight-numbers-number">-1</span>))
(<span class="org-keyword">let*</span> ((host-file (concat my/hosts-dir <span class="org-string">"init-"</span> my/hostname <span class="org-string">".el"</span>)))
  (load-file host-file))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7f5ef5" class="outline-3">
<h3 id="orge7f5ef5"><span class="section-number-3">38.2</span> Performance</h3>
<div class="outline-text-3" id="text-38-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">stolen from doom</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my/defer-garbage-collection-h</span> ()
  (<span class="org-keyword">setq</span> gc-cons-threshold <span class="org-highlight-numbers-number">100000000</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/restore-garbage-collection-h</span> ()
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Defer it so that commands launched immediately after will enjoy the</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">benefits.</span>
  (run-at-time
   <span class="org-highlight-numbers-number">1</span> nil (<span class="org-keyword">lambda</span> () (<span class="org-keyword">setq</span> gc-cons-threshold <span class="org-highlight-numbers-number">800000</span>))))

(add-hook 'minibuffer-setup-hook #'my/defer-garbage-collection-h)
(add-hook 'minibuffer-exit-hook #'my/restore-garbage-collection-h)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9594f9c" class="outline-3">
<h3 id="org9594f9c"><span class="section-number-3">38.3</span> Global setup</h3>
<div class="outline-text-3" id="text-38-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> custom-file (concat user-emacs-directory <span class="org-string">"custom.el"</span>))
<span class="org-comment-delimiter">;; </span><span class="org-comment">(load custom-file 'noerror)</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">make underlines show under mode-line (cleaner)</span>
(<span class="org-keyword">setq</span> x-underline-at-descent-line t)

(my/set-theme)
(my/set-font)

(<span class="org-keyword">setq</span> linum-format 'dynamic)

(<span class="org-keyword">setq</span> default-input-method <span class="org-string">"TeX"</span>)

(hybrid-mode)
(winner-mode)

(run-hooks 'my/after-init-hook)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a72cdf" class="outline-3">
<h3 id="org5a72cdf"><span class="section-number-3">38.4</span> custom</h3>
<div class="outline-text-3" id="text-38-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(custom-set-faces
 '(anzu-mode-line ((t (<span class="org-builtin">:inherit</span> mode-line <span class="org-builtin">:foreground</span> <span class="org-string">"magenta"</span> <span class="org-builtin">:weight</span> bold))))
 '(anzu-mode-line-no-match ((t (<span class="org-builtin">:inherit</span> mode-line <span class="org-builtin">:foreground</span> <span class="org-string">"red"</span> <span class="org-builtin">:weight</span> bold))))
 '(fixed-pitch ((t nil)))
 '(flycheck-info ((t (<span class="org-builtin">:underline</span> (<span class="org-builtin">:color</span> <span class="org-string">"DeepSkyBlue2"</span> <span class="org-builtin">:style</span> wave)))))
 '(flycheck-fringe-info ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"DeepSkyBlue2"</span>))))
 '(flycheck-warning ((t (<span class="org-builtin">:underline</span> (<span class="org-builtin">:color</span> <span class="org-string">"orange1"</span> <span class="org-builtin">:style</span> wave)))))
 '(flycheck-fringe-warning ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"orange1"</span>))))
 '(flycheck-error ((t (<span class="org-builtin">:underline</span> (<span class="org-builtin">:color</span> <span class="org-string">"red1"</span> <span class="org-builtin">:style</span> wave)))))
 '(flycheck-fringe-error ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"#FB4933"</span>))))
 <span class="org-comment-delimiter">;; </span><span class="org-comment">'(whitespace-trailing ((t (:background "#602020"))))</span>
 )

(<span class="org-keyword">dolist</span> (val '((eval . (<span class="org-keyword">setq</span> flycheck-disabled-checkers
                             (append flycheck-disabled-checkers
                                     (<span class="org-keyword">quote</span>
                                      (intero)))))
               (haskell-hoogle-command . <span class="org-string">"stack hoogle -- --count=100"</span>)
               (projectile-tags-command . <span class="org-string">"npm run etags"</span>)
               (projectile-tags-command . <span class="org-string">"fast-tags -e -R ."</span>)
               (projectile-tags-command . <span class="org-string">"fast-tags -e -R -o %s --exclude=\"%s\" \"%s\""</span>)
               (psc-ide-output-directory . <span class="org-string">"build/"</span>)
               (my/use-intero . t)
               (my/haskell-align-stuff . nil)
               (my/haskell-use-ormolu . t)
               (my/purescript-align-stuff . nil)
               ))
  (add-to-list 'safe-local-variable-values val))
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Alex Peitsinis</p>
<p class="date">Created: 2020-05-15 Fri 12:00</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
